<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ë¬´ì„±ì˜ ì—¬í–‰ - í˜¸í…” ëª©ë¡</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
.moana_gnb {
	background-color: #5ac4c9; /* ì²« ë²ˆì§¸ ì´ë¯¸ì§€ì˜ í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
	color: #fff; /* ê¸°ë³¸ ê¸€ììƒ‰ í°ìƒ‰ */
	padding: 10px 0; /* ìƒí•˜ íŒ¨ë”© */
}

.gnb_container {
	max-width: 1200px; /* ì ì ˆí•œ ìµœëŒ€ ë„ˆë¹„ ì„¤ì • (Gë§ˆì¼“ ìŠ¤íƒ€ì¼) */
	margin: 0 auto; /* ê°€ìš´ë° ì •ë ¬ */
	display: flex; /* ë‚´ë¶€ ìš”ì†Œë“¤ì„ ê°€ë¡œë¡œ ì •ë ¬í•˜ê¸° ìœ„í•´ flexbox ì‚¬ìš© */
	align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
	justify-content: space-between; /* ìš”ì†Œë“¤ ê°„ì˜ ê³µê°„ ë°°ë¶„ */
	padding: 0 20px; /* ì¢Œìš° íŒ¨ë”© */
}

.moana_gnb h1 {
	margin: 0;
	display: flex;
	align-items: center;
}

.box__inner h1 a {
    color: #fff;             /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ (í—¤ë”ì™€ ë™ì¼í•œ í°ìƒ‰) */
    text-decoration: none;  /* ë§í¬ ë°‘ì¤„ ì œê±° */
    font-size: 22px;        /* í°íŠ¸ í¬ê¸° (ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì ˆí•˜ì„¸ìš”) */
    font-weight: bold;      /* í°íŠ¸ êµµê¸° */
}

/* GNB ë©”ë‰´ íƒ­ */
.list__tab {
	list-style: none;
	margin: 0;
	padding: 0;
	display: flex;
	gap: 20px;
}

.list__tab .list-item a {
	color: #fff;
	text-decoration: none;
	font-weight: bold;
	padding: 5px 0;
	position: relative;
	transition: color 0.3s ease;
}

.list__tab .list-item a:hover, .list__tab .list-item a.link__tab--active
	{
	color: #eee;
}

/* GNB í™œì„± íƒ­ ë°‘ì¤„ (ì˜ˆ: 'í•­ê³µ' íƒ­ì´ í˜„ì¬ í˜ì´ì§€ì¼ ë•Œ) */
.list__tab .list-item a.link__tab--active::after {
	content: '';
	position: absolute;
	left: 0;
	bottom: -5px;
	width: 100%;
	height: 2px;
	background-color: #fff;
}

/* GNB ìš°ì¸¡ ë§í¬ (ì˜ˆì•½ë‚´ì—­, ë¡œê·¸ì¸) */
.link-container {
	display: flex;
	align-items: center;
	gap: 10px;
}

.link__booking-history {
	background-color: transparent;
	border: 1px solid #fff;
	color: #fff;
	padding: 8px 15px;
	border-radius: 20px;
	text-decoration: none;
	font-size: 14px;
	transition: background-color 0.3s ease, color 0.3s ease;
	white-space: nowrap;
}

.link__booking-history:hover {
	background-color: #fff;
	color: #5ac4c9;
}

/* GNB ë¡œê³  ì˜ì—­ */
.box__inner {
	display: flex;
	align-items: center;
	gap: 20px;
}

/* í˜ì´ì§€ ì „ì²´ ì—¬ë°± ì œê±° (í—¤ë”ê°€ í™”ë©´ ìƒë‹¨ì— ë¶™ë„ë¡) */
body {
	margin: 0;
	background-color: #f8f9fa; /* 3. ë°°ê²½ìƒ‰ ì¶”ê°€ (í•­ê³µê¶Œ í˜ì´ì§€ì™€ í†µì¼) */
}

/* [ â­ ì¶”ê°€ ] í´ë¦­ ê°€ëŠ¥í•œ í˜¸í…” ì¹´ë“œì— ì»¤ì„œ ìŠ¤íƒ€ì¼ ì ìš© */
.hotel-card-clickable:hover {
	border-color: #5ac4c9; /* í˜¸ë²„ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€ê²½ */
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ */
}

/* â­ [ìˆ˜ì •] ê³ ì • ë³„ 5ê°œ í‘œì‹œìš© CSS */
.five-stars {
	color: #fdcc0d; /* ë³„í‘œ(ì±„ì›Œì§„) ìƒ‰ìƒ */
	font-size: 1.1rem;
}
</style>
</head>
<body>
	<div class="moana_gnb" role="complementary">
		<div class="gnb_container">
			<div class="box__inner">
				<h1>
					<a href="/">ë¬´ì„±ì˜ ì—¬í–‰</a>
				</h1>
			</div>

			<ul class="list__tab">
				<li class="list-item"><a class="link__tab" href="/">í•­ê³µ</a></li>
				<li class="list-item"><a class="link__tab" href="/chat">ì¶”ì²œì±—</a></li>
			</ul>

			<div class="link-container">
				<a href="/revList" class="link__booking-history sp_sd--after"
					th:if="${session.loginUser != null}">ë‚˜ì˜ ì˜ˆì•½ë‚´ì—­</a> <a
					th:if="${session.loginUser == null}"
					class="link__booking-history sp_sd--after" href="member/login">ë¡œê·¸ì¸</a>
				<a th:if="${session.loginUser != null}"
					th:text="${session.loginUser.UserName}"
					class="link__booking-history sp_sd--after">í—ˆì„±ë¬´</a> <a
					th:if="${session.loginUser != null}"
					class="link__booking-history sp_sd--after" href="member/logout">ë¡œê·¸ì•„ì›ƒ</a>
			</div>
		</div>
	</div>

	<main class="container py-5">
		<h2 class="mb-4 fw-bold">âœˆï¸ ê·¼ì²˜ í˜¸í…” ëª©ë¡</h2>

		<div th:if="${errorMessage}" class="alert alert-danger" role="alert">
			<span th:text="${errorMessage}">ì˜¤ë¥˜ ë©”ì‹œì§€</span>
		</div>

		<div
			th:if="${#strings.isEmpty(errorMessage) and #lists.isEmpty(hotelList)}"
			class="alert alert-info" role="alert">
			<span
				th:text="'ë„ì°©ì§€(' + ${param.destination} + ') ê·¼ì²˜ 10KM ì´ë‚´ì˜ í˜¸í…” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'">
				í˜¸í…” ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. </span>
		</div>

		<div class="row g-3">
			<div class="col-12 col-md-6" th:each="hotel : ${hotelList}">

				<div class="card h-100 hotel-card-clickable"
					th:if="${hotel.geoCode != null}"
					th:data-hotel-id="${hotel.hotelId}"
					th:data-hotel-name="${hotel.koreanName}"
					th:data-hotel-lat="${hotel.geoCode.latitude}"
					th:data-hotel-lng="${hotel.geoCode.longitude}"
					data-bs-toggle="modal" data-bs-target="#hotelMapModal"
					style="cursor: pointer;">

					<div class="card-body">
						<h5 class="card-title fw-bold" th:text="${hotel.koreanName}">í˜¸í…”
							ì´ë¦„</h5>

						<div class="mb-2 five-stars">
							<i class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i> <i
								class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i> <i
								class="bi bi-star-fill"></i>
						</div>

						<p class="card-text mb-2">
							<small class="text-muted" th:text="'ID: ' + ${hotel.hotelId}">ID:
								ZZNCENVX</small>
						</p>
						<span class="badge bg-primary"
							th:text="'ì•½ ' + ${hotel.distance.value} + ' ' + ${hotel.distance.unit}">
							0.92 KM </span>

						<div class="mt-2 text-muted" style="font-size: 0.8rem;"
							th:if="${hotel.geoCode != null}">
							(ìœ„ë„: <span th:text="${hotel.geoCode.latitude}"></span>, ê²½ë„: <span
								th:text="${hotel.geoCode.longitude}"></span>)
						</div>
					</div>
				</div>

				<div class="card h-100" th:if="${hotel.geoCode == null}">
					<div class="card-body">
						<h5 class="card-title fw-bold" th:text="${hotel.koreanName}">í˜¸í…”
							ì´ë¦„</h5>

						<div class="mb-2 five-stars">
							<i class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i> <i
								class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i> <i
								class="bi bi-star-fill"></i>
						</div>

						<p class="card-text mb-2">
							<small class="text-muted" th:text="'ID: ' + ${hotel.hotelId}">ID:
								ZZNCENVX</small>
						</p>
						<span class="badge bg-primary"
							th:text="'ì•½ ' + ${hotel.distance.value} + ' ' + ${hotel.distance.unit}">
							0.92 KM </span>
						<div class="mt-2 text-muted" style="font-size: 0.8rem;">(ìœ„ì¹˜
							ì •ë³´ ì—†ìŒ)</div>
					</div>
				</div>

			</div>
		</div>
	</main>

	<div class="modal fade" id="hotelMapModal" tabindex="-1"
		aria-labelledby="hotelMapModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="hotelMapModalLabel">í˜¸í…” ìœ„ì¹˜</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>

				<div class="modal-body">
					<div class="row">
						<div class="col-md-8">
							<div id="map-canvas" style="height: 400px; width: 100%;"></div>

							<div id="map-info" class="mt-3 p-3 bg-light rounded">
								<p class="mb-0">ê²½ë¡œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
							</div>
						</div>

						<div class="col-md-4">
							<h6 class="mb-3">ğŸ¨ ë‹¤ë¥¸ ì£¼ë³€ í˜¸í…”</h6>
							<div id="modal-hotel-list" class="list-group list-group-flush"
								style="max-height: 400px; overflow-y: auto;">

								<div th:each="otherHotel : ${hotelList}">
									<a href="#"
										class="list-group-item list-group-item-action py-2 modal-hotel-item"
										th:data-hotel-id="${otherHotel.hotelId}"
										th:data-hotel-name="${otherHotel.koreanName}"
										th:data-hotel-lat="${otherHotel.geoCode?.latitude}"
										th:data-hotel-lng="${otherHotel.geoCode?.longitude}"
										onclick="selectOtherHotel(this); return false;">

										<h6 class="mb-1" th:text="${otherHotel.koreanName}">ë‹¤ë¥¸ í˜¸í…”
											ì´ë¦„</h6>

										<div class="mb-1 five-stars" style="font-size: 0.9rem;">
											<i class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i>
											<i class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i>
											<i class="bi bi-star-fill"></i>
										</div> <small class="text-muted"
										th:if="${otherHotel.distance != null}"
										th:text="'ì•½ ' + ${otherHotel.distance.value} + ' ' + ${otherHotel.distance.unit}">0.92
											KM</small> <small class="text-muted"
										th:if="${otherHotel.geoCode == null}">(ìœ„ì¹˜ì •ë³´ ì—†ìŒ)</small>
									</a>
								</div>

								<div th:if="${#lists.isEmpty(hotelList)}"
									class="text-muted text-center py-3">ì£¼ë³€ í˜¸í…”ì´ ì—†ìŠµë‹ˆë‹¤.</div>
							</div>
						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">ë‹«ê¸°</button>
				</div>
			</div>
		</div>
	</div>

	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>

	<script>
    // 1. ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸
    let map;
    const airportIataCode = "[[${param.destination}]]";
    const hotelMapModal = document.getElementById('hotelMapModal');
    const mapCanvas = document.getElementById('map-canvas');
    const mapInfoEl = document.getElementById('map-info');
    
    let airportMarker = null;
    let hotelMarker = null;
    let currentPolyline = null; // ì¹´ì¹´ì˜¤ ê²½ë¡œ í‘œì‹œìš©
    let airportLocationCache = null;
    let airportPlaceIdCache = null; 
    
    // [ â­ ì¶”ê°€ ] Google ê²½ë¡œ íƒìƒ‰ìš© ì „ì—­ ë³€ìˆ˜
    let directionsService;
    let directionsRenderer;

    
    /**
     * Google Maps APIê°€ ë¡œë“œëœ í›„ ì‹¤í–‰ë  ì½œë°± í•¨ìˆ˜
     */
    function initMap() {
        
        // 3. ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        hotelMapModal.addEventListener('show.bs.modal', async function (event) {
            const card = event.relatedTarget;
            const hotelId = card.dataset.hotelId;
            const hotelName = card.dataset.hotelName;
            const hotelLat = parseFloat(card.dataset.hotelLat);
            const hotelLng = parseFloat(card.dataset.hotelLng);
            
            if (isNaN(hotelLat) || isNaN(hotelLng)) {
                console.warn("ìœ„ì¹˜ ì •ë³´ê°€ ì—†ëŠ” í˜¸í…”ì…ë‹ˆë‹¤.", hotelId);
                return; 
            }
            
            const hotelLocation = { lat: hotelLat, lng: hotelLng };

            document.getElementById('hotelMapModalLabel').textContent = hotelName;
            mapInfoEl.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <span>'${airportIataCode}' ê³µí•­ ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ì¤‘...</span>
                </div>`;

            const allHotelItems = document.querySelectorAll('.modal-hotel-item');
            allHotelItems.forEach(item => {
                item.style.display = (item.dataset.hotelId === hotelId) ? 'none' : 'block';
            });

            map = new google.maps.Map(mapCanvas, {
                center: hotelLocation,
                zoom: 11,
                mapId: 'YOUR_MAP_ID' 
            });

            // [ â­ ì¶”ê°€ ] Directions Service ë° Renderer ì´ˆê¸°í™”
            // (ë§µì´ ìƒì„±ëœ ì§í›„ ì´ˆê¸°í™”)
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,                // ë Œë”ëŸ¬ë¥¼ ì§€ë„ì— ì—°ê²°
                suppressMarkers: true,   // ê¸°ë³¸ A, B ë§ˆì»¤ ìˆ¨ê¹€ (ì €í¬ ì»¤ìŠ¤í…€ ë§ˆì»¤ ì‚¬ìš©)
                preserveViewport: true   // fitBoundsë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì œì–´í•˜ê¸° ìœ„í•¨
            });

            // 4. ê³µí•­ ìœ„ì¹˜ ì°¾ê¸° (ìºì‹œ í™œìš©)
            try {
                if (airportLocationCache == null) {
                    console.log("===== [JS Debug] êµ¬ê¸€ Places APIë¡œ ê³µí•­ ìœ„ì¹˜ ìµœì´ˆ ê²€ìƒ‰...");
                    const request = {
                        textQuery: `${airportIataCode} Airport`,
                        fields: ['displayName', 'location', 'id'],
                    };
                    const { places } = await google.maps.places.Place.searchByText(request);

                    if (places && places.length > 0) {
                        airportLocationCache = places[0].location; 
                        airportPlaceIdCache = places[0].id;
                    } else {
                        throw new Error("Places APIê°€ ê³µí•­ ì •ë³´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                    }
                }

                // 5. [ â­ ìˆ˜ì • ] Google ê²½ë¡œ ìš°ì„  íƒìƒ‰
                mapInfoEl.innerHTML = `
                    <div class="d-flex align-items-center">
                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        <span>Google ê²½ë¡œ ê³„ì‚° ì¤‘...</span>
                    </div>`;
                
                // Google ìš°ì„  íƒìƒ‰ í•¨ìˆ˜ í˜¸ì¶œ
                calculateAndDisplayRoute(airportLocationCache, hotelLocation);
                
            } catch (error) {
                // (Places API ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ - í˜¸í…” ë§ˆì»¤ë§Œ í‘œì‹œ)
                console.error("Places API ê²€ìƒ‰ ì‹¤íŒ¨:", error);
                mapInfoEl.innerHTML = `<span class="text-danger">'${airportIataCode}' ê³µí•­ ìœ„ì¹˜ë¥¼ ì°¾ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</span>`;
                clearMapElements(); 
                hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: hotelLocation,
                    map: map,
                    title: "ë„ì°© í˜¸í…”"
                });
                map.setCenter(hotelLocation);
                map.setZoom(14);
            }
        }); // 'show.bs.modal' ë¦¬ìŠ¤ë„ˆ ë
        
        hotelMapModal.addEventListener('hidden.bs.modal', function () {
            mapCanvas.innerHTML = ''; 
            mapInfoEl.innerHTML = '<p class="mb-0">ê²½ë¡œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';
            clearMapElements();
            const allHotelItems = document.querySelectorAll('.modal-hotel-item');
            allHotelItems.forEach(item => {
                item.style.display = 'block';
            });
        }); // 'hidden.bs.modal' ë¦¬ìŠ¤ë„ˆ ë

    } // initMap() í•¨ìˆ˜ ë
    
    
    /**
     * [ â­ ìˆ˜ì • ] ë§ˆì»¤, ê²½ë¡œ(Polyline), Google ê²½ë¡œ(Renderer)ë¥¼ ëª¨ë‘ ì§€ìš°ëŠ” í—¬í¼ í•¨ìˆ˜
     */
    function clearMapElements() {
        if (airportMarker) {
            airportMarker.map = null; 
            airportMarker = null;     
        }
        if (hotelMarker) {
            hotelMarker.map = null; 
            hotelMarker = null;     
        }
        if (currentPolyline) { // ì¹´ì¹´ì˜¤ Polyline
            currentPolyline.setMap(null);
            currentPolyline = null;
        }
        if (directionsRenderer) { // Google Directions
            directionsRenderer.setDirections(null);
        }
    }


    /**
     * [ â­ í•µì‹¬ ìˆ˜ì • â­ ]
     * Google Directions APIë¡œ ê²½ë¡œë¥¼ ìš°ì„  íƒìƒ‰í•˜ê³ ,
     * ì‹¤íŒ¨ ì‹œ (ì˜ˆ: í•œêµ­ ë“±) ì¹´ì¹´ì˜¤ APIë¡œ ëŒ€ì²´(Fallback) íƒìƒ‰í•©ë‹ˆë‹¤.
     */
    function calculateAndDisplayRoute(googleAirportLocation, googleHotelLocation) {
        
        clearMapElements(); // ì§€ë„ ìš”ì†Œ ì´ˆê¸°í™”
        
        const googleRouteRequest = {
            origin: googleAirportLocation,
            destination: googleHotelLocation,
            travelMode: 'DRIVING'
        };

        // 1. Google Directions API ìš°ì„  ì‹œë„
        directionsService.route(googleRouteRequest, async (result, status) => {
            
            if (status === 'OK') {
                // --- 1-1. Google ê²½ë¡œ íƒìƒ‰ ì„±ê³µ ---
                console.log("===== [JS Debug] Google Directions API ê²½ë¡œ íƒìƒ‰ ì„±ê³µ =====");
                
                // Google ë Œë”ëŸ¬ë¡œ ê²½ë¡œ í‘œì‹œ
                directionsRenderer.setDirections(result);

                const route = result.routes[0].legs[0];
                const distanceText = route.distance.text;
                const durationText = route.duration.text;

                mapInfoEl.innerHTML = `
                    <h6 class="mb-2">âœˆï¸ ê³µí•­ì—ì„œ í˜¸í…”ê¹Œì§€ (Google Maps ê¸°ì¤€)</h6>
                    <p class="mb-1"><strong>ì˜ˆìƒ ê±°ë¦¬:</strong> ${distanceText}</p>
                    <p class="mb-0"><strong>ì˜ˆìƒ ì†Œìš” ì‹œê°„:</strong> ${durationText} (ì°¨ëŸ‰ ê¸°ì¤€)</p>
                `;

                // ì»¤ìŠ¤í…€ A, B ë§ˆì»¤ ìƒì„±
                const airportPin = new google.maps.marker.PinElement({ glyph: "A", background: "#4285F4", borderColor: "#000" });
                airportMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: googleAirportLocation,
                    map: map,
                    title: "ì¶œë°œ ê³µí•­",
                    content: airportPin.element
                });

                const hotelPin = new google.maps.marker.PinElement({ glyph: "B", background: "#FBBC05", borderColor: "#000" });
                hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: googleHotelLocation,
                    map: map,
                    title: "ë„ì°© í˜¸í…”",
                    content: hotelPin.element
                });
                
                // Google ê²½ë¡œì— ë§ì¶° ë·° ì¡°ì •
                map.fitBounds(result.routes[0].bounds);

            } else {
                // --- 1-2. Google ê²½ë¡œ íƒìƒ‰ ì‹¤íŒ¨ -> ì¹´ì¹´ì˜¤ APIë¡œ Fallback ---
                console.warn(`===== [JS Debug] Google Directions API ì‹¤íŒ¨ (Status: ${status}). Kakao APIë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤. =====`);
                mapInfoEl.innerHTML = `
                    <div class="d-flex align-items-center">
                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        <span>Google ê²½ë¡œ ì‹¤íŒ¨. Kakao ê²½ë¡œ ê³„ì‚° ì¤‘...</span>
                    </div>`;

                // 2. ì¹´ì¹´ì˜¤ API ëŒ€ì²´ ì‹œë„ (ê¸°ì¡´ ë¡œì§)
                const params = new URLSearchParams({
                    originLat: googleAirportLocation.lat(), 
                    originLng: googleAirportLocation.lng(),
                    destLat: googleHotelLocation.lat,
                    destLng: googleHotelLocation.lng
                });

                try {
                    const response = await fetch(`/api/kakao-directions?${params.toString()}`);

                    if (response.status === 200) { // 200 OK (ì¹´ì¹´ì˜¤ ê²½ë¡œ ì°¾ìŒ)
                        const route = await response.json(); 

                        const googlePath = route.path.map(coord => ({
                            lat: coord[1], // ì¹´ì¹´ì˜¤ëŠ” [lng, lat] ìˆœì„œ
                            lng: coord[0]
                        }));

                        // ì¹´ì¹´ì˜¤ ê²½ë¡œëŠ” Polylineìœ¼ë¡œ ì§ì ‘ ê·¸ë¦¼
                        currentPolyline = new google.maps.Polyline({
                            path: googlePath,
                            geodesic: true,
                            strokeColor: '#FF0000', // ë¹¨ê°„ìƒ‰
                            strokeOpacity: 0.8,
                            strokeWeight: 5
                        });
                        currentPolyline.setMap(map);

                        const distanceKm = (route.distance / 1000).toFixed(1); 
                        const durationMin = Math.round(route.duration / 60);   
                        
                        mapInfoEl.innerHTML = `
                            <h6 class="mb-2">âœˆï¸ ê³µí•­ì—ì„œ í˜¸í…”ê¹Œì§€ (Kakao Map ê¸°ì¤€)</h6>
                            <p class="mb-1"><strong>ì˜ˆìƒ ê±°ë¦¬:</strong> ${distanceKm} km</p>
                            <p class="mb-0"><strong>ì˜ˆìƒ ì†Œìš” ì‹œê°„:</strong> ${durationMin} ë¶„ (ì°¨ëŸ‰ ê¸°ì¤€)</p>
                        `;
                        
                        const bounds = new google.maps.LatLngBounds();
                        bounds.extend(googleAirportLocation);
                        bounds.extend(googleHotelLocation);
                        map.fitBounds(bounds);

                        // ì»¤ìŠ¤í…€ A, B ë§ˆì»¤ ìƒì„±
                        const airportPin = new google.maps.marker.PinElement({ glyph: "A", background: "#4285F4", borderColor: "#000" });
                        airportMarker = new google.maps.marker.AdvancedMarkerElement({
                            position: googleAirportLocation,
                            map: map,
                            title: "ì¶œë°œ ê³µí•­",
                            content: airportPin.element
                        });

                        const hotelPin = new google.maps.marker.PinElement({ glyph: "B", background: "#FBBC05", borderColor: "#000" });
                        hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                            position: googleHotelLocation,
                            map: map,
                            title: "ë„ì°© í˜¸í…”",
                            content: hotelPin.element
                        });

                    } else {
                        // (ì¹´ì¹´ì˜¤ ê²½ë¡œ íƒìƒ‰ ì‹¤íŒ¨. ì˜ˆ: 204 No Content)
                        throw new Error("ì¹´ì¹´ì˜¤ APIê°€ ê²½ë¡œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ZERO_RESULTS)");
                    }
                } catch (error) {
                    // --- 3. Google, Kakao ëª¨ë‘ ì‹¤íŒ¨ ---
                    // (fetch ì‹¤íŒ¨ ë˜ëŠ” ì¹´ì¹´ì˜¤ APIê°€ ê²½ë¡œë¥¼ ëª»ì°¾ì€ ê²½ìš° - ë§ˆì»¤ë§Œ í‘œì‹œ)
                    console.error('Kakao/Spring Directions request failed:', error.message);
                    mapInfoEl.innerHTML = `<span class="text-danger">Google/Kakao ê²½ë¡œ ê³„ì‚°ì— ëª¨ë‘ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</span>
                                         <p class="mb-0 mt-2 text-muted" style="font-size: 0.9rem;">ê³µí•­(A)ê³¼ í˜¸í…”(B)ì˜ ìœ„ì¹˜ë¥¼ ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤.</p>`;
                    
                    const airportPin = new google.maps.marker.PinElement({ glyph: "A" });
                    airportMarker = new google.maps.marker.AdvancedMarkerElement({
                        position: googleAirportLocation,
                        map: map,
                        title: "ì¶œë°œ ê³µí•­",
                        content: airportPin.element
                    });

                    const hotelPin = new google.maps.marker.PinElement({ glyph: "B" });
                    hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                        position: googleHotelLocation,
                        map: map,
                        title: "ë„ì°© í˜¸í…”",
                        content: hotelPin.element
                    });

                    const bounds = new google.maps.LatLngBounds();
                    bounds.extend(googleAirportLocation);
                    bounds.extend(googleHotelLocation);
                    map.fitBounds(bounds);
                }
            }
        });
    }

	/**
	 * ëª¨ë‹¬ ë‚´ë¶€ì˜ ë‹¤ë¥¸ í˜¸í…”ì„ í´ë¦­í–ˆì„ ë•Œ í˜¸ì¶œë  í•¨ìˆ˜
	 */
	async function selectOtherHotel(element) {
		const hotelId = element.dataset.hotelId;
		const hotelName = element.dataset.hotelName;
		const hotelLat = parseFloat(element.dataset.hotelLat);
		const hotelLng = parseFloat(element.dataset.hotelLng);

		if (isNaN(hotelLat) || isNaN(hotelLng)) {
			console.warn("ìœ„ì¹˜ ì •ë³´ê°€ ì—†ëŠ” í˜¸í…”ì…ë‹ˆë‹¤.");
			return;
		}
		
		const hotelLocation = { lat: hotelLat, lng: hotelLng };

		document.getElementById('hotelMapModalLabel').textContent = hotelName;

		const allHotelItems = document.querySelectorAll('.modal-hotel-item');
		allHotelItems.forEach(item => {
			item.style.display = (item.dataset.hotelId === hotelId) ? 'none' : 'block';
		});

		mapInfoEl.innerHTML = `
			<div class="d-flex align-items-center">
				<div class="spinner-border spinner-border-sm me-2" role="status"></div>
				<span>Google ê²½ë¡œ ê³„ì‚° ì¤‘...</span>
			</div>`;

        if (airportLocationCache) {
            // [ â­ ìˆ˜ì • ì—†ìŒ ]
            // ì´ í•¨ìˆ˜ëŠ” ìˆ˜ì •ëœ calculateAndDisplayRouteë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ
            // ìë™ìœ¼ë¡œ Google ìš°ì„  ë¡œì§ì´ ì ìš©ë©ë‹ˆë‹¤.
            calculateAndDisplayRoute(airportLocationCache, hotelLocation);
        } else {
            console.error("ê³µí•­ ìœ„ì¹˜ ìºì‹œê°€ ì—†ìŠµë‹ˆë‹¤.");
            mapInfoEl.innerHTML = `<span class="text-danger">'${airportIataCode}' ê³µí•­ ìœ„ì¹˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</span>`;
            
            clearMapElements();
            hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                position: hotelLocation,
                map: map,
                title: "ë„ì°© í˜¸í…”"
            });
            map.setCenter(hotelLocation);
            map.setZoom(14);
        }
	}
</script>

	<script async
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCOFhdNInfEDqaOCDqGvty5-Igh-a2y8eE&callback=initMap&libraries=places,directions,marker">
	</script>
</body>
</html>