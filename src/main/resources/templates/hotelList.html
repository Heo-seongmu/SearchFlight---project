<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>무성의 여행 - 호텔 목록</title>

<!-- 공통 헤드 (폰트, 기본 스타일 등) 가져오기 -->
<th:block th:replace="layout/header_fragment :: common-head"></th:block>

<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
.moana_gnb a {
    text-decoration: none !important;
}
    :root {
        --primary-color: #5ac4c9;
        --secondary-color: #4b9aa0;
        --text-dark: #2d3436;
        --text-light: #636e72;
    }

    body {
        margin: 0;
        background-color: #f4f7f6;
        font-family: 'Open Sans', sans-serif;
        color: var(--text-dark);
    }

    /* --- 타이틀 섹션 (이전 스타일 복원 및 개선) --- */
    .page-header {
        margin-bottom: 2.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #e9ecef;
    }
    .page-title {
        font-weight: 800;
        color: #333;
        font-size: 1.8rem;
        margin: 0;
        display: flex;
        align-items: center;
    }
    /* 이모지나 아이콘 스타일 */
    .page-title i {
        margin-right: 10px;
        color: var(--primary-color);
    }

    /* --- 화려한 호텔 카드 디자인 --- */
    .hotel-card {
        border: none;
        border-radius: 16px;
        background-color: #fff;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        overflow: hidden;
        height: 100%;
        cursor: pointer;
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .hotel-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(90, 196, 201, 0.2);
    }

    /* 카드 상단 비주얼 영역 (통일된 모던 스타일) */
    .card-visual {
        height: 120px;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 3rem;
        overflow: hidden;
        /* 브랜드 컬러 기반의 은은한 그라데이션으로 통일 */
        background: linear-gradient(135deg, #5ac4c9 0%, #3a8e94 100%);
    }
    
    /* 배경에 은은한 패턴 추가 (선택사항) */
    .card-visual::after {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background-image: radial-gradient(circle at 20% 50%, rgba(255,255,255,0.1) 0%, transparent 50%);
        pointer-events: none;
    }

    /* 글래스모피즘 별점 */
    .glass-rating {
        position: absolute;
        bottom: 12px;
        left: 15px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(5px);
        padding: 4px 10px;
        border-radius: 8px;
        color: #fff;
        font-size: 0.85rem;
        font-weight: 600;
        border: 1px solid rgba(255,255,255,0.3);
    }
    .glass-rating i { color: #ffeaa7; margin-right: 3px; }

    /* 카드 본문 */
    .card-body {
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        position: relative;
    }

    .hotel-category {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 700;
        color: #b2bec3;
        margin-bottom: 8px;
    }

    .hotel-name {
        font-size: 1.2rem;
        font-weight: 800;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        height: 3.4em; /* 2줄 높이 고정 */
    }

    .hotel-meta {
        margin-top: auto;
        padding-top: 1rem;
        border-top: 1px dashed #f1f3f5;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .meta-item {
        display: flex;
        align-items: center;
        font-size: 0.85rem;
        color: var(--text-light);
        font-weight: 600;
    }
    .meta-item i { margin-right: 6px; color: var(--primary-color); }

    /* 호버 시 나타나는 지도 아이콘 */
    .hover-action {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 36px;
        height: 36px;
        background: rgba(255,255,255,0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--secondary-color);
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .hotel-card:hover .hover-action {
        opacity: 1;
        transform: translateY(0);
    }

    /* 비활성 카드 스타일 */
    .hotel-card.disabled .card-visual {
        background: #ced6e0; /* 회색 배경 */
    }
    .hotel-card.disabled {
        opacity: 0.8;
        cursor: default;
        box-shadow: none;
    }
    .hotel-card.disabled:hover { transform: none; }

    /* --- 모달 디자인 --- */
    .modal-content {
        border-radius: 20px;
        border: none;
        overflow: hidden;
    }
    .modal-header {
        background: #fff;
        padding: 1.2rem 1.5rem;
        border-bottom: 1px solid #f1f3f5;
    }
    .modal-title-custom {
        font-weight: 800;
        font-size: 1.3rem;
        color: #333;
        display: flex;
        align-items: center;
    }
    
    #map-canvas { 
        height: 500px; 
        width: 100%; 
    }

    .modal-list-panel {
        background: #fff;
        height: 500px;
        overflow-y: auto;
        border-left: 1px solid #f1f3f5;
    }
    .modal-list-header {
        padding: 1.2rem 1.5rem;
        background: #f8f9fa;
        border-bottom: 1px solid #eee;
        position: sticky;
        top: 0;
        z-index: 5;
    }
    
    .list-item-custom {
        padding: 1rem 1.5rem;
        border: none;
        border-bottom: 1px solid #f8f9fa;
        width: 100%;
        text-align: left;
        background: #fff;
        transition: background 0.2s;
    }
    .list-item-custom:hover { background-color: #f1fcfc; }
    .list-item-custom.active { background-color: #e6f7f8; border-left: 4px solid var(--primary-color); }
    
    .list-hotel-name { font-weight: 700; font-size: 0.95rem; color: #333; margin-bottom: 4px; }
    .list-hotel-meta { font-size: 0.8rem; color: #888; display: flex; justify-content: space-between; }

    /* Floating Map Info */
    .floating-map-info {
        position: absolute;
        top: 15px;
        left: 15px;
        right: 15px;
        background: rgba(255,255,255,0.95);
        padding: 12px 16px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        z-index: 10;
        backdrop-filter: blur(4px);
    }

    @media (max-width: 992px) {
        .modal-list-panel { height: 300px; border-left: none; border-top: 1px solid #eee; }
        #map-canvas { height: 350px; }
    }
</style>
</head>
<body>
    <!-- 공통 헤더 적용 -->
	<header th:replace="layout/header_fragment :: common-header(activeMenu='home')"></header>

	<main class="container py-5">
        
        <!-- 타이틀 섹션 (요청하신 대로 이전 문구 및 스타일 적용) -->
        <div class="page-header">
            <h2 class="page-title">
                 ✈️ 근처 호텔 목록
            </h2>
        </div>

		<!-- 에러 메시지 -->
		<div th:if="${errorMessage}" class="alert alert-danger rounded-4 shadow-sm text-center" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
			<span th:text="${errorMessage}">오류 메시지</span>
		</div>

		<!-- 결과 없음 -->
		<div th:if="${#strings.isEmpty(errorMessage) and #lists.isEmpty(hotelList)}"
			class="alert alert-info rounded-4 shadow-sm text-center py-5" role="alert">
            <div class="mb-3"><i class="bi bi-geo-alt-fill fs-1 text-info"></i></div>
            <h5 class="fw-bold text-dark">호텔을 찾을 수 없습니다.</h5>
			<span class="text-muted" th:text="'도착지(' + ${param.destination} + ') 반경 10KM 이내의 호텔 정보가 없습니다.'"></span>
		</div>

        <!-- 호텔 리스트 그리드 -->
		<div class="row g-4"> 
			<div class="col-12 col-md-6 col-lg-4 col-xl-3" th:each="hotel : ${hotelList}">

                <!-- 1. 활성 카드 (위치 정보 있음) -->
				<div class="hotel-card"
					th:if="${hotel.geoCode != null}"
					th:data-hotel-id="${hotel.hotelId}"
					th:data-hotel-name="${hotel.koreanName}"
					th:data-hotel-lat="${hotel.geoCode.latitude}"
					th:data-hotel-lng="${hotel.geoCode.longitude}"
					data-bs-toggle="modal" data-bs-target="#hotelMapModal">

                    <!-- 상단 비주얼 영역 (알록달록 제거 -> 통일된 모던 스타일) -->
                    <div class="card-visual">
                        <i class="bi bi-building"></i>
                        
                        <!-- 별점 배지 -->
                        <div class="glass-rating">
                            <i class="bi bi-star-fill"></i> 5.0
                        </div>
                        
                        <!-- 호버 시 나타나는 지도 아이콘 -->
                        <div class="hover-action">
                            <i class="bi bi-map-fill"></i>
                        </div>
                    </div>

					<div class="card-body">
                        <div class="hotel-category">HOTEL</div>
                        <!-- 호텔 이름 -->
                        <h5 class="hotel-name" th:text="${hotel.koreanName}">Grand Hyatt Incheon</h5>
                        
                        <div class="hotel-meta">
                            <div class="meta-item" title="거리">
                                <i class="bi bi-geo-alt-fill"></i>
                                <span th:text="${hotel.distance.value} + ' ' + ${hotel.distance.unit}">1.2 KM</span>
                            </div>
                            <div class="meta-item" title="ID">
                                <span class="text-muted fw-normal" style="font-size: 0.75rem;">ID: </span>
                                <span th:text="${hotel.hotelId}">ABC1234</span>
                            </div>
                        </div>
					</div>
				</div>

                <!-- 2. 비활성 카드 (위치 정보 없음) -->
				<div class="hotel-card disabled" th:if="${hotel.geoCode == null}">
                    <div class="card-visual">
                        <i class="bi bi-building-slash text-white-50"></i>
                    </div>

					<div class="card-body">
                        <div class="hotel-category">UNAVAILABLE</div>
						<h5 class="hotel-name text-muted" th:text="${hotel.koreanName}">Unknown Hotel</h5>

                        <div class="hotel-meta">
                            <div class="meta-item text-muted">
                                <i class="bi bi-geo-alt text-secondary"></i>
                                <span th:text="${hotel.distance.value} + ' ' + ${hotel.distance.unit}">0.92 KM</span>
                            </div>
                            <div class="meta-item text-danger">
                                <i class="bi bi-x-circle me-1"></i> 위치 정보 없음
                            </div>
                        </div>
					</div>
				</div>

			</div>
		</div>
	</main>

    <!-- 모달 -->
	<div class="modal fade" id="hotelMapModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-xl modal-dialog-centered" style="max-width: 1100px;">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title-custom" id="hotelMapModalLabel">
                        <i class="bi bi-buildings me-2 text-primary"></i> 호텔 위치 상세
                    </h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>

				<div class="modal-body">
					<div class="row g-0">
                        <!-- 지도 영역 -->
						<div class="col-lg-8 position-relative">
                            <div id="map-info" class="floating-map-info">
								<p class="mb-0 fw-bold"><span class="spinner-border spinner-border-sm text-primary me-2"></span>경로 정보를 불러오는 중입니다...</p>
							</div>
							<div id="map-canvas"></div>
						</div>

                        <!-- 우측 리스트 패널 -->
						<div class="col-lg-4 modal-list-panel">
							<div class="modal-list-header">
                                <h6 class="fw-bold mb-0 text-dark">주변 다른 호텔</h6>
                            </div>
							<div id="modal-hotel-list">
								<div th:each="otherHotel : ${hotelList}">
									<button type="button"
										class="list-item-custom modal-hotel-item"
										th:data-hotel-id="${otherHotel.hotelId}"
										th:data-hotel-name="${otherHotel.koreanName}"
										th:data-hotel-lat="${otherHotel.geoCode?.latitude}"
										th:data-hotel-lng="${otherHotel.geoCode?.longitude}"
										onclick="selectOtherHotel(this); return false;">

                                        <div class="list-hotel-name" th:text="${otherHotel.koreanName}">호텔 이름</div>
                                        <div class="list-hotel-meta">
                                            <span th:if="${otherHotel.distance != null}">
                                                <i class="bi bi-geo-alt-fill text-secondary me-1"></i>
                                                <span th:text="${otherHotel.distance.value} + ${otherHotel.distance.unit}">1.2KM</span>
                                            </span>
                                            <span class="text-warning"><i class="bi bi-star-fill"></i> 5.0</span>
                                        </div>
									</button>
								</div>
                                
								<div th:if="${#lists.isEmpty(hotelList)}" class="text-center py-5 text-muted">
                                    주변 호텔이 없습니다.
                                </div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>

    <!-- 스크립트 로직 (이전 기능 100% 유지) -->
	<script>
    let map;
    const airportIataCode = "[[${param.destination}]]";
    const hotelMapModal = document.getElementById('hotelMapModal');
    const mapCanvas = document.getElementById('map-canvas');
    const mapInfoEl = document.getElementById('map-info');
    
    let airportMarker = null;
    let hotelMarker = null;
    let currentPolyline = null; 
    let airportLocationCache = null;
    let airportPlaceIdCache = null; 
    
    let directionsService;
    let directionsRenderer;

    function initMap() {
        hotelMapModal.addEventListener('show.bs.modal', async function (event) {
            const card = event.relatedTarget;
            const hotelId = card.dataset.hotelId;
            const hotelName = card.dataset.hotelName;
            const hotelLat = parseFloat(card.dataset.hotelLat);
            const hotelLng = parseFloat(card.dataset.hotelLng);
            
            if (isNaN(hotelLat) || isNaN(hotelLng)) {
                console.warn("위치 정보가 없는 호텔입니다.", hotelId);
                return; 
            }
            
            const hotelLocation = { lat: hotelLat, lng: hotelLng };

            document.getElementById('hotelMapModalLabel').innerHTML = `<i class="bi bi-geo-alt-fill text-danger me-2"></i>${hotelName}`;
            mapInfoEl.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-2 text-primary" role="status"></div>
                    <span>'${airportIataCode}' 공항 위치를 찾는 중...</span>
                </div>`;

            const allHotelItems = document.querySelectorAll('.modal-hotel-item');
            allHotelItems.forEach(item => {
                if(item.dataset.hotelId === hotelId) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });

            map = new google.maps.Map(mapCanvas, {
                center: hotelLocation,
                zoom: 11,
                mapId: 'YOUR_MAP_ID', 
                disableDefaultUI: false,
                zoomControl: true,
                mapTypeControl: false,
                streetViewControl: true
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,                
                suppressMarkers: true,   
                preserveViewport: true   
            });

            try {
                if (airportLocationCache == null) {
                    const request = {
                        textQuery: `${airportIataCode} Airport`,
                        fields: ['displayName', 'location', 'id'],
                    };
                    const { places } = await google.maps.places.Place.searchByText(request);

                    if (places && places.length > 0) {
                        airportLocationCache = places[0].location; 
                        airportPlaceIdCache = places[0].id;
                    } else {
                        throw new Error("Places API가 공항 정보를 찾지 못했습니다.");
                    }
                }

                mapInfoEl.innerHTML = `
                    <div class="d-flex align-items-center">
                        <div class="spinner-border spinner-border-sm me-2 text-primary" role="status"></div>
                        <span>Google 경로 계산 중...</span>
                    </div>`;
                
                calculateAndDisplayRoute(airportLocationCache, hotelLocation);
                
            } catch (error) {
                console.error("Places API 검색 실패:", error);
                mapInfoEl.innerHTML = `<span class="text-danger"><i class="bi bi-exclamation-circle me-1"></i>'${airportIataCode}' 공항 위치를 찾는 데 실패했습니다.</span>`;
                clearMapElements(); 
                hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: hotelLocation,
                    map: map,
                    title: "도착 호텔"
                });
                map.setCenter(hotelLocation);
                map.setZoom(14);
            }
        }); 
        
        hotelMapModal.addEventListener('hidden.bs.modal', function () {
            mapCanvas.innerHTML = ''; 
            mapInfoEl.innerHTML = '<p class="mb-0">경로 정보를 불러오는 중입니다...</p>';
            clearMapElements();
            const allHotelItems = document.querySelectorAll('.modal-hotel-item');
            allHotelItems.forEach(item => {
                item.classList.remove('active');
            });
        }); 

    } 
    
    function clearMapElements() {
        if (airportMarker) {
            airportMarker.map = null; 
            airportMarker = null;     
        }
        if (hotelMarker) {
            hotelMarker.map = null; 
            hotelMarker = null;     
        }
        if (currentPolyline) { 
            currentPolyline.setMap(null);
            currentPolyline = null;
        }
        if (directionsRenderer) { 
            directionsRenderer.setDirections(null);
        }
    }

    function calculateAndDisplayRoute(googleAirportLocation, googleHotelLocation) {
        
        clearMapElements(); 
        
        const googleRouteRequest = {
            origin: googleAirportLocation,
            destination: googleHotelLocation,
            travelMode: 'DRIVING'
        };

        directionsService.route(googleRouteRequest, async (result, status) => {
            
            if (status === 'OK') {
                directionsRenderer.setDirections(result);

                const route = result.routes[0].legs[0];
                const distanceText = route.distance.text;
                const durationText = route.duration.text;

                mapInfoEl.innerHTML = `
                    <h6 class="text-primary fw-bold mb-1"><i class="bi bi-google me-1"></i>공항 ↔ 호텔 (Google Maps)</h6>
                    <div class="d-flex justify-content-between small text-dark">
                        <span><strong>거리:</strong> ${distanceText}</span>
                        <span><strong>시간:</strong> ${durationText} (차량)</span>
                    </div>
                `;

                const airportPin = new google.maps.marker.PinElement({ glyph: "A", background: "#4285F4", borderColor: "#fff", glyphColor: "white" });
                airportMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: googleAirportLocation,
                    map: map,
                    title: "출발 공항",
                    content: airportPin.element
                });

                const hotelPin = new google.maps.marker.PinElement({ glyph: "B", background: "#FBBC05", borderColor: "#fff", glyphColor: "white" });
                hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: googleHotelLocation,
                    map: map,
                    title: "도착 호텔",
                    content: hotelPin.element
                });
                
                map.fitBounds(result.routes[0].bounds);

            } else {
                mapInfoEl.innerHTML = `
                    <div class="d-flex align-items-center">
                        <div class="spinner-border spinner-border-sm me-2 text-warning" role="status"></div>
                        <span>Google 경로 실패. Kakao 경로 계산 중...</span>
                    </div>`;

                const params = new URLSearchParams({
                    originLat: googleAirportLocation.lat(), 
                    originLng: googleAirportLocation.lng(),
                    destLat: googleHotelLocation.lat,
                    destLng: googleHotelLocation.lng
                });

                try {
                    const response = await fetch(`/api/kakao-directions?${params.toString()}`);

                    if (response.status === 200) { 
                        const route = await response.json(); 

                        const googlePath = route.path.map(coord => ({
                            lat: coord[1], 
                            lng: coord[0]
                        }));

                        currentPolyline = new google.maps.Polyline({
                            path: googlePath,
                            geodesic: true,
                            strokeColor: '#FEE500', 
                            strokeOpacity: 1.0,
                            strokeWeight: 6
                        });
                        currentPolyline.setMap(map);

                        const distanceKm = (route.distance / 1000).toFixed(1); 
                        const durationMin = Math.round(route.duration / 60);   
                        
                        mapInfoEl.innerHTML = `
                            <h6 class="fw-bold mb-1" style="color:#3c1e1e;"><i class="bi bi-chat-fill text-warning me-1"></i>공항 ↔ 호텔 (Kakao Map)</h6>
                            <div class="d-flex justify-content-between small text-dark">
                                <span><strong>거리:</strong> ${distanceKm} km</span>
                                <span><strong>시간:</strong> ${durationMin} 분 (차량)</span>
                            </div>
                        `;
                        
                        const bounds = new google.maps.LatLngBounds();
                        bounds.extend(googleAirportLocation);
                        bounds.extend(googleHotelLocation);
                        map.fitBounds(bounds);

                        const airportPin = new google.maps.marker.PinElement({ glyph: "A", background: "#4285F4", borderColor: "#fff" });
                        airportMarker = new google.maps.marker.AdvancedMarkerElement({
                            position: googleAirportLocation,
                            map: map,
                            title: "출발 공항",
                            content: airportPin.element
                        });

                        const hotelPin = new google.maps.marker.PinElement({ glyph: "B", background: "#FBBC05", borderColor: "#fff" });
                        hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                            position: googleHotelLocation,
                            map: map,
                            title: "도착 호텔",
                            content: hotelPin.element
                        });

                    } else {
                        throw new Error("카카오 API가 경로를 찾지 못했습니다. (ZERO_RESULTS)");
                    }
                } catch (error) {
                    console.error('Kakao/Spring Directions request failed:', error.message);
                    mapInfoEl.innerHTML = `<span class="text-danger"><i class="bi bi-x-circle-fill me-1"></i>경로 계산에 모두 실패했습니다.</span>
                                         <p class="mb-0 mt-1 text-muted small">직선 위치만 표시합니다.</p>`;
                    
                    const airportPin = new google.maps.marker.PinElement({ glyph: "A" });
                    airportMarker = new google.maps.marker.AdvancedMarkerElement({
                        position: googleAirportLocation,
                        map: map,
                        title: "출발 공항",
                        content: airportPin.element
                    });

                    const hotelPin = new google.maps.marker.PinElement({ glyph: "B" });
                    hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                        position: googleHotelLocation,
                        map: map,
                        title: "도착 호텔",
                        content: hotelPin.element
                    });

                    const bounds = new google.maps.LatLngBounds();
                    bounds.extend(googleAirportLocation);
                    bounds.extend(googleHotelLocation);
                    map.fitBounds(bounds);
                }
            }
        });
    }

	async function selectOtherHotel(element) {
		const hotelId = element.dataset.hotelId;
		const hotelName = element.dataset.hotelName;
		const hotelLat = parseFloat(element.dataset.hotelLat);
		const hotelLng = parseFloat(element.dataset.hotelLng);

		if (isNaN(hotelLat) || isNaN(hotelLng)) {
			console.warn("위치 정보가 없는 호텔입니다.");
			return;
		}
		
		const hotelLocation = { lat: hotelLat, lng: hotelLng };

		document.getElementById('hotelMapModalLabel').innerHTML = `<i class="bi bi-geo-alt-fill text-danger me-2"></i>${hotelName}`;

		const allHotelItems = document.querySelectorAll('.modal-hotel-item');
		allHotelItems.forEach(item => {
            if (item.dataset.hotelId === hotelId) {
                item.classList.add('active');
            } else {
                item.classList.remove('active');
            }
		});

		mapInfoEl.innerHTML = `
			<div class="d-flex align-items-center">
				<div class="spinner-border spinner-border-sm me-2 text-primary" role="status"></div>
				<span>경로 재계산 중...</span>
			</div>`;

        if (airportLocationCache) {
            calculateAndDisplayRoute(airportLocationCache, hotelLocation);
        } else {
            console.error("공항 위치 캐시가 없습니다.");
            mapInfoEl.innerHTML = `<span class="text-danger">'${airportIataCode}' 공항 위치 정보가 없습니다.</span>`;
            
            clearMapElements();
            hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                position: hotelLocation,
                map: map,
                title: "도착 호텔"
            });
            map.setCenter(hotelLocation);
            map.setZoom(14);
        }
	}
</script>

	<script async
    src="https://maps.googleapis.com/maps/api/js?key=your_key&callback=initMap&libraries=places,marker&loading=async">
</script>
</body>
</html>
