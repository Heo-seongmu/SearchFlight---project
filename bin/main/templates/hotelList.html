<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>λ¬΄μ„±μ μ—¬ν–‰ - νΈν…” λ©λ΅</title>

<!-- κ³µν†µ ν—¤λ“ (ν°νΈ, κΈ°λ³Έ μ¤νƒ€μΌ λ“±) κ°€μ Έμ¤κΈ° -->
<th:block th:replace="layout/header_fragment :: common-head"></th:block>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
/* [μμ •λ¨] ν—¤λ”(.moana_gnb λ“±) κ΄€λ ¨ μ¤νƒ€μΌμ€ λ¨λ‘ μ‚­μ ν–μµλ‹λ‹¤. 
   μ΄μ  common-headμ—μ„ μ¤νƒ€μΌμ„ κ°€μ Έμ¤λ―€λ΅ μ¶©λν•μ§€ μ•μµλ‹λ‹¤. */

/* νμ΄μ§€ μ „μ²΄ λ°°κ²½μƒ‰ (ν•­κ³µκ¶ νμ΄μ§€μ™€ ν†µμΌ) */
body {
	margin: 0;
	background-color: #f8f9fa; 
}

/* --- νΈν…” λ¦¬μ¤νΈ νμ΄μ§€ μ „μ© μ¤νƒ€μΌ --- */

/* ν΄λ¦­ κ°€λ¥ν• νΈν…” μΉ΄λ“μ— μ»¤μ„ μ¤νƒ€μΌ μ μ© */
.hotel-card-clickable {
    transition: all 0.2s ease-in-out;
}

.hotel-card-clickable:hover {
	border-color: #5ac4c9; /* νΈλ²„ μ‹ ν…λ‘λ¦¬ μƒ‰μƒ λ³€κ²½ */
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1); /* κ·Έλ¦Όμ ν¨κ³Ό */
    transform: translateY(-2px); /* μ‚΄μ§ μ„λ΅ */
}

/* λ³„ 5κ° ν‘μ‹μ© CSS */
.five-stars {
	color: #fdcc0d; /* λ³„ν‘(μ±„μ›μ§„) μƒ‰μƒ */
	font-size: 1.1rem;
}
</style>
</head>
<body>
    <!-- κ³µν†µ ν—¤λ” μ μ© (activeMenu='home') -->
	<header th:replace="layout/header_fragment :: common-header(activeMenu='home')"></header>

	<main class="container py-5">
		<h2 class="mb-4 fw-bold">βοΈ κ·Όμ² νΈν…” λ©λ΅</h2>

		<div th:if="${errorMessage}" class="alert alert-danger" role="alert">
			<span th:text="${errorMessage}">μ¤λ¥ λ©”μ‹μ§€</span>
		</div>

		<div
			th:if="${#strings.isEmpty(errorMessage) and #lists.isEmpty(hotelList)}"
			class="alert alert-info" role="alert">
			<span
				th:text="'λ„μ°©μ§€(' + ${param.destination} + ') κ·Όμ² 10KM μ΄λ‚΄μ νΈν…” μ •λ³΄λ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤.'">
				νΈν…” μ •λ³΄κ°€ μ—†μµλ‹λ‹¤. </span>
		</div>

		<div class="row g-3">
			<div class="col-12 col-md-6" th:each="hotel : ${hotelList}">

				<div class="card h-100 hotel-card-clickable"
					th:if="${hotel.geoCode != null}"
					th:data-hotel-id="${hotel.hotelId}"
					th:data-hotel-name="${hotel.koreanName}"
					th:data-hotel-lat="${hotel.geoCode.latitude}"
					th:data-hotel-lng="${hotel.geoCode.longitude}"
					data-bs-toggle="modal" data-bs-target="#hotelMapModal"
					style="cursor: pointer;">

					<div class="card-body">
						<h5 class="card-title fw-bold" th:text="${hotel.koreanName}">νΈν…”
							μ΄λ¦„</h5>

						<div class="mb-2 five-stars">
							<i class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i> <i
								class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i> <i
								class="bi bi-star-fill"></i>
						</div>

						<p class="card-text mb-2">
							<small class="text-muted" th:text="'ID: ' + ${hotel.hotelId}">ID:
								ZZNCENVX</small>
						</p>
						<span class="badge bg-primary"
							th:text="'μ•½ ' + ${hotel.distance.value} + ' ' + ${hotel.distance.unit}">
							0.92 KM </span>

						<div class="mt-2 text-muted" style="font-size: 0.8rem;"
							th:if="${hotel.geoCode != null}">
							(μ„λ„: <span th:text="${hotel.geoCode.latitude}"></span>, κ²½λ„: <span
								th:text="${hotel.geoCode.longitude}"></span>)
						</div>
					</div>
				</div>

				<div class="card h-100" th:if="${hotel.geoCode == null}">
					<div class="card-body">
						<h5 class="card-title fw-bold" th:text="${hotel.koreanName}">νΈν…”
							μ΄λ¦„</h5>

						<div class="mb-2 five-stars">
							<i class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i> <i
								class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i> <i
								class="bi bi-star-fill"></i>
						</div>

						<p class="card-text mb-2">
							<small class="text-muted" th:text="'ID: ' + ${hotel.hotelId}">ID:
								ZZNCENVX</small>
						</p>
						<span class="badge bg-primary"
							th:text="'μ•½ ' + ${hotel.distance.value} + ' ' + ${hotel.distance.unit}">
							0.92 KM </span>
						<div class="mt-2 text-muted" style="font-size: 0.8rem;">(μ„μΉ
							μ •λ³΄ μ—†μ)</div>
					</div>
				</div>

			</div>
		</div>
	</main>

	<div class="modal fade" id="hotelMapModal" tabindex="-1"
		aria-labelledby="hotelMapModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="hotelMapModalLabel">νΈν…” μ„μΉ</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>

				<div class="modal-body">
					<div class="row">
						<div class="col-md-8">
							<div id="map-canvas" style="height: 400px; width: 100%;"></div>

							<div id="map-info" class="mt-3 p-3 bg-light rounded">
								<p class="mb-0">κ²½λ΅ μ •λ³΄λ¥Ό λ¶λ¬μ¤λ” μ¤‘μ…λ‹λ‹¤...</p>
							</div>
						</div>

						<div class="col-md-4">
							<h6 class="mb-3">π¨ λ‹¤λ¥Έ μ£Όλ³€ νΈν…”</h6>
							<div id="modal-hotel-list" class="list-group list-group-flush"
								style="max-height: 400px; overflow-y: auto;">

								<div th:each="otherHotel : ${hotelList}">
									<a href="#"
										class="list-group-item list-group-item-action py-2 modal-hotel-item"
										th:data-hotel-id="${otherHotel.hotelId}"
										th:data-hotel-name="${otherHotel.koreanName}"
										th:data-hotel-lat="${otherHotel.geoCode?.latitude}"
										th:data-hotel-lng="${otherHotel.geoCode?.longitude}"
										onclick="selectOtherHotel(this); return false;">

										<h6 class="mb-1" th:text="${otherHotel.koreanName}">λ‹¤λ¥Έ νΈν…”
											μ΄λ¦„</h6>

										<div class="mb-1 five-stars" style="font-size: 0.9rem;">
											<i class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i>
											<i class="bi bi-star-fill"></i> <i class="bi bi-star-fill"></i>
											<i class="bi bi-star-fill"></i>
										</div> <small class="text-muted"
										th:if="${otherHotel.distance != null}"
										th:text="'μ•½ ' + ${otherHotel.distance.value} + ' ' + ${otherHotel.distance.unit}">0.92
											KM</small> <small class="text-muted"
										th:if="${otherHotel.geoCode == null}">(μ„μΉμ •λ³΄ μ—†μ)</small>
									</a>
								</div>

								<div th:if="${#lists.isEmpty(hotelList)}"
									class="text-muted text-center py-3">μ£Όλ³€ νΈν…”μ΄ μ—†μµλ‹λ‹¤.</div>
							</div>
						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">λ‹«κΈ°</button>
				</div>
			</div>
		</div>
	</div>

	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>

	<script>
    // 1. μ „μ—­ λ³€μλ΅ μ„ μ–Έ
    let map;
    const airportIataCode = "[[${param.destination}]]";
    const hotelMapModal = document.getElementById('hotelMapModal');
    const mapCanvas = document.getElementById('map-canvas');
    const mapInfoEl = document.getElementById('map-info');
    
    let airportMarker = null;
    let hotelMarker = null;
    let currentPolyline = null; // μΉ΄μΉ΄μ¤ κ²½λ΅ ν‘μ‹μ©
    let airportLocationCache = null;
    let airportPlaceIdCache = null; 
    
    // [ β­ μ¶”κ°€ ] Google κ²½λ΅ νƒμƒ‰μ© μ „μ—­ λ³€μ
    let directionsService;
    let directionsRenderer;

    
    /**
     * Google Maps APIκ°€ λ΅λ“λ ν›„ μ‹¤ν–‰λ  μ½λ°± ν•¨μ
     */
    function initMap() {
        
        // 3. λ¨λ‹¬ μ΄λ²¤νΈ λ¦¬μ¤λ„
        hotelMapModal.addEventListener('show.bs.modal', async function (event) {
            const card = event.relatedTarget;
            const hotelId = card.dataset.hotelId;
            const hotelName = card.dataset.hotelName;
            const hotelLat = parseFloat(card.dataset.hotelLat);
            const hotelLng = parseFloat(card.dataset.hotelLng);
            
            if (isNaN(hotelLat) || isNaN(hotelLng)) {
                console.warn("μ„μΉ μ •λ³΄κ°€ μ—†λ” νΈν…”μ…λ‹λ‹¤.", hotelId);
                return; 
            }
            
            const hotelLocation = { lat: hotelLat, lng: hotelLng };

            document.getElementById('hotelMapModalLabel').textContent = hotelName;
            mapInfoEl.innerHTML = `
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <span>'${airportIataCode}' κ³µν•­ μ„μΉλ¥Ό μ°Ύλ” μ¤‘...</span>
                </div>`;

            const allHotelItems = document.querySelectorAll('.modal-hotel-item');
            allHotelItems.forEach(item => {
                item.style.display = (item.dataset.hotelId === hotelId) ? 'none' : 'block';
            });

            map = new google.maps.Map(mapCanvas, {
                center: hotelLocation,
                zoom: 11,
                mapId: 'YOUR_MAP_ID' 
            });

            // [ β­ μ¶”κ°€ ] Directions Service λ° Renderer μ΄κΈ°ν™”
            // (λ§µμ΄ μƒμ„±λ μ§ν›„ μ΄κΈ°ν™”)
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,                // λ λ”λ¬λ¥Ό μ§€λ„μ— μ—°κ²°
                suppressMarkers: true,   // κΈ°λ³Έ A, B λ§μ»¤ μ¨κΉ€ (μ €ν¬ μ»¤μ¤ν…€ λ§μ»¤ μ‚¬μ©)
                preserveViewport: true   // fitBoundsλ¥Ό μλ™μΌλ΅ μ μ–΄ν•κΈ° μ„ν•¨
            });

            // 4. κ³µν•­ μ„μΉ μ°ΎκΈ° (μΊμ‹ ν™μ©)
            try {
                if (airportLocationCache == null) {
                    console.log("===== [JS Debug] κµ¬κΈ€ Places APIλ΅ κ³µν•­ μ„μΉ μµμ΄ κ²€μƒ‰...");
                    const request = {
                        textQuery: `${airportIataCode} Airport`,
                        fields: ['displayName', 'location', 'id'],
                    };
                    const { places } = await google.maps.places.Place.searchByText(request);

                    if (places && places.length > 0) {
                        airportLocationCache = places[0].location; 
                        airportPlaceIdCache = places[0].id;
                    } else {
                        throw new Error("Places APIκ°€ κ³µν•­ μ •λ³΄λ¥Ό μ°Ύμ§€ λ»ν–μµλ‹λ‹¤.");
                    }
                }

                // 5. [ β­ μμ • ] Google κ²½λ΅ μ°μ„  νƒμƒ‰
                mapInfoEl.innerHTML = `
                    <div class="d-flex align-items-center">
                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        <span>Google κ²½λ΅ κ³„μ‚° μ¤‘...</span>
                    </div>`;
                
                // Google μ°μ„  νƒμƒ‰ ν•¨μ νΈμ¶
                calculateAndDisplayRoute(airportLocationCache, hotelLocation);
                
            } catch (error) {
                // (Places API κ²€μƒ‰ μ‹¤ν¨ μ‹ - νΈν…” λ§μ»¤λ§ ν‘μ‹)
                console.error("Places API κ²€μƒ‰ μ‹¤ν¨:", error);
                mapInfoEl.innerHTML = `<span class="text-danger">'${airportIataCode}' κ³µν•­ μ„μΉλ¥Ό μ°Ύλ” λ° μ‹¤ν¨ν–μµλ‹λ‹¤.</span>`;
                clearMapElements(); 
                hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: hotelLocation,
                    map: map,
                    title: "λ„μ°© νΈν…”"
                });
                map.setCenter(hotelLocation);
                map.setZoom(14);
            }
        }); // 'show.bs.modal' λ¦¬μ¤λ„ λ
        
        hotelMapModal.addEventListener('hidden.bs.modal', function () {
            mapCanvas.innerHTML = ''; 
            mapInfoEl.innerHTML = '<p class="mb-0">κ²½λ΅ μ •λ³΄λ¥Ό λ¶λ¬μ¤λ” μ¤‘μ…λ‹λ‹¤...</p>';
            clearMapElements();
            const allHotelItems = document.querySelectorAll('.modal-hotel-item');
            allHotelItems.forEach(item => {
                item.style.display = 'block';
            });
        }); // 'hidden.bs.modal' λ¦¬μ¤λ„ λ

    } // initMap() ν•¨μ λ
    
    
    /**
     * [ β­ μμ • ] λ§μ»¤, κ²½λ΅(Polyline), Google κ²½λ΅(Renderer)λ¥Ό λ¨λ‘ μ§€μ°λ” ν—¬νΌ ν•¨μ
     */
    function clearMapElements() {
        if (airportMarker) {
            airportMarker.map = null; 
            airportMarker = null;     
        }
        if (hotelMarker) {
            hotelMarker.map = null; 
            hotelMarker = null;     
        }
        if (currentPolyline) { // μΉ΄μΉ΄μ¤ Polyline
            currentPolyline.setMap(null);
            currentPolyline = null;
        }
        if (directionsRenderer) { // Google Directions
            directionsRenderer.setDirections(null);
        }
    }


    /**
     * [ β­ ν•µμ‹¬ μμ • β­ ]
     * Google Directions APIλ΅ κ²½λ΅λ¥Ό μ°μ„  νƒμƒ‰ν•κ³ ,
     * μ‹¤ν¨ μ‹ (μ: ν•κµ­ λ“±) μΉ΄μΉ΄μ¤ APIλ΅ λ€μ²΄(Fallback) νƒμƒ‰ν•©λ‹λ‹¤.
     */
    function calculateAndDisplayRoute(googleAirportLocation, googleHotelLocation) {
        
        clearMapElements(); // μ§€λ„ μ”μ† μ΄κΈ°ν™”
        
        const googleRouteRequest = {
            origin: googleAirportLocation,
            destination: googleHotelLocation,
            travelMode: 'DRIVING'
        };

        // 1. Google Directions API μ°μ„  μ‹λ„
        directionsService.route(googleRouteRequest, async (result, status) => {
            
            if (status === 'OK') {
                // --- 1-1. Google κ²½λ΅ νƒμƒ‰ μ„±κ³µ ---
                console.log("===== [JS Debug] Google Directions API κ²½λ΅ νƒμƒ‰ μ„±κ³µ =====");
                
                // Google λ λ”λ¬λ΅ κ²½λ΅ ν‘μ‹
                directionsRenderer.setDirections(result);

                const route = result.routes[0].legs[0];
                const distanceText = route.distance.text;
                const durationText = route.duration.text;

                mapInfoEl.innerHTML = `
                    <h6 class="mb-2">βοΈ κ³µν•­μ—μ„ νΈν…”κΉμ§€ (Google Maps κΈ°μ¤€)</h6>
                    <p class="mb-1"><strong>μμƒ κ±°λ¦¬:</strong> ${distanceText}</p>
                    <p class="mb-0"><strong>μμƒ μ†μ” μ‹κ°„:</strong> ${durationText} (μ°¨λ‰ κΈ°μ¤€)</p>
                `;

                // μ»¤μ¤ν…€ A, B λ§μ»¤ μƒμ„±
                const airportPin = new google.maps.marker.PinElement({ glyph: "A", background: "#4285F4", borderColor: "#000" });
                airportMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: googleAirportLocation,
                    map: map,
                    title: "μ¶λ° κ³µν•­",
                    content: airportPin.element
                });

                const hotelPin = new google.maps.marker.PinElement({ glyph: "B", background: "#FBBC05", borderColor: "#000" });
                hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                    position: googleHotelLocation,
                    map: map,
                    title: "λ„μ°© νΈν…”",
                    content: hotelPin.element
                });
                
                // Google κ²½λ΅μ— λ§μ¶° λ·° μ΅°μ •
                map.fitBounds(result.routes[0].bounds);

            } else {
                // --- 1-2. Google κ²½λ΅ νƒμƒ‰ μ‹¤ν¨ -> μΉ΄μΉ΄μ¤ APIλ΅ Fallback ---
                console.warn(`===== [JS Debug] Google Directions API μ‹¤ν¨ (Status: ${status}). Kakao APIλ΅ λ€μ²΄ν•©λ‹λ‹¤. =====`);
                mapInfoEl.innerHTML = `
                    <div class="d-flex align-items-center">
                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                        <span>Google κ²½λ΅ μ‹¤ν¨. Kakao κ²½λ΅ κ³„μ‚° μ¤‘...</span>
                    </div>`;

                // 2. μΉ΄μΉ΄μ¤ API λ€μ²΄ μ‹λ„ (κΈ°μ΅΄ λ΅μ§)
                const params = new URLSearchParams({
                    originLat: googleAirportLocation.lat(), 
                    originLng: googleAirportLocation.lng(),
                    destLat: googleHotelLocation.lat,
                    destLng: googleHotelLocation.lng
                });

                try {
                    const response = await fetch(`/api/kakao-directions?${params.toString()}`);

                    if (response.status === 200) { // 200 OK (μΉ΄μΉ΄μ¤ κ²½λ΅ μ°Ύμ)
                        const route = await response.json(); 

                        const googlePath = route.path.map(coord => ({
                            lat: coord[1], // μΉ΄μΉ΄μ¤λ” [lng, lat] μμ„
                            lng: coord[0]
                        }));

                        // μΉ΄μΉ΄μ¤ κ²½λ΅λ” PolylineμΌλ΅ μ§μ ‘ κ·Έλ¦Ό
                        currentPolyline = new google.maps.Polyline({
                            path: googlePath,
                            geodesic: true,
                            strokeColor: '#FF0000', // λΉ¨κ°„μƒ‰
                            strokeOpacity: 0.8,
                            strokeWeight: 5
                        });
                        currentPolyline.setMap(map);

                        const distanceKm = (route.distance / 1000).toFixed(1); 
                        const durationMin = Math.round(route.duration / 60);   
                        
                        mapInfoEl.innerHTML = `
                            <h6 class="mb-2">βοΈ κ³µν•­μ—μ„ νΈν…”κΉμ§€ (Kakao Map κΈ°μ¤€)</h6>
                            <p class="mb-1"><strong>μμƒ κ±°λ¦¬:</strong> ${distanceKm} km</p>
                            <p class="mb-0"><strong>μμƒ μ†μ” μ‹κ°„:</strong> ${durationMin} λ¶„ (μ°¨λ‰ κΈ°μ¤€)</p>
                        `;
                        
                        const bounds = new google.maps.LatLngBounds();
                        bounds.extend(googleAirportLocation);
                        bounds.extend(googleHotelLocation);
                        map.fitBounds(bounds);

                        // μ»¤μ¤ν…€ A, B λ§μ»¤ μƒμ„±
                        const airportPin = new google.maps.marker.PinElement({ glyph: "A", background: "#4285F4", borderColor: "#000" });
                        airportMarker = new google.maps.marker.AdvancedMarkerElement({
                            position: googleAirportLocation,
                            map: map,
                            title: "μ¶λ° κ³µν•­",
                            content: airportPin.element
                        });

                        const hotelPin = new google.maps.marker.PinElement({ glyph: "B", background: "#FBBC05", borderColor: "#000" });
                        hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                            position: googleHotelLocation,
                            map: map,
                            title: "λ„μ°© νΈν…”",
                            content: hotelPin.element
                        });

                    } else {
                        // (μΉ΄μΉ΄μ¤ κ²½λ΅ νƒμƒ‰ μ‹¤ν¨. μ: 204 No Content)
                        throw new Error("μΉ΄μΉ΄μ¤ APIκ°€ κ²½λ΅λ¥Ό μ°Ύμ§€ λ»ν–μµλ‹λ‹¤. (ZERO_RESULTS)");
                    }
                } catch (error) {
                    // --- 3. Google, Kakao λ¨λ‘ μ‹¤ν¨ ---
                    // (fetch μ‹¤ν¨ λλ” μΉ΄μΉ΄μ¤ APIκ°€ κ²½λ΅λ¥Ό λ»μ°Ύμ€ κ²½μ° - λ§μ»¤λ§ ν‘μ‹)
                    console.error('Kakao/Spring Directions request failed:', error.message);
                    mapInfoEl.innerHTML = `<span class="text-danger">Google/Kakao κ²½λ΅ κ³„μ‚°μ— λ¨λ‘ μ‹¤ν¨ν–μµλ‹λ‹¤.</span>
                                         <p class="mb-0 mt-2 text-muted" style="font-size: 0.9rem;">κ³µν•­(A)κ³Ό νΈν…”(B)μ μ„μΉλ¥Ό μ§€λ„μ— ν‘μ‹ν•©λ‹λ‹¤.</p>`;
                    
                    const airportPin = new google.maps.marker.PinElement({ glyph: "A" });
                    airportMarker = new google.maps.marker.AdvancedMarkerElement({
                        position: googleAirportLocation,
                        map: map,
                        title: "μ¶λ° κ³µν•­",
                        content: airportPin.element
                    });

                    const hotelPin = new google.maps.marker.PinElement({ glyph: "B" });
                    hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                        position: googleHotelLocation,
                        map: map,
                        title: "λ„μ°© νΈν…”",
                        content: hotelPin.element
                    });

                    const bounds = new google.maps.LatLngBounds();
                    bounds.extend(googleAirportLocation);
                    bounds.extend(googleHotelLocation);
                    map.fitBounds(bounds);
                }
            }
        });
    }

	/**
	 * λ¨λ‹¬ λ‚΄λ¶€μ λ‹¤λ¥Έ νΈν…”μ„ ν΄λ¦­ν–μ„ λ• νΈμ¶λ  ν•¨μ
	 */
	async function selectOtherHotel(element) {
		const hotelId = element.dataset.hotelId;
		const hotelName = element.dataset.hotelName;
		const hotelLat = parseFloat(element.dataset.hotelLat);
		const hotelLng = parseFloat(element.dataset.hotelLng);

		if (isNaN(hotelLat) || isNaN(hotelLng)) {
			console.warn("μ„μΉ μ •λ³΄κ°€ μ—†λ” νΈν…”μ…λ‹λ‹¤.");
			return;
		}
		
		const hotelLocation = { lat: hotelLat, lng: hotelLng };

		document.getElementById('hotelMapModalLabel').textContent = hotelName;

		const allHotelItems = document.querySelectorAll('.modal-hotel-item');
		allHotelItems.forEach(item => {
			item.style.display = (item.dataset.hotelId === hotelId) ? 'none' : 'block';
		});

		mapInfoEl.innerHTML = `
			<div class="d-flex align-items-center">
				<div class="spinner-border spinner-border-sm me-2" role="status"></div>
				<span>Google κ²½λ΅ κ³„μ‚° μ¤‘...</span>
			</div>`;

        if (airportLocationCache) {
            // [ β­ μμ • μ—†μ ]
            // μ΄ ν•¨μλ” μμ •λ calculateAndDisplayRouteλ¥Ό νΈμ¶ν•λ―€λ΅
            // μλ™μΌλ΅ Google μ°μ„  λ΅μ§μ΄ μ μ©λ©λ‹λ‹¤.
            calculateAndDisplayRoute(airportLocationCache, hotelLocation);
        } else {
            console.error("κ³µν•­ μ„μΉ μΊμ‹κ°€ μ—†μµλ‹λ‹¤.");
            mapInfoEl.innerHTML = `<span class="text-danger">'${airportIataCode}' κ³µν•­ μ„μΉ μ •λ³΄κ°€ μ—†μµλ‹λ‹¤.</span>`;
            
            clearMapElements();
            hotelMarker = new google.maps.marker.AdvancedMarkerElement({
                position: hotelLocation,
                map: map,
                title: "λ„μ°© νΈν…”"
            });
            map.setCenter(hotelLocation);
            map.setZoom(14);
        }
	}
</script>

	<script async
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCOFhdNInfEDqaOCDqGvty5-Igh-a2y8eE&callback=initMap&libraries=places,directions,marker">
	</script>
</body>
</html>