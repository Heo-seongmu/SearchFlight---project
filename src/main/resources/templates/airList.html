<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>ë¬´ì„±ì˜ ì—¬í–‰ - í•­ê³µê¶Œ ì„ íƒ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link
	href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800"
	rel="stylesheet">

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style type="text/css">
/* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ìƒ‰ìƒ */
.moana_gnb {
	background-color: #5ac4c9; /* ì²« ë²ˆì§¸ ì´ë¯¸ì§€ì˜ í•˜ëŠ˜ìƒ‰ ë°°ê²½ */
	color: #fff; /* ê¸°ë³¸ ê¸€ììƒ‰ í°ìƒ‰ */
	padding: 10px 0; /* ìƒí•˜ íŒ¨ë”© */
}
 
.gnb_container {
	max-width: 1200px; /* ì ì ˆí•œ ìµœëŒ€ ë„ˆë¹„ ì„¤ì • (Gë§ˆì¼“ ìŠ¤íƒ€ì¼) */
	margin: 0 auto; /* ê°€ìš´ë° ì •ë ¬ */
	display: flex; /* ë‚´ë¶€ ìš”ì†Œë“¤ì„ ê°€ë¡œë¡œ ì •ë ¬í•˜ê¸° ìœ„í•´ flexbox ì‚¬ìš© */
	align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
	justify-content: space-between; /* ìš”ì†Œë“¤ ê°„ì˜ ê³µê°„ ë°°ë¶„ */
	padding: 0 20px; /* ì¢Œìš° íŒ¨ë”© */
}

.moana_gnb h1 {
	margin: 0;
	display: flex;
	align-items: center;
}

.box__inner h1 a {
	color: #fff; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ (í—¤ë”ì™€ ë™ì¼í•œ í°ìƒ‰) */
	text-decoration: none; /* ë§í¬ ë°‘ì¤„ ì œê±° */
	font-size: 22px; /* í°íŠ¸ í¬ê¸° (ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì ˆí•˜ì„¸ìš”) */
	font-weight: bold; /* í°íŠ¸ êµµê¸° */
}

.list__tab {
	list-style: none;
	margin: 0;
	padding: 0;
	display: flex;
	gap: 20px;
}

.list__tab .list-item a {
	color: #fff;
	text-decoration: none;
	font-weight: bold;
	padding: 5px 0;
	position: relative;
	transition: color 0.3s ease;
}

.list__tab .list-item a:hover, .list__tab .list-item a.link__tab--active
	{
	color: #eee;
}

.list__tab .list-item a.link__tab--active::after {
	content: '';
	position: absolute;
	left: 0;
	bottom: -5px;
	width: 100%;
	height: 2px;
	background-color: #fff;
}

.link-container {
	display: flex;
	align-items: center;
	gap: 10px;
}

.link__booking-history {
	background-color: transparent;
	border: 1px solid #fff;
	color: #fff;
	padding: 8px 15px;
	border-radius: 20px;
	text-decoration: none;
	font-size: 14px;
	transition: background-color 0.3s ease, color 0.3s ease;
	white-space: nowrap;
}

.link__booking-history:hover {
	background-color: #fff;
	color: #5ac4c9;
}

.box__inner {
	display: flex;
	align-items: center;
	gap: 20px;
}

body {
	margin: 0;
}

body {
	background-color: #f8f9fa; /* ì „ì²´ í˜ì´ì§€ ë°°ê²½ìƒ‰ì„ ì—°í•œ íšŒìƒ‰ìœ¼ë¡œ ì„¤ì • */
}

/* ì™¼ìª½ í•„í„° ì¹´ë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.filter-card-button {
	text-align: left;
	width: 100%;
	border: 1px solid #dee2e6;
	border-radius: 0.375rem;
	background-color: #fff;
	padding: 1.25rem;
	transition: box-shadow .15s ease-in-out;
}

.filter-card-button:hover {
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

/* ê° í•­ê³µí¸ ì¹´ë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.flight-card-button {
	text-align: left;
	border-width: 1px;
	transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
}

.flight-card-button:hover {
	border-color: #5ac4c9;
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
}

.flight-card-button .card-body {
	padding: 1.5rem;
}

.airline-logo {
	width: 20px;
	height: 20px;
	object-fit: contain;
	margin-right: 8px;
}

.price-display {
	font-size: 1.5rem;
	font-weight: 700;
	letter-spacing: -1px;
}

.special-tag {
	color: #d91f29;
	font-size: 0.8rem;
	font-weight: bold;
}

.nol-card {
	background-image: linear-gradient(to right, #6d42ba, #c95193);
	color: white;
	border: none;
}

.nol-card .nol-logo {
	font-weight: bold;
	font-style: italic;
	border: 2px solid white;
	padding: 2px 8px;
	border-radius: 4px;
	display: inline-block;
}

.flight-search-form .form-label {
	display: block;
	font-size: 0.875rem;
	color: #6c757d; /* ì—°í•œ íšŒìƒ‰ ê¸€ì”¨ */
	margin-bottom: 0.3rem;
}

/* íƒ­ ë©”ë‰´ (ì™•ë³µ, í¸ë„) */
.flight-search-form .nav-tabs {
	border-bottom: 1px solid #dee2e6;
}

.flight-search-form .nav-tabs .nav-link-label {
	padding: 0.5rem 0.8rem;
	cursor: pointer;
	border-bottom: 3px solid transparent;
	color: #6c757d;
	margin-bottom: -1px; /* ì•„ë˜ í…Œë‘ë¦¬ì™€ ê²¹ì¹˜ê²Œ í•¨ */
}

.flight-search-form input[type="radio"]:checked+.nav-link-label {
	border-color: #0d6efd; /* íŒŒë€ìƒ‰ */
	color: #0d6efd;
	font-weight: 500;
}

/* ì¶œë°œì§€, ë„ì°©ì§€, ë‚ ì§œ, íƒ‘ìŠ¹ê° ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ (inputì²˜ëŸ¼ ë³´ì´ê²Œ) */
.flight-search-form .form-control-like-button {
	display: block;
	width: 100%;
	padding: 0.6rem 0.9rem;
	font-size: 1rem;
	font-weight: 400;
	line-height: 1.5;
	color: #212529;
	background-color: #fff;
	border: 1px solid #ced4da;
	border-radius: 0.375rem;
	text-align: left;
	transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
}

.flight-search-form .form-control-like-button:hover {
	border-color: #86b7fe; /* í¬ì»¤ìŠ¤ ì‹œ íŒŒë€ìƒ‰ í…Œë‘ë¦¬ */
}

/* ì¶œë°œì§€, ë„ì°©ì§€ ë²„íŠ¼ ì „ìš© ìŠ¤íƒ€ì¼ */
#modalDepartureBtn, #modalArrivalBtn {
	text-align: center;
	font-weight: bold;
	font-size: 1.25rem;
}

/* ê²€ìƒ‰í•˜ê¸° ë²„íŠ¼ */
.flight-search-form .btn-submit {
	padding-top: 0.8rem;
	padding-bottom: 0.8rem;
	font-size: 1.1rem;
	font-weight: bold;
}

.swap-button {
	border: 1px solid #ddd;
	border-radius: 50%;
	width: 32px;
	height: 32px;
	min-width: 32px;
	display: flex;
	justify-content: center;
	align-items: center;
	font-size: 16px;
	color: #555;
	flex-grow: 0;
}

.modal-overlay {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.4); /* ë°°ê²½ì„ ì•½ê°„ ì–´ë‘¡ê²Œ ìˆ˜ì • */
	justify-content: center;
	align-items: center;
	z-index: 1060; /* ë¶€íŠ¸ìŠ¤íŠ¸ë© ëª¨ë‹¬ ìœ„ë¡œ ì˜¤ë„ë¡ z-index ì¡°ì • */
}

.modal-overlay .modal-content {
	background-color: white;
	padding: 24px;
	border-radius: 16px;
	box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
	width: 400px;
	max-height: 80vh;
	overflow-y: auto;
	position: relative;
}

.modal-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 20px;
}

.modal-header h2 {
	margin: 0;
	font-size: 20px;
}

.close-button {
	background: none;
	border: none;
	font-size: 24px;
	cursor: pointer;
}

.modal-search-input {
	width: 100%;
	padding: 12px;
	border: 1px solid #ddd;
	border-radius: 8px;
	font-size: 16px;
	box-sizing: border-box;
	margin-bottom: 24px;
}

.popular-searches h3 {
	font-size: 16px;
	color: #555;
	margin-top: 20px;
	margin-bottom: 12px;
}

.tags-container {
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
}

.tag {
	background-color: #f0f0f0;
	color: #333;
	padding: 8px 16px;
	border-radius: 20px;
	font-size: 14px;
	cursor: pointer;
	transition: background-color 0.2s;
}

.tag:hover {
	background-color: #e0e0e0;
}

.search-result-item {
	padding: 10px 5px;
	cursor: pointer;
	border-bottom: 1px solid #f0f0f0;
}

.search-result-item:hover {
	background-color: #f5f5f5;
}

.location-main {
	font-weight: bold;
	font-size: 16px;
}

.location-sub {
	font-size: 14px;
	color: #888;
}

.no-results {
	padding: 20px;
	text-align: center;
	color: #999;
}
/* ğŸš€ ë‹¬ë ¥ì´ ëª¨ë‹¬ ìœ„ì— í‘œì‹œë˜ë„ë¡ z-index ì¶”ê°€ */
.flatpickr-calendar {
	z-index: 1061 !important;
}

/* --- íƒ‘ìŠ¹ê° ëª¨ë‹¬ CSS --- */
.passenger-section, .seat-class-section {
	margin-bottom: 24px;
}

.passenger-section h4, .seat-class-section h4 {
	margin-top: 0;
	margin-bottom: 12px;
	font-size: 16px;
	color: #333;
}

.passenger-row {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 16px;
}

.passenger-label small {
	color: #888;
	font-size: 12px;
}

.passenger-controls {
	display: flex;
	align-items: center;
	gap: 15px;
}

.passenger-controls .count {
	font-size: 18px;
	width: 25px;
	text-align: center;
}

.control-btn {
	width: 32px;
	height: 32px;
	border-radius: 50%;
	border: 1px solid #ddd;
	background-color: white;
	font-size: 20px;
	cursor: pointer;
	color: #3d5aee;
}

.control-btn:disabled {
	color: #ccc;
	cursor: not-allowed;
}

.seat-class-options {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 10px;
}

.seat-class-options label {
	display: flex;
	align-items: center;
	gap: 5px;
	font-size: 14px;
}

.confirm-btn {
	width: 100%;
	padding: 14px;
	background-color: #3d5aee;
	color: white;
	border: none;
	border-radius: 8px;
	font-size: 16px;
	font-weight: bold;
	cursor: pointer;
}

#loadingModal {
	display: none; /* í‰ì†Œì—ëŠ” ìˆ¨ê²¨ ë‘  */
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.6);
	z-index: 2000; /* ë‹¤ë¥¸ ìš”ì†Œë“¤ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
	justify-content: center;
	align-items: center;
	flex-direction: column;
	color: white;
}

.spinner {
	width: 50px;
	height: 50px;
	border: 5px solid #f3f3f3;
	border-top: 5px solid #5ac4c9; /* í—¤ë” ìƒ‰ìƒê³¼ í†µì¼ */
	border-radius: 50%;
	animation: spin 1s linear infinite;
	margin-bottom: 20px;
}

#loadingModal p {
	font-size: 18px;
	font-weight: bold;
}

/* ìŠ¤í”¼ë„ˆ íšŒì „ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes spin { 
    0% {
	    transform: rotate(0deg);
    }
    100% {
	    transform: rotate(360deg);
    }
}

.booking-details-section h5 {
	margin-bottom: 0.25rem;
}

.booking-details-section small {
	font-size: 0.9rem;
}

.modal-footer {
	justify-content: space-between;
}

#finalBookingBtn {
	width: 60%;
	font-weight: bold;
}

/* --- [ìƒˆë¡œ ì¶”ê°€] ì˜ˆì•½ ë‹¨ê³„ í‘œì‹œ (Progress Bar) --- */
.step-icon {
	width: 36px;
	height: 36px;
	border-radius: 50%;
	background-color: #e9ecef; /* ì—°í•œ íšŒìƒ‰ */
	color: #6c757d; /* í…ìŠ¤íŠ¸ ì˜…ì€ ìƒ‰ */
	display: flex;
	align-items: center;
	justify-content: center;
	font-weight: bold;
	margin: 0 auto 8px auto; /* ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ì‚¬ì´ ê°„ê²© */
}

.step-icon-active {
	background-color: #5ac4c9; /* í—¤ë”ì˜ ë©”ì¸ ì»¬ëŸ¬ */
	color: #fff;
}

.step-connector {
	flex-grow: 1; /* ìŠ¤í… ì‚¬ì´ì˜ ê³µê°„ì„ ì±„ì›€ */
	height: 3px;
	background-color: #e9ecef; /* ì—°í•œ íšŒìƒ‰ */
	margin-top: 16px; /* (ì•„ì´ì½˜ ë†’ì´ 36px / 2) - (ì„  ë†’ì´ 3px / 2) = 16.5px */
	margin-left: 1rem;
	margin-right: 1rem;
}
/* --- [ì—¬ê¸°ê¹Œì§€] --- */
</style>
</head>
<body>
	<div class="moana_gnb" role="complementary">
		<div class="gnb_container">
			<div class="box__inner">
				<h1>
					<a href="/">ë¬´ì„±ì˜ ì—¬í–‰</a>
				</h1>
			</div>

			<ul class="list__tab">
				<li class="list-item"><a class="link__tab" href="/">í•­ê³µ</a></li>
				<li class="list-item"><a class="link__tab" href="/chat">ì¶”ì²œì±—</a></li>
			</ul>

			<div class="link-container">
				<a href="/revList" class="link__booking-history sp_sd--after"
					th:if="${session.loginUser != null}">ë‚˜ì˜ ì˜ˆì•½ë‚´ì—­</a> <a
					th:if="${session.loginUser == null}"
					class="link__booking-history sp_sd--after" href="/member/login">ë¡œê·¸ì¸</a>
				<a th:if="${session.loginUser != null}"
					th:text="${session.loginUser.UserName}"
					class="link__booking-history sp_sd--after">í—ˆì„±ë¬´</a> <a
					th:if="${session.loginUser != null}"
					class="link__booking-history sp_sd--after" href="/member/logout">ë¡œê·¸ì•„ì›ƒ</a>
			</div>
		</div>
	</div>

	<main class="container py-5">

		<div class="card shadow-sm mb-4">
			<div class="card-body p-4">
				<div class="d-flex justify-content-between align-items-start">

					<div class="text-center">
						<div class="step-icon step-icon-active">1</div>
						<div class="fw-bold text-primary small">í•­ê³µ ì„ íƒ</div>
					</div>

					<div class="step-connector"></div>

					<div class="text-center">
						<div class="step-icon">2</div>
						<div class="text-muted small">íƒ‘ìŠ¹ê° ì •ë³´</div>
					</div>

					<div class="step-connector"></div>

					<div class="text-center">
						<div class="step-icon">3</div>
						<div class="text-muted small">ì˜ˆì•½</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row g-4">

			<div class="col-lg-3">
				<div class="vstack gap-3">
					<button class="filter-card-button" data-bs-toggle="modal"
						data-bs-target="#researchModal"
						th:data-trip-type="${airparmDto.tripType}"
						th:data-departure-code="${airparmDto.departureCode}"
						th:data-arrival-code="${airparmDto.arrivalCode}"
						th:data-departure-date="${airparmDto.departureDate}"
						th:data-return-date="${airparmDto.returnDate}"
						th:data-adults="${airparmDto.adults}"
						th:data-children="${airparmDto.children}"
						th:data-infants="${airparmDto.infants}"
						th:data-travel-class="${airparmDto.travelClass}"
						th:data-departure-ko-location="${airparmDto.departureKoLocation}"
						th:data-arrival-ko-location="${airparmDto.arrivalKoLocation}">
						<div
							class="d-flex justify-content-between align-items-center mb-2">
							<span
								class="badge bg-primary-subtle text-primary-emphasis rounded-pill"
								th:if="${airparmDto.tripType} == 'round-trip'" th:text="ì™•ë³µ">ì™•ë³µ</span>
							<span
								class="badge bg-primary-subtle text-primary-emphasis rounded-pill"
								th:if="${airparmDto.tripType} == 'one-way'" th:text="í¸ë„">ì™•ë³µ</span>
						</div>

						<h5 class="fw-bold mb-1"
							th:text="${airparmDto.departureCode + ' â†” ' + airparmDto.arrivalCode}">
							ì œì£¼ â†” ì˜¤ì‚¬ì¹´ <i class="bi bi-chevron-down"></i>
						</h5>
						<h4 class="fw-bold mb-1"
							th:text="${'('+airparmDto.departureKoLocation + ' â†” ' + airparmDto.arrivalKoLocation + ')'}">
							ì œì£¼ â†” ì˜¤ì‚¬ì¹´ <i class="bi bi-chevron-down"></i>
						</h4>

						<small class="text-body-secondary"
							th:if="${#strings.isEmpty(#strings.trim(airparmDto.returnDate))}"
							th:text="${airparmDto.departureDate}">11.6(ëª©) - 11.8(í† )</small> <small
							class="text-body-secondary"
							th:if="${not #strings.isEmpty(#strings.trim(airparmDto.returnDate))}"
							th:text="${airparmDto.departureDate} + '~' + ${airparmDto.returnDate}">11.6(ëª©)
							- 11.8(í† )</small> <br> <small class="text-body-secondary"
							th:text="'ì„±ì¸ ' + ${airparmDto.adults} + ' ì–´ë¦°ì´ ' + ${airparmDto.children} + ' ìœ ì•„ '
							 + ${airparmDto.infants} + ' Â· ' + ${airparmDto.travelClass} +' class'">ì„±ì¸
							1 Â· ì¼ë°˜ì„</small>
					</button>
				</div>
			</div>

			<div class="col-lg-9">
				<h4 class="fw-bold">ê°€ëŠ”í¸ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</h4>
				<p class="text-body-secondary mb-4">ì„±ì¸ 1ì¸ ê¸°ì¤€, ë°œê¶ŒëŒ€í–‰ìˆ˜ìˆ˜ë£Œ í¬í•¨</p>

				<div class="vstack gap-3" th:each="searchAir : ${searchairDto}">
					<button class="card flight-card-button w-100"
						th:data-offer-id="${searchAir.id}"
						th:data-departure-time="${searchAir.departureTime}"
						th:data-carrier-code="${searchAir.carrierCode}"
						th:data-departure-code="${airparmDto.departureCode}"
						th:data-arrival-code="${airparmDto.arrivalCode}"
						th:data-departure-date="${airparmDto.departureDate}"
						th:data-return-date="${airparmDto.returnDate}"
						th:data-adults="${airparmDto.adults}"
						th:data-children="${airparmDto.children}"
						th:data-infants="${airparmDto.infants}"
						th:data-travel-class="${airparmDto.travelClass}"
						th:data-arrival-time="${searchAir.arrivalTime}"
						th:data-total-price="${searchAir.rawTotalPrice}"
						th:data-origin-code="${searchAir.departureCode}"
						th:data-destination-code="${searchAir.arrivalCode}"
						th:data-departure-ko-location="${airparmDto.departureKoLocation}"
						th:data-arrival-ko-location="${airparmDto.arrivalKoLocation}"
						onclick="openReturnFlightModal(this)">
						<div class="card-body">
							<div class="row align-items-center">
								<div class="col-md-5">
									<small class="text-body-secondary"
										th:text="${searchAir.numberOfBookableSeats} + 'ì„ ê°€ëŠ¥'">7ì„
										ë‚¨ìŒ</small>
									<div class="d-flex align-items-center mt-1">
										<div>
											<h6 class="fw-bold mb-0"
												th:text="${searchAir.departureTime} + ' - ' + ${searchAir.arrivalTime}">16:00
												- 17:40</h6>
											<small class="text-body-secondary"
												th:text="${searchAir.departureCode} + ' â†’ ' + ${searchAir.arrivalCode} + ' Â· ' + ${searchAir.carrierCode} + ' í•­ê³µ'">CJU-KIX
												Â· í‹°ì›¨ì´í•­ê³µ</small>
										</div>
									</div>
								</div>
								<div class="col-md-3 text-md-end">
									<span class="fw-bold"
										th:text="${searchAir.directFlight ? 'ì§í•­' : 'ê²½ìœ '}">ì§í•­</span>
								</div>
								<div class="col-md-4 text-md-end">
									<span class="price-display"
										th:text="${#numbers.formatInteger(searchAir.rawTotalPrice, 0, 'COMMA')} + 'ì›'">292,050ì›</span>
								</div>
							</div>
							<hr>
						</div>
					</button>
					<br>
				</div>
			</div>
		</div>
	</main>

	<div class="modal fade" id="researchModal" tabindex="-1"
		aria-labelledby="researchModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="researchModalLabel">ì¬ê²€ìƒ‰</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form action="/air/searchAirport" method="POST"
						class="flight-search-form">

						<div class="d-flex nav-tabs mb-4">
							<div>
								<input type="radio" name="tripType" value="round-trip"
									id="modal-round-trip" checked style="display: none;"> <label
									for="modal-round-trip" class="nav-link-label">ì™•ë³µ</label>
							</div>
							<div>
								<input type="radio" name="tripType" value="one-way"
									id="modal-one-way" style="display: none;"> <label
									for="modal-one-way" class="nav-link-label">í¸ë„</label>
							</div>
						</div>

						<div class="d-flex align-items-end justify-content-between mb-4">
							<div class="flex-grow-1">
								<label for="modalDepartureBtn" class="form-label">ì¶œë°œì§€</label>
								<button type="button" id="modalDepartureBtn"
									class="form-control-like-button">SEL</button>
							</div>
							<button type="button" class="swap-button">â†”</button>
							<div class="flex-grow-1">
								<label for="modalArrivalBtn" class="form-label">ë„ì°©ì§€</label>
								<button type="button" id="modalArrivalBtn"
									class="form-control-like-button">CJU</button>
							</div>
						</div>

						<div class="mb-4">
							<label for="modalDateRangeBtn" class="form-label">ë‚ ì§œ</label>
							<button type="button" id="modalDateRangeBtn"
								class="form-control-like-button">2025-10-13 ~
								2025-10-14</button>
						</div>

						<div class="mb-4">
							<label for="passengerBtn" class="form-label">íƒ‘ìŠ¹ê°</label>
							<button type="button" id="passengerBtn"
								class="form-control-like-button">ì„±ì¸ 1 ì–´ë¦°ì´ 0 ìœ ì•„ 0 Â·
								ECONOMY class</button>
						</div>

						<input type="hidden" name="departureCode"
							id="modalDepartureCodeInput"> <input type="hidden"
							name="arrivalCode" id="modalArrivalCodeInput"> <input
							type="hidden" name="departureDate" id="modalDepartureDateInput">
						<input type="hidden" name="returnDate" id="modalReturnDateInput">
						<input type="hidden" name="adults" id="adultsInput"> <input
							type="hidden" name="children" id="childrenInput"> <input
							type="hidden" name="infants" id="infantsInput"> <input
							type="hidden" name="travelClass" id="travelClassInput"> <input
							type="hidden" name="departureKoLocation"
							id="modalDepartureKoLocationInput"> <input type="hidden"
							name="arrivalKoLocation" id="modalArrivalKoLocationInput">

						<div class="d-grid mt-2">
							<button type="submit" class="btn btn-primary btn-lg btn-submit">ê²€ìƒ‰í•˜ê¸°</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>



	<div class="modal fade" id="returnFlightListModal" tabindex="-1"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-scrollable modal-xl">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">ì˜¤ëŠ” í¸ í•­ê³µê¶Œì„ ì„ íƒí•´ì£¼ì„¸ìš”</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div id="modal-return-flight-list">
						<div class="d-flex justify-content-center">
							<div class="spinner-border" role="status">
								<span class="visually-hidden">Loading...</span>
							</div>
							<p class="ms-3">ì˜¤ëŠ” í¸ í•­ê³µê¶Œì„ ì¡°íšŒì¤‘ì…ë‹ˆë‹¤...</p>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">ë‹«ê¸°</button>
				</div>
			</div>
		</div>
	</div>

	<div id="locationModal" class="modal-overlay">
		<div class="modal-content">
			<div class="modal-header">
				<h2 id="modalTitle">ì¶œë°œì§€ ì„ íƒ</h2>
				<button id="closeModalBtn" class="close-button">&times;</button>
			</div>
			<input type="text" id="searchAir" class="modal-search-input"
				placeholder="êµ­ê°€, ë„ì‹œ ë˜ëŠ” ê³µí•­ìœ¼ë¡œ ì°¾ì•„ë³´ì„¸ìš”">
			<div class="popular-searches">
				<h3>êµ­ë‚´ ì¸ê¸° ê²€ìƒ‰</h3>
				<div class="tags-container">
					<span class="tag" data-iata="ICN">ì„œìš¸/ì¸ì²œ</span> <span class="tag"
						data-iata="CJU">ì œì£¼</span> <span class="tag" data-iata="PUS">ë¶€ì‚°</span>
					<span class="tag" data-iata="GMP">ì„œìš¸/ê¹€í¬</span> <span class="tag"
						data-iata="RSU">ì—¬ìˆ˜</span>
				</div>
				<h3>ë™ë‚¨ì•„ ì¸ê¸° ê²€ìƒ‰</h3>
				<div class="tags-container">
					<span class="tag" data-iata="DAD">ë‹¤ë‚­</span> <span class="tag"
						data-iata="BKK">ë°©ì½•</span> <span class="tag" data-iata="TPE">íƒ€ì´í˜ì´</span>
					<span class="tag" data-iata="HKG">í™ì½©</span> <span class="tag"
						data-iata="DPS">ë°œë¦¬</span>
				</div>
				<h3>ì¼ë³¸ ì¸ê¸° ê²€ìƒ‰</h3>
				<div class="tags-container">
					<span class="tag" data-iata="NRT">ë„ì¿„/ë‚˜ë¦¬íƒ€</span> <span class="tag"
						data-iata="KIX">ì˜¤ì‚¬ì¹´</span> <span class="tag" data-iata="FUK">í›„ì¿ ì˜¤ì¹´</span>
					<span class="tag" data-iata="CTS">ì‚¿í¬ë¡œ/ì‚°ì¹˜í† ì„¸</span> <span class="tag"
						data-iata="OKA">ì˜¤í‚¤ë‚˜ì™€</span>
				</div>
				<h3>ìœ ëŸ½ ì¸ê¸° ê²€ìƒ‰</h3>
				<div class="tags-container">
					<span class="tag" data-iata="CDG">íŒŒë¦¬</span> <span class="tag"
						data-iata="LHR">ëŸ°ë˜</span> <span class="tag" data-iata="FCO">ë¡œë§ˆ</span>
					<span class="tag" data-iata="MAD">ë§ˆë“œë¦¬ë“œ</span> <span class="tag"
						data-iata="BCN">ë°”ë¥´ì…€ë¡œë‚˜</span>
				</div>
				<h3>ë¶ë¯¸ ë° ê¸°íƒ€</h3>
				<div class="tags-container">
					<span class="tag" data-iata="JEK">ë‰´ìš•</span> <span class="tag"
						data-iata="SYD">ì‹œë“œë‹ˆ</span> <span class="tag" data-iata="LAX">ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤</span>
					<span class="tag" data-iata="SFO">ìƒŒí”„ë€ì‹œìŠ¤ì½”</span> <span class="tag"
						data-iata="GUM">ê´Œ</span>
				</div>
			</div>
		</div>
	</div>

	<div id="passengerModal" class="modal-overlay">
		<div class="modal-content">
			<div class="modal-header">
				<h2>ì¸ì› ë° ì¢Œì„ ë“±ê¸‰</h2>
				<button class="close-button">&times;</button>
			</div>

			<div class="passenger-section">
				<h4>ì¸ì›</h4>
				<div class="passenger-row" data-type="adult">
					<div class="passenger-label">
						<div>ì„±ì¸</div>
						<small>ë§Œ 12ì„¸ ì´ìƒ</small>
					</div>
					<div class="passenger-controls">
						<button type="button" class="control-btn minus" disabled>-</button>
						<span class="count">1</span>
						<button type="button" class="control-btn plus">+</button>
					</div>
				</div>
				<div class="passenger-row" data-type="child">
					<div class="passenger-label">
						<div>ì†Œì•„</div>
						<small>ë§Œ 2~12ì„¸ ë¯¸ë§Œ</small>
					</div>
					<div class="passenger-controls">
						<button type="button" class="control-btn minus" disabled>-</button>
						<span class="count">0</span>
						<button type="button" class="control-btn plus">+</button>
					</div>
				</div>
				<div class="passenger-row" data-type="infant">
					<div class="passenger-label">
						<div>ìœ ì•„</div>
						<small>ë§Œ 2ì„¸ ë¯¸ë§Œ (ë³´í˜¸ìì™€ ë™ë°˜ ì°©ì„)</small>
					</div>
					<div class="passenger-controls">
						<button type="button" class="control-btn minus" disabled>-</button>
						<span class="count">0</span>
						<button type="button" class="control-btn plus">+</button>
					</div>
				</div>
			</div>

			<div class="seat-class-section">
				<h4>ì¢Œì„ë“±ê¸‰</h4>
				<div class="seat-class-options">
					<label><input type="radio" name="travelClassModal"
						value="ECONOMY" checked> ì¼ë°˜ì„</label> <label><input
						type="radio" name="travelClassModal" value="PREMIUM_ECONOMY">
						í”„ë¦¬ë¯¸ì—„ ì¼ë°˜ì„</label> <label><input type="radio"
						name="travelClassModal" value="BUSINESS"> ë¹„ì¦ˆë‹ˆìŠ¤ì„</label> <label><input
						type="radio" name="travelClassModal" value="FIRST"> ì¼ë“±ì„</label>
				</div>
			</div>

			<button type="button" id="confirmPassengerBtn" class="confirm-btn">ì„ íƒ
				ì™„ë£Œ</button>
		</div>
	</div>

	<div id="loadingModal">
		<div class="spinner"></div>
		<p>í•­ê³µê¶Œì„ ì¬ê²€ìƒ‰ì¤‘ì…ë‹ˆë‹¤...</p>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>

	<script>
    // 1. ìŠ¤í¬ë¦½íŠ¸ ìƒë‹¨ì— ì‚¬ìš©í•  ëª¨ë‹¬ ê°ì²´ë“¤ì„ ë¯¸ë¦¬ ì •ì˜í•©ë‹ˆë‹¤.
    const returnModal = new bootstrap.Modal(document.getElementById('returnFlightListModal'));
    
    // (PsgInfo í˜ì´ì§€ë¡œ ë°”ë¡œ ì´ë™í•˜ë¯€ë¡œ confirmationModal, hotelPromptModalì€ ì´ í˜ì´ì§€ì—ì„œ í•„ìš” ì—†ìŠµë‹ˆë‹¤)
    
    
    // [ â­ï¸ ì¶”ê°€ â­ï¸ ] í¼ ìƒì„±ì„ ìœ„í•œ í—¬í¼ í•¨ìˆ˜
    function createHiddenInput(form, name, value) {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        input.value = value;
        form.appendChild(input);
    }
    

    // [ â­ï¸ 'ê°€ëŠ” í¸' ì„ íƒ ì‹œ â­ï¸ ] 'ì˜¤ëŠ” í¸' ëª©ë¡ì„ ë„ìš°ëŠ” í•¨ìˆ˜
    async function openReturnFlightModal(buttonElement) {
        const listContainer = document.getElementById('modal-return-flight-list');
        listContainer.innerHTML = `
            <div class="d-flex justify-content-center p-5">
                <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
                <p class="ms-3 mb-0">ì˜¤ëŠ” í¸ í•­ê³µê¶Œì„ ì¡°íšŒì¤‘ì…ë‹ˆë‹¤...</p>
            </div>`;
        
        const returnModalElement = document.getElementById('returnFlightListModal');
        
        // [ â­ï¸ ìµœì¢… ìˆ˜ì •ë³¸ â­ï¸ ]
        // 'ê°€ëŠ” í¸' ì •ë³´ + 'ìŠ¹ê° ì •ë³´'ë¥¼ JSON ë¬¸ìì—´ë¡œ datasetì— ì €ì¥í•©ë‹ˆë‹¤.
        // ì´ ë¶€ë¶„ì´ "undefined" ì˜¤ë¥˜ë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
        returnModalElement.dataset.departureInfo = JSON.stringify({
            id: buttonElement.dataset.offerId,
            carrierCode: buttonElement.dataset.carrierCode,
            originCode: buttonElement.dataset.originCode,
            destinationCode: buttonElement.dataset.destinationCode,
            departureTime: buttonElement.dataset.departureTime,
            arrivalTime: buttonElement.dataset.arrivalTime,
            totalPrice: parseFloat((buttonElement.dataset.totalPrice || "0").replace(/,/g, '')), // ìˆ«ìë¡œ
            departureDate: buttonElement.dataset.departureDate,
            returnDate: buttonElement.dataset.returnDate,
            departureKoLocation: buttonElement.dataset.departureKoLocation,
            arrivalKoLocation: buttonElement.dataset.arrivalKoLocation,
            
            // --- "undefined" ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•´ ì´ ë¶€ë¶„ì´ í•„ìˆ˜ì…ë‹ˆë‹¤ ---
            adults: buttonElement.dataset.adults,
            children: buttonElement.dataset.children,
            infants: buttonElement.dataset.infants,
            travelClass: buttonElement.dataset.travelClass
            // ----------------------------------------------
        });
    
        returnModal.show();
        
        const params = {
            selectedDepartureTime: buttonElement.dataset.departureTime,
            selectedCarrierCode: buttonElement.dataset.carrierCode,
            departureCode: buttonElement.dataset.departureCode,
            arrivalCode: buttonElement.dataset.arrivalCode,
            departureDate: buttonElement.dataset.departureDate,
            returnDate: buttonElement.dataset.returnDate,
            adults: buttonElement.dataset.adults,
            children: buttonElement.dataset.children,
            infants: buttonElement.dataset.infants,
            travelClass: buttonElement.dataset.travelClass
        };
        const queryString = new URLSearchParams(params).toString();
        
        try {
            const response = await fetch(`/air/api/return-flights?${queryString}`);
            if (!response.ok) {
                throw new Error('í•­ê³µí¸ ì¡°íšŒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜)');
            }
            const returnFlights = await response.json();
            listContainer.innerHTML = '';
            if (returnFlights.length === 0) {
                listContainer.innerHTML = '<p class="text-center p-5">ì„ íƒ ê°€ëŠ¥í•œ ì˜¤ëŠ” í¸ í•­ê³µê¶Œì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            returnFlights.forEach(flight => {
                const isDirectText = flight.returnDirectFlight ? 'ì§í•­' : 'ê²½ìœ ';
                const rawPrice = flight.returnTotalPrice; // ìˆ«ìë¡œ ë°›ìŒ
                const formattedPrice = new Intl.NumberFormat('ko-KR').format(rawPrice);
    
                const flightHtml = `
                    <div class="card flight-card-button mb-2">
                        <div class="card-body"> <div class="row align-items-center">
                            <div class="col-md-5">
                                <h6 class="fw-bold mb-0">${flight.returnDepartureTime} - ${flight.returnArrivalTime}</h6>
                                <small class="text-body-secondary">${flight.returnDepartureCode} â†’ ${flight.returnArrivalCode} Â· ${flight.returnCarrierCode} í•­ê³µ</small>
                            </div>
                            <div class="col-md-3 text-md-center">
                                <span class="fw-bold">${isDirectText}</span>
                            </div>
                            <div class="col-md-4 text-md-end">
                                <div class="d-flex flex-column align-items-end">
                                    <span class="price-display mb-1">${formattedPrice}ì›</span>                                  
                                    <button class="btn btn-primary btn-sm"
                                            data-id="${flight.id}"
                                            data-carrier-code="${flight.returnCarrierCode}"
                                            data-departure-time="${flight.returnDepartureTime}"
                                            data-arrival-time="${flight.returnArrivalTime}"
                                            data-total-price="${rawPrice}"
                                            data-origin-code="${flight.returnDepartureCode}"
                                            data-destination-code="${flight.returnArrivalCode}"
                                            onclick="selectReturnFlight(this)">
                                        ì„ íƒ
                                    </button>
                                </div>
                            </div>
                        </div> </div> </div>`;
                listContainer.insertAdjacentHTML('beforeend', flightHtml);
            });
        } catch (error) {
            listContainer.innerHTML = `<p class="text-center text-danger p-5">${error.message}</p>`;
        }
    }
    
    // [ â­ï¸ 'ì˜¤ëŠ” í¸' ì„ íƒ ì‹œ â­ï¸ ] PsgInfo í˜ì´ì§€ë¡œ POST ì´ë™í•˜ëŠ” í•¨ìˆ˜
    async function selectReturnFlight(selectedButton) {
        // 1. 'ê°€ëŠ” í¸' + 'ìŠ¹ê°' ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const returnModalElement = document.getElementById('returnFlightListModal');
        const departureInfo = JSON.parse(returnModalElement.dataset.departureInfo);
        
        // 2. 'ì˜¤ëŠ” í¸' ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const returnInfo = {
            id: selectedButton.dataset.id,
            carrierCode: selectedButton.dataset.carrierCode,
            originCode: selectedButton.dataset.originCode,
            destinationCode: selectedButton.dataset.destinationCode,
            departureTime: selectedButton.dataset.departureTime,
            arrivalTime: selectedButton.dataset.arrivalTime,
            totalPrice: parseFloat((selectedButton.dataset.totalPrice || "0").replace(/,/g, ''))
        };
    
        // 3. 'ì˜¤ëŠ” í¸' ëª¨ë‹¬ ìˆ¨ê¸°ê¸°
        returnModal.hide();
        
        // 4. ë¡œë”© ëª¨ë‹¬ í‘œì‹œ
        const loadingModal = document.getElementById('loadingModal');
        loadingModal.querySelector('p').textContent = 'ì˜ˆì•½ ì •ë³´ í˜ì´ì§€ë¡œ ì´ë™ì¤‘ì…ë‹ˆë‹¤...';
        loadingModal.style.display = 'flex';
    
        // 5. í¼ ìƒì„±
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/air/PsgInfo'; // ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤í•‘ ê²½ë¡œ
    
        // 6. í¼ì— ë°ì´í„° ì¶”ê°€
        createHiddenInput(form, 'departureKoLocation', departureInfo.departureKoLocation);
        createHiddenInput(form, 'arrivalKoLocation', departureInfo.arrivalKoLocation);
    
        // 7. ê°€ëŠ” í¸ (DepartureFlight) ì •ë³´ ì¶”ê°€
        const departureFlight = {
            id: departureInfo.id,
            carrierCode: departureInfo.carrierCode,
            originCode: departureInfo.originCode,
            destinationCode: departureInfo.destinationCode,
            departureTime: `${departureInfo.departureDate}T${departureInfo.departureTime}:00`,
            arrivalTime: `${departureInfo.departureDate}T${departureInfo.arrivalTime}:00`,
            totalPrice: departureInfo.totalPrice // ì´ë¯¸ ìˆ«ì
        };
        for (const key in departureFlight) {
            createHiddenInput(form, `departureFlight.${key}`, departureFlight[key]);
        }
    
        // 8. ì˜¤ëŠ” í¸ (ReturnFlight) ì •ë³´ ì¶”ê°€
        const returnFlight = {
            id: returnInfo.id,
            carrierCode: returnInfo.carrierCode,
            originCode: returnInfo.originCode,
            destinationCode: returnInfo.destinationCode,
            departureTime: `${departureInfo.returnDate}T${returnInfo.departureTime}:00`,
            arrivalTime: `${departureInfo.returnDate}T${returnInfo.arrivalTime}:00`,
            totalPrice: returnInfo.totalPrice // ìˆ«ì
        };
        for (const key in returnFlight) {
            createHiddenInput(form, `returnFlight.${key}`, returnFlight[key]);
        }
        
        // 9. [ â­ï¸ ì¤‘ìš” â­ï¸ ] ìŠ¹ê° ì •ë³´ ì¶”ê°€ (departureInfoì—ì„œ ê°€ì ¸ì˜´)
        createHiddenInput(form, 'adults', parseInt(departureInfo.adults, 10));
        createHiddenInput(form, 'children', parseInt(departureInfo.children, 10));
        createHiddenInput(form, 'infants', parseInt(departureInfo.infants, 10));
        createHiddenInput(form, 'travelClass', departureInfo.travelClass);
    
        // 10. í¼ì„ bodyì— ì¶”ê°€í•˜ê³  ì¦‰ì‹œ submit
        document.body.appendChild(form);
        form.submit();
    }
    

    // ------------------------------------------------------------------
    // ì•„ë˜ëŠ” ì¬ê²€ìƒ‰, ì¥ì†Œì„ íƒ, íƒ‘ìŠ¹ê° ì„ íƒ ëª¨ë‹¬ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ (ê¸°ì¡´ ì½”ë“œ)
    // (ì´ ë¶€ë¶„ì€ ìˆ˜ì • ì‚¬í•­ ì—†ìŒ - ê·¸ëŒ€ë¡œ ìœ ì§€)
    // ------------------------------------------------------------------
    const researchModal = document.getElementById('researchModal');
    const modalDateRangeBtn = document.getElementById('modalDateRangeBtn');
    const modalDepartureDateInput = document.getElementById('modalDepartureDateInput');
    const modalReturnDateInput = document.getElementById('modalReturnDateInput');
    const roundTripRadio = document.getElementById('modal-round-trip');
    const oneWayRadio = document.getElementById('modal-one-way');

    const datePicker = flatpickr(modalDateRangeBtn, {
        dateFormat: "Y-m-d", locale: "ko",
        onClose: function(selectedDates, dateStr, instance) {
            const mode = instance.config.mode;
            if (mode === 'range' && selectedDates.length === 2) {
                const startDate = flatpickr.formatDate(selectedDates[0], "Y-m-d");
                const endDate = flatpickr.formatDate(selectedDates[1], "Y-m-d");
                instance.element.textContent = `${startDate} ~ ${endDate}`;
                modalDepartureDateInput.value = startDate;
                modalReturnDateInput.value = endDate;
            } else if (mode === 'single' && selectedDates.length === 1) {
                const selectedDate = flatpickr.formatDate(selectedDates[0], "Y-m-d");
                instance.element.textContent = selectedDate;
                modalDepartureDateInput.value = selectedDate;
                modalReturnDateInput.value = '';
            }
        }
    });
    modalDateRangeBtn.addEventListener('click', (event) => event.preventDefault());

    function updateCalendarMode() {
        datePicker.clear();
        modalDateRangeBtn.textContent = 'ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”';
        modalDepartureDateInput.value = '';
        modalReturnDateInput.value = '';
        datePicker.set('mode', oneWayRadio.checked ? 'single' : 'range');
    }
    roundTripRadio.addEventListener('change', updateCalendarMode);
    oneWayRadio.addEventListener('change', updateCalendarMode);

 // 'ì¬ê²€ìƒ‰' ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì‹¤í–‰ë˜ëŠ” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    researchModal.addEventListener('show.bs.modal', function (event) {
        // 1. ì¬ê²€ìƒ‰ ë²„íŠ¼ì—ì„œ ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (â­í•œê¸€ ì§€ì—­ëª… í¬í•¨)
        const button = event.relatedTarget;
        const { 
            tripType, departureCode, arrivalCode, departureDate, returnDate, 
            adults, children, infants, travelClass,
            departureKoLocation, arrivalKoLocation // â­ ì¶”ê°€ëœ ë¶€ë¶„
        } = button.dataset;

        // 2. ëª¨ë‹¬ ì•ˆì˜ ëª¨ë“  ìš”ì†Œë“¤ì„ IDë¡œ ì„ íƒ
        const modalDepartureBtn = researchModal.querySelector('#modalDepartureBtn');
        const modalArrivalBtn = researchModal.querySelector('#modalArrivalBtn');
        const passengerBtn = researchModal.querySelector('#passengerBtn'); 
        
        const modalDepartureCodeInput = researchModal.querySelector('#modalDepartureCodeInput');
        const modalArrivalCodeInput = researchModal.querySelector('#modalArrivalCodeInput');
        // â­ [ì¶”ê°€] ìƒˆë¡œ ì¶”ê°€í•œ í•œê¸€ ì§€ì—­ëª… input ì„ íƒ
        const modalDepartureKoLocationInput = researchModal.querySelector('#modalDepartureKoLocationInput');
        const modalArrivalKoLocationInput = researchModal.querySelector('#modalArrivalKoLocationInput');

        const adultsInput = researchModal.querySelector('#adultsInput'); 
        const childrenInput = researchModal.querySelector('#childrenInput'); 
        const infantsInput = researchModal.querySelector('#infantsInput'); 
        const travelClassInput = researchModal.querySelector('#travelClassInput');

        // 3. ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ ëª¨ë‹¬ ë‚´ìš© ì±„ìš°ê¸° (â­í•œê¸€ ì§€ì—­ëª… input ê°’ ì±„ìš°ê¸° ì¶”ê°€)
        modalDepartureBtn.textContent = departureCode;
        modalArrivalBtn.textContent = arrivalCode;
        modalDepartureCodeInput.value = departureCode;
        modalArrivalCodeInput.value = arrivalCode;
        // â­ [ì¶”ê°€] í•œê¸€ ì§€ì—­ëª… inputì— ê°’ ì„¤ì •
        modalDepartureKoLocationInput.value = departureKoLocation;
        modalArrivalKoLocationInput.value = arrivalKoLocation;

        let dateString = departureDate;
        if (tripType === 'round-trip' && returnDate && returnDate.trim() !== '') {
            dateString += ` ~ ${returnDate}`;
        }
        modalDateRangeBtn.textContent = dateString;
        modalDepartureDateInput.value = departureDate;
        modalReturnDateInput.value = returnDate;

        let passengerString = `ì„±ì¸ ${adults} ì–´ë¦°ì´ ${children} ìœ ì•„ ${infants} Â· ${travelClass} class`;
        passengerBtn.textContent = passengerString;
        adultsInput.value = adults;
        childrenInput.value = children;
        infantsInput.value = infants;
        travelClassInput.value = travelClass;

        // 4. ë‹¬ë ¥ ì„¤ì •
        if (tripType === 'round-trip') {
            roundTripRadio.checked = true;
            datePicker.set('mode', 'range');
            if (returnDate && returnDate.trim() !== '') {
                datePicker.setDate([departureDate, returnDate]);
            }
        } else {
            oneWayRadio.checked = true;
            datePicker.set('mode', 'single');
            if (departureDate) {
                datePicker.setDate([departureDate]);
            }
        }
    });
    const modalDepartureBtn = document.getElementById('modalDepartureBtn');
    const modalArrivalBtn = document.getElementById('modalArrivalBtn');
    const modalDepartureCodeInput = document.getElementById('modalDepartureCodeInput');
    const modalArrivalCodeInput = document.getElementById('modalArrivalCodeInput');

    const locationModal = document.getElementById('locationModal');
    const locationModalContent = locationModal.querySelector('.modal-content');
    const popularSearchesContainer = locationModal.querySelector('.popular-searches');
    const defaultModalContentHtml = popularSearchesContainer.innerHTML;
    locationModalContent.addEventListener('mousedown', (event) => event.stopPropagation());

    let locationSelectionContext = null; 

    function closeLocationModal() {
        locationModal.style.display = 'none';
        const researchModalEl = document.getElementById('researchModal');
        const backdropEl = document.querySelector('.modal-backdrop');
        researchModalEl.style.display = 'block';
        if (backdropEl) backdropEl.style.display = 'block';
    }

    function openLocationModal(context) {
        const researchModalEl = document.getElementById('researchModal');
        const backdropEl = document.querySelector('.modal-backdrop');
        researchModalEl.style.display = 'none';
        if (backdropEl) backdropEl.style.display = 'none';
        
        locationSelectionContext = context;
        locationModalContent.querySelector('#modalTitle').textContent = context.type === 'departure' ? 'ì¶œë°œì§€ ì„ íƒ' : 'ë„ì°©ì§€ ì„ íƒ';
        popularSearchesContainer.innerHTML = defaultModalContentHtml;
        locationModalContent.querySelector('#searchAir').value = "";
        popularSearchesContainer.querySelectorAll('.tag').forEach(tag => tag.addEventListener('click', handleTagClick));
        locationModal.style.display = 'flex';
        locationModalContent.querySelector('#searchAir').focus();
    }

    function selectLocation(kolocation, iataCode) {
        if (!locationSelectionContext) return; 

        // ë²„íŠ¼ì—ëŠ” IATA ì½”ë“œë§Œ í‘œì‹œ (ê¸°ì¡´ UIì™€ í†µì¼)
        locationSelectionContext.buttonElement.textContent = iataCode;
        
        // ìˆ¨ê²¨ì§„ IATA ì½”ë“œ input ê°’ ì—…ë°ì´íŠ¸
        locationSelectionContext.inputElement.value = iataCode;

        // â­ [í•µì‹¬] ìˆ¨ê²¨ì§„ í•œê¸€ ì§€ì—­ëª… input ê°’ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸!
        locationSelectionContext.koLocationInputElement.value = kolocation;

        closeLocationModal();
    }

    function handleTagClick(event) {
        const { textContent: cityName, dataset: { iata: iataCode } } = event.currentTarget;
        selectLocation(cityName, iataCode);
    }

    function renderSearchResults(airList) {
        let airListHtml = '';
        if (airList && airList.length > 0) {
            airList.forEach(air => {
                airListHtml += `
                    <div class="search-result-item" data-kolocation="${air.kolocation}" data-iata="${air.iataCode}">
                        <div class="location-main">${air.kolocation} (${air.iataCode})</div>
                        <div class="location-sub">${air.enlocation}</div>
                    </div>`;
            });
        } else {
            airListHtml = '<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
        popularSearchesContainer.innerHTML = airListHtml;
    }

    modalDepartureBtn.addEventListener('click', () => {
        openLocationModal({
            type: 'departure',
            buttonElement: modalDepartureBtn,
            inputElement: modalDepartureCodeInput,
            // â­ [ì¶”ê°€] ì¶œë°œì§€ í•œê¸€ ì§€ì—­ëª… input ìš”ì†Œë¥¼ ì „ë‹¬
            koLocationInputElement: document.getElementById('modalDepartureKoLocationInput')
        });
    });

    modalArrivalBtn.addEventListener('click', () => {
        openLocationModal({
            type: 'arrival',
            buttonElement: modalArrivalBtn,
            inputElement: modalArrivalCodeInput,
            // â­ [ì¶”ê°€] ë„ì°©ì§€ í•œê¸€ ì§€ì—­ëª… input ìš”ì†Œë¥¼ ì „ë‹¬
            koLocationInputElement: document.getElementById('modalArrivalKoLocationInput')
        });
    });

    locationModal.addEventListener('click', function(event) {
        const { target } = event;
        if (target.id === 'searchAir') return;
        if (target.id === 'closeModalBtn' || target.classList.contains('close-button') || target === locationModal) {
            closeLocationModal();
            return;
        }
        const resultItem = target.closest('.search-result-item');
        if (resultItem) {
            const { kolocation, iata } = resultItem.dataset;
            selectLocation(kolocation, iata);
        }
    });

    locationModal.addEventListener('keydown', function(event) {
        if (event.target.id === 'searchAir' && event.key === 'Enter') {
            event.preventDefault();
            $.ajax({
                url: "/air/searchAir", type: "get", dataType: "json", data: { "text": event.target.value },
                success: (res) => renderSearchResults(res)
            });
        }
    });

    document.querySelectorAll('#locationModal .tag').forEach(tag => tag.addEventListener('click', handleTagClick));

    const passengerBtn = document.getElementById('passengerBtn');
    const passengerModal = document.getElementById('passengerModal');
    const passengerModalContent = passengerModal.querySelector('.modal-content');
    const confirmPassengerBtn = document.getElementById('confirmPassengerBtn');
    const adultsInput = document.querySelector('#researchModal #adultsInput');
    const childrenInput = document.querySelector('#researchModal #childrenInput');
    const infantsInput = document.querySelector('#researchModal #infantsInput');
    const travelClassInput = document.querySelector('#researchModal #travelClassInput');

    function openPassengerModal() {
        const researchModalEl = document.getElementById('researchModal');
        const backdropEl = document.querySelector('.modal-backdrop');
        researchModalEl.style.display = 'none';
        if (backdropEl) backdropEl.style.display = 'none';
        passengerModal.style.display = 'flex';
    }

    function closePassengerModal() {
        passengerModal.style.display = 'none';
        const researchModalEl = document.getElementById('researchModal');
        const backdropEl = document.querySelector('.modal-backdrop');
        researchModalEl.style.display = 'block';
        if (backdropEl) backdropEl.style.display = 'block';
    }

    function updateButtonStates() {
        const adults = parseInt(passengerModal.querySelector('.passenger-row[data-type="adult"] .count').textContent);
        const children = parseInt(passengerModal.querySelector('.passenger-row[data-type="child"] .count').textContent);
        const infants = parseInt(passengerModal.querySelector('.passenger-row[data-type="infant"] .count').textContent);
        const totalAllPassengers = adults + children + infants;
        const adultControls = passengerModal.querySelector('.passenger-row[data-type="adult"]');
        const childControls = passengerModal.querySelector('.passenger-row[data-type="child"]');
        const infantControls = passengerModal.querySelector('.passenger-row[data-type="infant"]');
        const isTotalMaxed = (totalAllPassengers >= 9);
        adultControls.querySelector('.plus').disabled = isTotalMaxed;
        adultControls.querySelector('.minus').disabled = (adults <= 1 || adults < infants);
        childControls.querySelector('.plus').disabled = isTotalMaxed;
        childControls.querySelector('.minus').disabled = (children <= 0);
        infantControls.querySelector('.plus').disabled = isTotalMaxed || (infants >= adults);
        infantControls.querySelector('.minus').disabled = (infants <= 0);
    }

    passengerBtn.addEventListener('click', openPassengerModal);
    passengerModal.addEventListener('click', (event) => {
        if (event.target === passengerModal || event.target.classList.contains('close-button')) closePassengerModal();
    });
    passengerModalContent.addEventListener('click', (event) => {
        const button = event.target;
        if (!button.classList.contains('control-btn') || button.disabled) return;
        const countSpan = button.closest('.passenger-row').querySelector('.count');
        let currentCount = parseInt(countSpan.textContent);
        countSpan.textContent = button.classList.contains('plus') ? currentCount + 1 : currentCount - 1;
        updateButtonStates();
    });
    confirmPassengerBtn.addEventListener('click', () => {
        const adults = passengerModal.querySelector('.passenger-row[data-type="adult"] .count').textContent;
        const children = passengerModal.querySelector('.passenger-row[data-type="child"] .count').textContent;
        const infants = passengerModal.querySelector('.passenger-row[data-type="infant"] .count').textContent;
        const selectedClassRadio = passengerModal.querySelector('input[name="travelClassModal"]:checked');
        adultsInput.value = adults;
        childrenInput.value = children;
        infantsInput.value = infants;
        travelClassInput.value = selectedClassRadio.value;
        passengerBtn.textContent = `ì„±ì¸ ${adults} ì–´ë¦°ì´ ${children} ìœ ì•„ ${infants} Â· ${selectedClassRadio.parentElement.textContent.trim()}`;
        closePassengerModal();
    });
    updateButtonStates();

    const researchForm = document.querySelector('#researchModal .flight-search-form');
    researchForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const loadingModal = document.getElementById('loadingModal');
        loadingModal.querySelector('p').textContent = 'í•­ê³µê¶Œì„ ì¬ê²€ìƒ‰ì¤‘ì…ë‹ˆë‹¤...';
        loadingModal.style.display = 'flex';
        setTimeout(() => event.target.submit(), 100);
    });
</script>
</body>
</html>