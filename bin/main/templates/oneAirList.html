<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>ë¬´ì„±ì˜ ì—¬í–‰ - í•­ê³µê¶Œ ì„ íƒ(í¸ë„)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link
	href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,800"
	rel="stylesheet">

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<link
	href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css"
	rel="stylesheet">

<style type="text/css">
/* --- ğŸŸ¢ ìŠ¤íƒ€ì¼ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ ğŸŸ¢ --- */
.moana_gnb {
	background-color: #5ac4c9;
	color: #fff;
	padding: 10px 0;
}

.gnb_container {
	max-width: 1200px;
	margin: 0 auto;
	display: flex;
	align-items: center;
	justify-content: space-between;
	padding: 0 20px;
}

.moana_gnb h1 {
	margin: 0;
	display: flex;
	align-items: center;
}

.box__inner h1 a {
	color: #fff;
	text-decoration: none;
	font-size: 22px;
	font-weight: bold;
}

.list__tab {
	list-style: none;
	margin: 0;
	padding: 0;
	display: flex;
	gap: 20px;
}

.list__tab .list-item a {
	color: #fff;
	text-decoration: none;
	font-weight: bold;
	padding: 5px 0;
	position: relative;
	transition: color 0.3s ease;
}

.list__tab .list-item a:hover, .list__tab .list-item a.link__tab--active
	{
	color: #eee;
}

.list__tab .list-item a.link__tab--active::after {
	content: '';
	position: absolute;
	left: 0;
	bottom: -5px;
	width: 100%;
	height: 2px;
	background-color: #fff;
}

.link-container {
	display: flex;
	align-items: center;
	gap: 10px;
}

.link__booking-history {
	background-color: transparent;
	border: 1px solid #fff;
	color: #fff;
	padding: 8px 15px;
	border-radius: 20px;
	text-decoration: none;
	font-size: 14px;
	transition: background-color 0.3s ease, color 0.3s ease;
	white-space: nowrap;
}

.link__booking-history:hover {
	background-color: #fff;
	color: #5ac4c9;
}

.box__inner {
	display: flex;
	align-items: center;
	gap: 20px;
}

body {
	margin: 0;
	background-color: #f8f9fa;
}

.filter-card-button {
	text-align: left;
	width: 100%;
	border: 1px solid #dee2e6;
	border-radius: 0.375rem;
	background-color: #fff;
	padding: 1.25rem;
	transition: box-shadow .15s ease-in-out;
}

.filter-card-button:hover {
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

.flight-card-button {
	text-align: left;
	border-width: 1px;
	transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
}

.flight-card-button:hover {
	border-color: #5ac4c9;
	box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.1);
}

.flight-card-button .card-body {
	padding: 1.5rem;
}

.price-display {
	font-size: 1.5rem;
	font-weight: 700;
	letter-spacing: -1px;
}

.flight-search-form .form-label {
	display: block;
	font-size: 0.875rem;
	color: #6c757d;
	margin-bottom: 0.3rem;
}

.flight-search-form .nav-tabs {
	border-bottom: 1px solid #dee2e6;
}

.flight-search-form .nav-tabs .nav-link-label {
	padding: 0.5rem 0.8rem;
	cursor: pointer;
	border-bottom: 3px solid transparent;
	color: #6c757d;
	margin-bottom: -1px;
}

.flight-search-form input[type="radio"]:checked+.nav-link-label {
	border-color: #0d6efd;
	color: #0d6efd;
	font-weight: 500;
}

.flight-search-form .form-control-like-button {
	display: block;
	width: 100%;
	padding: 0.6rem 0.9rem;
	font-size: 1rem;
	font-weight: 400;
	line-height: 1.5;
	color: #212529;
	background-color: #fff;
	border: 1px solid #ced4da;
	border-radius: 0.375rem;
	text-align: left;
	transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
}

.flight-search-form .form-control-like-button:hover {
	border-color: #86b7fe;
}

#modalDepartureBtn, #modalArrivalBtn {
	text-align: center;
	font-weight: bold;
	font-size: 1.25rem;
}

.flight-search-form .btn-submit {
	padding-top: 0.8rem;
	padding-bottom: 0.8rem;
	font-size: 1.1rem;
	font-weight: bold;
}

.swap-button {
	border: 1px solid #ddd;
	border-radius: 50%;
	width: 32px;
	height: 32px;
	min-width: 32px;
	display: flex;
	justify-content: center;
	align-items: center;
	font-size: 16px;
	color: #555;
	flex-grow: 0;
}

.modal-overlay {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.4);
	justify-content: center;
	align-items: center;
	z-index: 1060;
}

.modal-overlay .modal-content {
	background-color: white;
	padding: 24px;
	border-radius: 16px;
	box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
	width: 400px;
	max-height: 80vh;
	overflow-y: auto;
	position: relative;
}

.modal-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 20px;
}

.modal-header h2 {
	margin: 0;
	font-size: 20px;
}

.close-button {
	background: none;
	border: none;
	font-size: 24px;
	cursor: pointer;
}

.modal-search-input {
	width: 100%;
	padding: 12px;
	border: 1px solid #ddd;
	border-radius: 8px;
	font-size: 16px;
	box-sizing: border-box;
	margin-bottom: 24px;
}

.popular-searches h3 {
	font-size: 16px;
	color: #555;
	margin-top: 20px;
	margin-bottom: 12px;
}

.tags-container {
	display: flex;
	flex-wrap: wrap;
	gap: 10px;
}

.tag {
	background-color: #f0f0f0;
	color: #333;
	padding: 8px 16px;
	border-radius: 20px;
	font-size: 14px;
	cursor: pointer;
	transition: background-color 0.2s;
}

.tag:hover {
	background-color: #e0e0e0;
}

.search-result-item {
	padding: 10px 5px;
	cursor: pointer;
	border-bottom: 1px solid #f0f0f0;
}

.search-result-item:hover {
	background-color: #f5f5f5;
}

.location-main {
	font-weight: bold;
	font-size: 16px;
}

.location-sub {
	font-size: 14px;
	color: #888;
}

.no-results {
	padding: 20px;
	text-align: center;
	color: #999;
}

.flatpickr-calendar {
	z-index: 1061 !important;
}

.passenger-section, .seat-class-section {
	margin-bottom: 24px;
}

.passenger-section h4, .seat-class-section h4 {
	margin-top: 0;
	margin-bottom: 12px;
	font-size: 16px;
	color: #333;
}

.passenger-row {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 16px;
}

.passenger-label small {
	color: #888;
	font-size: 12px;
}

.passenger-controls {
	display: flex;
	align-items: center;
	gap: 15px;
}

.passenger-controls .count {
	font-size: 18px;
	width: 25px;
	text-align: center;
}

.control-btn {
	width: 32px;
	height: 32px;
	border-radius: 50%;
	border: 1px solid #ddd;
	background-color: white;
	font-size: 20px;
	cursor: pointer;
	color: #3d5aee;
}

.control-btn:disabled {
	color: #ccc;
	cursor: not-allowed;
}

.seat-class-options {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 10px;
}

.seat-class-options label {
	display: flex;
	align-items: center;
	gap: 5px;
	font-size: 14px;
}

.confirm-btn {
	width: 100%;
	padding: 14px;
	background-color: #3d5aee;
	color: white;
	border: none;
	border-radius: 8px;
	font-size: 16px;
	font-weight: bold;
	cursor: pointer;
}

#loadingModal {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.6);
	z-index: 2000;
	justify-content: center;
	align-items: center;
	flex-direction: column;
	color: white;
}

.spinner {
	width: 50px;
	height: 50px;
	border: 5px solid #f3f3f3;
	border-top: 5px solid #5ac4c9;
	border-radius: 50%;
	animation: spin 1s linear infinite;
	margin-bottom: 20px;
}

#loadingModal p {
	font-size: 18px;
	font-weight: bold;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
 
.step-icon {
	width: 36px;
	height: 36px;
	border-radius: 50%;
	background-color: #e9ecef;
	color: #6c757d;
	display: flex;
	align-items: center;
	justify-content: center;
	font-weight: bold;
	margin: 0 auto 8px auto;
}

.step-icon-active {
	background-color: #5ac4c9;
	color: #fff;
}

.step-connector {
	flex-grow: 1;
	height: 3px;
	background-color: #e9ecef;
	margin-top: 16px;
	margin-left: 1rem;
	margin-right: 1rem;
}

/* --- í•„í„° ë° ìŠ¬ë¼ì´ë” ìŠ¤íƒ€ì¼ --- */
.filter-card {
	border: 1px solid #dee2e6;
	border-radius: 0.375rem;
	background-color: #fff;
	padding: 1.25rem;
}

.filter-label {
	display: flex;
	justify-content: space-between;
	font-size: 0.9rem;
	font-weight: 500;
	color: #555;
}

.noUi-target {
	background: #f0f0f0;
	border-radius: 4px;
	border: none;
	box-shadow: none;
}

.noUi-connect {
	background: #0d6efd;
}

.noUi-handle {
	border: 3px solid #fff;
	border-radius: 50%;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
	cursor: pointer;
}

.noUi-handle:focus {
	outline: none;
}

.noUi-tooltip {
	display: none !important;
}

.btn-group-time-filter {
	display: flex;
	flex-wrap: wrap;
	gap: 8px;
}

.btn-group-time-filter .btn {
	border-radius: 20px;
	padding: 0.25rem 0.75rem;
	font-size: 0.9rem;
	background-color: #f8f9fa;
	border: 1px solid #dee2e6;
	color: #6c757d;
	box-shadow: none !important;
}

.btn-group-time-filter input[type="checkbox"]:checked+.btn {
	background-color: #e7f1ff;
	border-color: #0d6efd;
	color: #0d6efd;
	font-weight: 500;
}

.accordion-item {
	border: 1px solid #dee2e6;
	border-radius: 0.375rem !important;
	margin-bottom: 1rem;
}

.accordion-button {
	font-weight: bold;
	color: #212529;
	background-color: #fff;
	border-radius: 0.375rem !important;
}

.accordion-button:not(.collapsed) {
	background-color: #f8f9fa;
	box-shadow: none;
	color: #0d6efd;
}

.accordion-button:focus {
	box-shadow: none;
	border-color: rgba(0, 0, 0, .125);
}

.accordion-body {
	padding: 1rem 1.25rem;
}

.airline-filter-item {
	display: block;
	margin-bottom: 0.5rem;
}

.airline-filter-item label {
	margin-left: 8px;
	cursor: pointer;
}
</style>
</head>
<body>
	<div class="moana_gnb" role="complementary">
		<div class="gnb_container">
			<div class="box__inner">
				<h1>
					<a href="/">ë¬´ì„±ì˜ ì—¬í–‰</a>
				</h1>
			</div>

			<ul class="list__tab">
				<li class="list-item"><a class="link__tab" href="/">í•­ê³µ</a></li>
				<li class="list-item"><a class="link__tab" href="/chat">ì¶”ì²œì±—</a></li>
			</ul>

			<div class="link-container">
				<a href="/revList" class="link__booking-history sp_sd--after"
					th:if="${session.loginUser != null}">ë‚˜ì˜ ì˜ˆì•½ë‚´ì—­</a> <a
					th:if="${session.loginUser == null}"
					class="link__booking-history sp_sd--after" href="/member/login">ë¡œê·¸ì¸</a>
				<a th:if="${session.loginUser != null}"
					th:text="${session.loginUser.UserName}"
					class="link__booking-history sp_sd--after"></a> <a
					th:if="${session.loginUser != null}"
					class="link__booking-history sp_sd--after" href="/member/logout">ë¡œê·¸ì•„ì›ƒ</a>
			</div>
		</div>
	</div>

	<main class="container py-5">

		<div class="card shadow-sm mb-4">
			<div class="card-body p-4">
				<div class="d-flex justify-content-between align-items-start">
					<div class="text-center">
						<div class="step-icon step-icon-active">1</div>
						<div class="fw-bold text-primary small">í•­ê³µ ì„ íƒ</div>
					</div>
					<div class="step-connector"></div>
					<div class="text-center">
						<div class="step-icon">2</div>
						<div class="text-muted small">íƒ‘ìŠ¹ê° ì •ë³´</div>
					</div>
					<div class="step-connector"></div>
					<div class="text-center">
						<div class="step-icon">3</div>
						<div class="text-muted small">ì˜ˆì•½</div>
					</div>
				</div>
			</div>
		</div>

		<div class="row g-4">

			<div class="col-lg-3">
				<div class="vstack gap-3">

					<button class="filter-card-button" data-bs-toggle="modal"
						data-bs-target="#researchModal"
						th:data-trip-type="${airparmDto.tripType}"
						th:data-departure-code="${airparmDto.departureCode}"
						th:data-arrival-code="${airparmDto.arrivalCode}"
						th:data-departure-date="${airparmDto.departureDate}"
						th:data-return-date="${airparmDto.returnDate}"
						th:data-adults="${airparmDto.adults}"
						th:data-children="${airparmDto.children}"
						th:data-infants="${airparmDto.infants}"
						th:data-travel-class="${airparmDto.travelClass}"
						th:data-departure-ko-location="${airparmDto.departureKoLocation}"
						th:data-arrival-ko-location="${airparmDto.arrivalKoLocation}">
						<div
							class="d-flex justify-content-between align-items-center mb-2">
							<span
								class="badge bg-primary-subtle text-primary-emphasis rounded-pill"
								th:if="${airparmDto.tripType} == 'round-trip'" th:text="ì™•ë³µ">ì™•ë³µ</span>
							<span
								class="badge bg-primary-subtle text-primary-emphasis rounded-pill"
								th:if="${airparmDto.tripType} == 'one-way'" th:text="í¸ë„">í¸ë„</span>
						</div>
						<h5 class="fw-bold mb-1"
							th:text="${airparmDto.departureCode + ' â†” ' + airparmDto.arrivalCode}">
							ì œì£¼ â†” ì˜¤ì‚¬ì¹´ <i class="bi bi-chevron-down"></i>
						</h5>
						<h4 class="fw-bold mb-1"
							th:text="${'('+airparmDto.departureKoLocation + ' â†” ' + airparmDto.arrivalKoLocation + ')'}">
							ì œì£¼ â†” ì˜¤ì‚¬ì¹´ <i class="bi bi-chevron-down"></i>
						</h4>
						<small class="text-body-secondary"
							th:if="${#strings.isEmpty(#strings.trim(airparmDto.returnDate))}"
							th:text="${airparmDto.departureDate}">11.6(ëª©) - 11.8(í† )</small> <small
							class="text-body-secondary"
							th:if="${not #strings.isEmpty(#strings.trim(airparmDto.returnDate))}"
							th:text="${airparmDto.departureDate} + '~' + ${airparmDto.returnDate}">11.6(ëª©)
							- 11.8(í† )</small> <br> <small class="text-body-secondary"
							th:text="'ì„±ì¸ ' + ${airparmDto.adults} + ' ì–´ë¦°ì´ ' + ${airparmDto.children} + ' ìœ ì•„ '
							 + ${airparmDto.infants} + ' Â· ' + ${airparmDto.travelClass} +' class'">ì„±ì¸
							1 Â· ì¼ë°˜ì„</small>
					</button>

					<div class="accordion" id="filterAccordion">

						<div class="accordion-item shadow-sm">
							<h2 class="accordion-header" id="headingTime">
								<button class="accordion-button" type="button"
									data-bs-toggle="collapse" data-bs-target="#collapseTime"
									aria-expanded="true" aria-controls="collapseTime">ì¶œë°œ
									ì‹œê°„ëŒ€ ì„¤ì •</button>
							</h2>
							<div id="collapseTime" class="accordion-collapse collapse show"
								aria-labelledby="headingTime">
								<div class="accordion-body">
									<div class="btn-group-time-filter" role="group"
										aria-label="ì¶œë°œ ì‹œê°„ í•„í„°">
										<input type="checkbox" class="btn-check" name="timeFilter"
											id="time-all" autocomplete="off" checked data-min="0"
											data-max="1439"> <label class="btn" for="time-all">ì „ì²´</label>

										<input type="checkbox" class="btn-check time-filter-option"
											name="timeFilter" id="time-00-04" autocomplete="off"
											data-min="0" data-max="240"> <label class="btn"
											for="time-00-04">00ì‹œ ~ 04ì‹œ</label> <input type="checkbox"
											class="btn-check time-filter-option" name="timeFilter"
											id="time-04-08" autocomplete="off" data-min="240"
											data-max="480"> <label class="btn" for="time-04-08">04ì‹œ
											~ 08ì‹œ</label> <input type="checkbox"
											class="btn-check time-filter-option" name="timeFilter"
											id="time-08-12" autocomplete="off" data-min="480"
											data-max="720"> <label class="btn" for="time-08-12">08ì‹œ
											~ 12ì‹œ</label> <input type="checkbox"
											class="btn-check time-filter-option" name="timeFilter"
											id="time-12-16" autocomplete="off" data-min="720"
											data-max="960"> <label class="btn" for="time-12-16">12ì‹œ
											~ 16ì‹œ</label> <input type="checkbox"
											class="btn-check time-filter-option" name="timeFilter"
											id="time-16-20" autocomplete="off" data-min="960"
											data-max="1200"> <label class="btn" for="time-16-20">16ì‹œ
											~ 20ì‹œ</label> <input type="checkbox"
											class="btn-check time-filter-option" name="timeFilter"
											id="time-20-24" autocomplete="off" data-min="1200"
											data-max="1439"> <label class="btn" for="time-20-24">20ì‹œ
											~ 24ì‹œ</label>
									</div>
								</div>
							</div>
						</div>

						<div class="accordion-item shadow-sm">
							<h2 class="accordion-header" id="headingAirline">
								<button class="accordion-button collapsed" type="button"
									data-bs-toggle="collapse" data-bs-target="#collapseAirline"
									aria-expanded="false" aria-controls="collapseAirline">
									í•­ê³µì‚¬</button>
							</h2>
							<div id="collapseAirline" class="accordion-collapse collapse"
								aria-labelledby="headingAirline">
								<div class="accordion-body">
									<div id="airline-filter-list"></div>
								</div>
							</div>
						</div>

						<div class="accordion-item shadow-sm">
							<h2 class="accordion-header" id="headingDuration">
								<button class="accordion-button collapsed" type="button"
									data-bs-toggle="collapse" data-bs-target="#collapseDuration"
									aria-expanded="false" aria-controls="collapseDuration">
									ì´ ì†Œìš”ì‹œê°„</button>
							</h2>
							<div id="collapseDuration" class="accordion-collapse collapse"
								aria-labelledby="headingDuration">
								<div class="accordion-body">
									<div class="filter-label mb-2">
										<span id="duration-min">0ì‹œê°„ 0ë¶„</span> <span id="duration-max">0ì‹œê°„
											0ë¶„</span>
									</div>
									<div id="duration-slider" class="mx-1"></div>
								</div>
							</div>
						</div>

						<div class="accordion-item shadow-sm">
							<h2 class="accordion-header" id="headingPrice">
								<button class="accordion-button collapsed" type="button"
									data-bs-toggle="collapse" data-bs-target="#collapsePrice"
									aria-expanded="false" aria-controls="collapsePrice">
									ê°€ê²©</button>
							</h2>
							<div id="collapsePrice" class="accordion-collapse collapse"
								aria-labelledby="headingPrice">
								<div class="accordion-body">
									<div class="filter-label mb-2">
										<span id="price-min">0ì›</span> <span id="price-max">0ì›</span>
									</div>
									<div id="price-slider" class="mx-1"></div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</div>

			<div class="col-lg-9">
				<h4 class="fw-bold">ê°€ëŠ”í¸ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</h4>
				<p class="text-body-secondary mb-4">ì„±ì¸ 1ì¸ ê¸°ì¤€, ë°œê¶ŒëŒ€í–‰ìˆ˜ìˆ˜ë£Œ í¬í•¨</p>

				<div class="vstack gap-3 flight-item-container"
					th:each="searchAir : ${searchairDto}">
					<button class="card flight-card-button w-100"
						th:data-offer-id="${searchAir.id}"
						th:data-departure-time="${searchAir.departureTime}"
						th:data-carrier-code="${searchAir.carrierCode}"
						th:data-departure-code="${airparmDto.departureCode}"
						th:data-arrival-code="${airparmDto.arrivalCode}"
						th:data-departure-date="${airparmDto.departureDate}"
						th:data-return-date="${airparmDto.returnDate}"
						th:data-adults="${airparmDto.adults}"
						th:data-children="${airparmDto.children}"
						th:data-infants="${airparmDto.infants}"
						th:data-travel-class="${airparmDto.travelClass}"
						th:data-arrival-time="${searchAir.arrivalTime}"
						th:data-total-price="${searchAir.rawTotalPrice}"
						th:data-origin-code="${searchAir.departureCode}"
						th:data-destination-code="${searchAir.arrivalCode}"
						th:data-departure-ko-location="${airparmDto.departureKoLocation}"
						th:data-arrival-ko-location="${airparmDto.arrivalKoLocation}"
						onclick="selectOneWayFlight(this)">
						<div class="card-body">
							<div class="row align-items-center">
								<div class="col-md-5">
									<small class="text-body-secondary"
										th:text="${searchAir.numberOfBookableSeats} + 'ì„ ê°€ëŠ¥'">9ì„
										ê°€ëŠ¥</small>

									<div class="d-flex align-items-center mt-1">
										<div>
											<h6 class="fw-bold mb-0 d-flex align-items-center flex-wrap">

												<span th:text="${searchAir.departureTime}">16:00</span> <small
													class="text-secondary fw-normal ms-1 me-2"
													style="font-size: 0.75rem;"
													th:text="'(' + ${#strings.substring(searchAir.departureDate, 5).replace('-', '.')} + ')'">
													(11.25) </small> <span class="me-2">-</span> <span
													th:text="${searchAir.arrivalTime}">09:30</span> <small
													class="text-secondary fw-normal ms-1"
													style="font-size: 0.75rem;"
													th:text="'(' + ${#strings.substring(searchAir.arrivalDate, 5).replace('-', '.')} + ')'">
													(11.25) </small> <span th:if="${searchAir.dayDifference == 0}"
													class="badge bg-light text-secondary border rounded-pill ms-2"
													style="font-size: 0.7rem; font-weight: normal;"> ë‹¹ì¼
												</span> <small th:if="${searchAir.dayDifference == 0}"
													class="text-secondary ms-1" style="font-size: 0.7rem;">
													<i class="bi bi-info-circle"></i> ì‹œì°¨ë°˜ì˜
												</small> <span th:if="${searchAir.dayDifference > 0}"
													class="badge bg-danger-subtle text-danger-emphasis rounded-pill ms-2"
													style="font-size: 0.7rem;"
													th:text="'+' + ${searchAir.dayDifference} + 'ì¼'">
													+1ì¼ </span> <span th:if="${searchAir.dayDifference < 0}"
													class="badge bg-primary-subtle text-primary-emphasis rounded-pill ms-2"
													style="font-size: 0.7rem;"
													th:text="${searchAir.dayDifference} + 'ì¼'"> -1ì¼ </span> <small
													th:if="${searchAir.dayDifference < 0}"
													class="text-secondary ms-1" style="font-size: 0.7rem;">
													<i class="bi bi-info-circle"></i> ì‹œì°¨ë°˜ì˜
												</small>
											</h6>

											<small class="text-body-secondary"
												th:text="${searchAir.departureCode} + ' â†’ ' + ${searchAir.arrivalCode} + ' Â· ' + ${searchAir.carrierCode} + ' í•­ê³µ'">
												ICN â†’ SFO Â· UA í•­ê³µ </small>
										</div>
									</div>
								</div>

								<div class="col-md-3 text-md-end">
									<div class="mb-1">
										<small class="text-body-secondary"><i
											class="bi bi-clock"></i> <span
											th:text="${searchAir.totalDuration}">20ì‹œê°„ 10ë¶„</span></small>
									</div>

									<span class="fw-bold text-primary"
										th:if="${searchAir.directFlight}">ì§í•­</span>

									<div th:unless="${searchAir.directFlight}">
										<span class="fw-bold text-dark">ê²½ìœ </span> <small
											class="text-danger d-block fw-bold"
											style="font-size: 0.8rem;"
											th:text="${searchAir.layoverNames} + ' ê²½ìœ '">YVR ê²½ìœ </small>
									</div>
								</div>

								<div class="col-md-4 text-md-end">
									<span class="price-display"
										th:text="${#numbers.formatInteger(searchAir.rawTotalPrice, 0, 'COMMA')} + 'ì›'">292,050ì›</span>
								</div>
							</div>
							<hr>
						</div>
					</button>
					<br>
				</div>
			</div>
		</div>
	</main>

	<div class="modal fade" id="researchModal" tabindex="-1"
		aria-labelledby="researchModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="researchModalLabel">ì¬ê²€ìƒ‰</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form action="/air/searchAirport" method="POST"
						class="flight-search-form">
						<div class="d-flex nav-tabs mb-4">
							<div>
								<input type="radio" name="tripType" value="round-trip"
									id="modal-round-trip" checked style="display: none;"> <label
									for="modal-round-trip" class="nav-link-label">ì™•ë³µ</label>
							</div>
							<div>
								<input type="radio" name="tripType" value="one-way"
									id="modal-one-way" style="display: none;"> <label
									for="modal-one-way" class="nav-link-label">í¸ë„</label>
							</div>
						</div>
						<div class="d-flex align-items-end justify-content-between mb-4">
							<div class="flex-grow-1">
								<label for="modalDepartureBtn" class="form-label">ì¶œë°œì§€</label>
								<button type="button" id="modalDepartureBtn"
									class="form-control-like-button">SEL</button>
							</div>
							<button type="button" class="swap-button">â†”</button>
							<div class="flex-grow-1">
								<label for="modalArrivalBtn" class="form-label">ë„ì°©ì§€</label>
								<button type="button" id="modalArrivalBtn"
									class="form-control-like-button">CJU</button>
							</div>
						</div>
						<div class="mb-4">
							<label for="modalDateRangeBtn" class="form-label">ë‚ ì§œ</label>
							<button type="button" id="modalDateRangeBtn"
								class="form-control-like-button">2025-10-13 ~
								2025-10-14</button>
						</div>
						<div class="mb-4">
							<label for="passengerBtn" class="form-label">íƒ‘ìŠ¹ê°</label>
							<button type="button" id="passengerBtn"
								class="form-control-like-button">ì„±ì¸ 1 ì–´ë¦°ì´ 0 ìœ ì•„ 0 Â·
								ECONOMY class</button>
						</div>
						<input type="hidden" name="departureCode"
							id="modalDepartureCodeInput"> <input type="hidden"
							name="arrivalCode" id="modalArrivalCodeInput"> <input
							type="hidden" name="departureDate" id="modalDepartureDateInput">
						<input type="hidden" name="returnDate" id="modalReturnDateInput">
						<input type="hidden" name="adults" id="adultsInput"> <input
							type="hidden" name="children" id="childrenInput"> <input
							type="hidden" name="infants" id="infantsInput"> <input
							type="hidden" name="travelClass" id="travelClassInput"> <input
							type="hidden" name="departureKoLocation"
							id="modalDepartureKoLocationInput"> <input type="hidden"
							name="arrivalKoLocation" id="modalArrivalKoLocationInput">
						<div class="d-grid mt-2">
							<button type="submit" class="btn btn-primary btn-lg btn-submit">ê²€ìƒ‰í•˜ê¸°</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="returnFlightListModal" tabindex="-1"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-scrollable modal-xl">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">ì˜¤ëŠ” í¸ í•­ê³µê¶Œì„ ì„ íƒí•´ì£¼ì„¸ìš”</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div id="modal-return-flight-list"></div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">ë‹«ê¸°</button>
				</div>
			</div>
		</div>
	</div>

	<div id="locationModal" class="modal-overlay">
		<div class="modal-content">
			<div class="modal-header">
				<h2 id="modalTitle">ì¶œë°œì§€ ì„ íƒ</h2>
				<button id="closeModalBtn" class="close-button">&times;</button>
			</div>
			<input type="text" id="searchAir" class="modal-search-input"
				placeholder="êµ­ê°€, ë„ì‹œ ë˜ëŠ” ê³µí•­ìœ¼ë¡œ ì°¾ì•„ë³´ì„¸ìš”">
			<div class="popular-searches">
				<h3>êµ­ë‚´ ì¸ê¸° ê²€ìƒ‰</h3>
				<div class="tags-container">
					<span class="tag" data-iata="ICN">ì„œìš¸/ì¸ì²œ</span> <span class="tag"
						data-iata="CJU">ì œì£¼</span> <span class="tag" data-iata="PUS">ë¶€ì‚°</span>
					<span class="tag" data-iata="GMP">ì„œìš¸/ê¹€í¬</span> <span class="tag"
						data-iata="RSU">ì—¬ìˆ˜</span>
				</div>
				<h3>ë™ë‚¨ì•„ ì¸ê¸° ê²€ìƒ‰</h3>
				<div class="tags-container">
					<span class="tag" data-iata="DAD">ë‹¤ë‚­</span> <span class="tag"
						data-iata="BKK">ë°©ì½•</span> <span class="tag" data-iata="TPE">íƒ€ì´ë² ì´</span>
					<span class="tag" data-iata="HKG">í™ì½©</span> <span class="tag"
						data-iata="DPS">ë°œë¦¬</span>
				</div>
				<h3>ì¼ë³¸ ì¸ê¸° ê²€ìƒ‰</h3>
				<div class="tags-container">
					<span class="tag" data-iata="NRT">ë„ì¿„/ë‚˜ë¦¬íƒ€</span> <span class="tag"
						data-iata="KIX">ì˜¤ì‚¬ì¹´</span> <span class="tag" data-iata="FUK">í›„ì¿ ì˜¤ì¹´</span>
					<span class="tag" data-iata="CTS">ì‚¿í¬ë¡œ/ì‚°ì¹˜í† ì„¸</span> <span class="tag"
						data-iata="OKA">ì˜¤í‚¤ë‚˜ì™€</span>
				</div>
				<h3>ìœ ëŸ½ ì¸ê¸° ê²€ìƒ‰</h3>
				<div class="tags-container">
					<span class="tag" data-iata="CDG">íŒŒë¦¬</span> <span class="tag"
						data-iata="LHR">ëŸ°ë˜</span> <span class="tag" data-iata="FCO">ë¡œë§ˆ</span>
					<span class="tag" data-iata="MAD">ë§ˆë“œë¦¬ë“œ</span> <span class="tag"
						data-iata="BCN">ë°”ë¥´ì…€ë¡œë‚˜</span>
				</div>
				<h3>ë¶ë¯¸ ë° ê¸°íƒ€</h3>
				<div class="tags-container">
					<span class="tag" data-iata="JEK">ë‰´ìš•</span> <span class="tag"
						data-iata="SYD">ì‹œë“œë‹ˆ</span> <span class="tag" data-iata="LAX">ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤</span>
					<span class="tag" data-iata="SFO">ìƒŒí”„ë€ì‹œìŠ¤ì½”</span> <span class="tag"
						data-iata="GUM">ê´Œ</span>
				</div>
			</div>
		</div>
	</div>

	<div id="passengerModal" class="modal-overlay">
		<div class="modal-content">
			<div class="modal-header">
				<h2>ì¸ì› ë° ì¢Œì„ ë“±ê¸‰</h2>
				<button class="close-button">&times;</button>
			</div>
			<div class="passenger-section">
				<h4>ì¸ì›</h4>
				<div class="passenger-row" data-type="adult">
					<div class="passenger-label">
						<div>ì„±ì¸</div>
						<small>ë§Œ 12ì„¸ ì´ìƒ</small>
					</div>
					<div class="passenger-controls">
						<button type="button" class="control-btn minus" disabled>-</button>
						<span class="count">1</span>
						<button type="button" class="control-btn plus">+</button>
					</div>
				</div>
				<div class="passenger-row" data-type="child">
					<div class="passenger-label">
						<div>ì†Œì•„</div>
						<small>ë§Œ 2~12ì„¸ ë¯¸ë§Œ</small>
					</div>
					<div class="passenger-controls">
						<button type="button" class="control-btn minus" disabled>-</button>
						<span class="count">0</span>
						<button type="button" class="control-btn plus">+</button>
					</div>
				</div>
				<div class="passenger-row" data-type="infant">
					<div class="passenger-label">
						<div>ìœ ì•„</div>
						<small>ë§Œ 2ì„¸ ë¯¸ë§Œ (ë³´í˜¸ìì™€ ë™ë°˜ ì°©ì„)</small>
					</div>
					<div class="passenger-controls">
						<button type="button" class="control-btn minus" disabled>-</button>
						<span class="count">0</span>
						<button type="button" class="control-btn plus">+</button>
					</div>
				</div>
			</div>
			<div class="seat-class-section">
				<h4>ì¢Œì„ë“±ê¸‰</h4>
				<div class="seat-class-options">
					<label><input type="radio" name="travelClassModal"
						value="ECONOMY" checked> ì¼ë°˜ì„</label> <label><input
						type="radio" name="travelClassModal" value="PREMIUM_ECONOMY">
						í”„ë¦¬ë¯¸ì—„ ì¼ë°˜ì„</label> <label><input type="radio"
						name="travelClassModal" value="BUSINESS"> ë¹„ì¦ˆë‹ˆìŠ¤ì„</label> <label><input
						type="radio" name="travelClassModal" value="FIRST"> ì¼ë“±ì„</label>
				</div>
			</div>
			<button type="button" id="confirmPassengerBtn" class="confirm-btn">ì„ íƒ
				ì™„ë£Œ</button>
		</div>
	</div>

	<div id="loadingModal">
		<div class="spinner"></div>
		<p>í•­ê³µê¶Œì„ ì¬ê²€ìƒ‰ì¤‘ì…ë‹ˆë‹¤...</p>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
	<script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>

	<script>
    // ğŸŸ¢ (ê¸°ì¡´ JS - 'oneAirList.html' ìš©) ğŸŸ¢
    
    function createHiddenInput(form, name, value) {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        input.value = value;
        form.appendChild(input);
    }

    // â­ï¸ í¸ë„(One-Way) í•­ê³µí¸ ì„ íƒ í•¨ìˆ˜ â­ï¸
    async function selectOneWayFlight(buttonElement) {
        const departureInfo = {
            id: buttonElement.dataset.offerId,
            carrierCode: buttonElement.dataset.carrierCode,
            originCode: buttonElement.dataset.originCode,
            destinationCode: buttonElement.dataset.destinationCode,
            departureTime: buttonElement.dataset.departureTime,
            arrivalTime: buttonElement.dataset.arrivalTime,
            totalPrice: parseFloat((buttonElement.dataset.totalPrice || "0").replace(/,/g, '')),
            departureDate: buttonElement.dataset.departureDate,
            departureKoLocation: buttonElement.dataset.departureKoLocation,
            arrivalKoLocation: buttonElement.dataset.arrivalKoLocation
        };

        const passengerInfo = {
            adults: parseInt(buttonElement.dataset.adults, 10),
            children: parseInt(buttonElement.dataset.children, 10),
            infants: parseInt(buttonElement.dataset.infants, 10),
            travelClass: buttonElement.dataset.travelClass
        };

        const bookingData = {
            departureKoLocation: departureInfo.departureKoLocation,
            arrivalKoLocation: departureInfo.arrivalKoLocation,
            adults: passengerInfo.adults, 
            children: passengerInfo.children,
            infants: passengerInfo.infants, 
            travelClass: passengerInfo.travelClass,
            departureFlight: {
                id: departureInfo.id,
                carrierCode: departureInfo.carrierCode,
                originCode: departureInfo.originCode,
                destinationCode: departureInfo.destinationCode,
                departureTime: `${departureInfo.departureDate}T${departureInfo.departureTime}:00`,
                arrivalTime: `${departureInfo.departureDate}T${departureInfo.arrivalTime}:00`,
                totalPrice: departureInfo.totalPrice
            },
            returnFlight: null // í¸ë„ì´ë¯€ë¡œ null
        };

        const loadingModal = document.getElementById('loadingModal');
        loadingModal.querySelector('p').textContent = 'ì˜ˆì•½ ì •ë³´ í˜ì´ì§€ë¡œ ì´ë™ì¤‘ì…ë‹ˆë‹¤...';
        loadingModal.style.display = 'flex';

        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/air/PsgInfo'; 

        createHiddenInput(form, 'departureKoLocation', bookingData.departureKoLocation);
        createHiddenInput(form, 'arrivalKoLocation', bookingData.arrivalKoLocation);
        createHiddenInput(form, 'adults', bookingData.adults);
        createHiddenInput(form, 'children', bookingData.children);
        createHiddenInput(form, 'infants', bookingData.infants);
        createHiddenInput(form, 'travelClass', bookingData.travelClass);

        if (bookingData.departureFlight) {
            for (const key in bookingData.departureFlight) {
                createHiddenInput(form, `departureFlight.${key}`, bookingData.departureFlight[key]);
            }
        }
        
        document.body.appendChild(form);
        form.submit();
    }


    // ==================================================================
    // (ê¸°ì¡´) ì¬ê²€ìƒ‰, ì¥ì†Œ/íƒ‘ìŠ¹ê° ì„ íƒ ëª¨ë‹¬ ê´€ë ¨ ì½”ë“œ (ìˆ˜ì • ì—†ìŒ)
    // ==================================================================
    const researchModal = document.getElementById('researchModal');
    const modalDateRangeBtn = document.getElementById('modalDateRangeBtn');
    const modalDepartureDateInput = document.getElementById('modalDepartureDateInput');
    const modalReturnDateInput = document.getElementById('modalReturnDateInput');
    const roundTripRadio = document.getElementById('modal-round-trip');
    const oneWayRadio = document.getElementById('modal-one-way');

    const datePicker = flatpickr(modalDateRangeBtn, {
        dateFormat: "Y-m-d", locale: "ko",
        onClose: function(selectedDates, dateStr, instance) {
            const mode = instance.config.mode;
            if (mode === 'range' && selectedDates.length === 2) {
                const startDate = flatpickr.formatDate(selectedDates[0], "Y-m-d");
                const endDate = flatpickr.formatDate(selectedDates[1], "Y-m-d");
                instance.element.textContent = `${startDate} ~ ${endDate}`;
                modalDepartureDateInput.value = startDate;
                modalReturnDateInput.value = endDate;
            } else if (mode === 'single' && selectedDates.length === 1) {
                const selectedDate = flatpickr.formatDate(selectedDates[0], "Y-m-d");
                instance.element.textContent = selectedDate;
                modalDepartureDateInput.value = selectedDate;
                modalReturnDateInput.value = '';
            }
        }
    });
    modalDateRangeBtn.addEventListener('click', (event) => event.preventDefault());

    function updateCalendarMode() {
        datePicker.clear();
        modalDateRangeBtn.textContent = 'ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”';
        modalDepartureDateInput.value = '';
        modalReturnDateInput.value = '';
        datePicker.set('mode', oneWayRadio.checked ? 'single' : 'range');
    }
    roundTripRadio.addEventListener('change', updateCalendarMode);
    oneWayRadio.addEventListener('change', updateCalendarMode);

    researchModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const { 
            tripType, departureCode, arrivalCode, departureDate, returnDate, 
            adults, children, infants, travelClass,
            departureKoLocation, arrivalKoLocation
        } = button.dataset;

        const modalDepartureBtn = researchModal.querySelector('#modalDepartureBtn');
        const modalArrivalBtn = researchModal.querySelector('#modalArrivalBtn');
        const passengerBtn = researchModal.querySelector('#passengerBtn'); 
        const modalDepartureCodeInput = researchModal.querySelector('#modalDepartureCodeInput');
        const modalArrivalCodeInput = researchModal.querySelector('#modalArrivalCodeInput');
        const modalDepartureKoLocationInput = researchModal.querySelector('#modalDepartureKoLocationInput');
        const modalArrivalKoLocationInput = researchModal.querySelector('#modalArrivalKoLocationInput');
        const adultsInput = researchModal.querySelector('#adultsInput'); 
        const childrenInput = researchModal.querySelector('#childrenInput'); 
        const infantsInput = researchModal.querySelector('#infantsInput'); 
        const travelClassInput = researchModal.querySelector('#travelClassInput');

        modalDepartureBtn.textContent = departureCode;
        modalArrivalBtn.textContent = arrivalCode;
        modalDepartureCodeInput.value = departureCode;
        modalArrivalCodeInput.value = arrivalCode;
        modalDepartureKoLocationInput.value = departureKoLocation;
        modalArrivalKoLocationInput.value = arrivalKoLocation;

        let dateString = departureDate;
        if (tripType === 'round-trip' && returnDate && returnDate.trim() !== '') {
            dateString += ` ~ ${returnDate}`;
        }
        modalDateRangeBtn.textContent = dateString;
        modalDepartureDateInput.value = departureDate;
        modalReturnDateInput.value = returnDate;

        let passengerString = `ì„±ì¸ ${adults} ì–´ë¦°ì´ ${children} ìœ ì•„ ${infants} Â· ${travelClass} class`;
        passengerBtn.textContent = passengerString;
        adultsInput.value = adults;
        childrenInput.value = children;
        infantsInput.value = infants;
        travelClassInput.value = travelClass;

        if (tripType === 'round-trip') {
            roundTripRadio.checked = true;
            datePicker.set('mode', 'range');
            if (returnDate && returnDate.trim() !== '') {
                datePicker.setDate([departureDate, returnDate]);
            }
        } else {
            oneWayRadio.checked = true;
            datePicker.set('mode', 'single');
            if (departureDate) {
                datePicker.setDate([departureDate]);
            }
        }
    });
    
    const modalDepartureBtn = document.getElementById('modalDepartureBtn');
    const modalArrivalBtn = document.getElementById('modalArrivalBtn');
    const modalDepartureCodeInput = document.getElementById('modalDepartureCodeInput');
    const modalArrivalCodeInput = document.getElementById('modalArrivalCodeInput');
    const locationModal = document.getElementById('locationModal');
    const locationModalContent = locationModal.querySelector('.modal-content');
    const popularSearchesContainer = locationModal.querySelector('.popular-searches');
    const defaultModalContentHtml = popularSearchesContainer.innerHTML;
    locationModalContent.addEventListener('mousedown', (event) => event.stopPropagation());
    let locationSelectionContext = null;

    function closeLocationModal() {
        locationModal.style.display = 'none';
        document.getElementById('researchModal').style.display = 'block';
        const backdropEl = document.querySelector('.modal-backdrop');
        if (backdropEl) backdropEl.style.display = 'block';
    }
    function openLocationModal(context) {
        document.getElementById('researchModal').style.display = 'none';
        const backdropEl = document.querySelector('.modal-backdrop');
        if (backdropEl) backdropEl.style.display = 'none';
        locationSelectionContext = context;
        locationModalContent.querySelector('#modalTitle').textContent = context.type === 'departure' ? 'ì¶œë°œì§€ ì„ íƒ' : 'ë„ì°©ì§€ ì„ íƒ';
        popularSearchesContainer.innerHTML = defaultModalContentHtml;
        locationModalContent.querySelector('#searchAir').value = "";
        popularSearchesContainer.querySelectorAll('.tag').forEach(tag => tag.addEventListener('click', handleTagClick));
        locationModal.style.display = 'flex';
        locationModalContent.querySelector('#searchAir').focus();
    }
    function selectLocation(kolocation, iataCode) {
        if (!locationSelectionContext) return;
        locationSelectionContext.buttonElement.textContent = iataCode;
        locationSelectionContext.inputElement.value = iataCode;
        locationSelectionContext.koLocationInputElement.value = kolocation;
        closeLocationModal();
    }
    function handleTagClick(event) {
        selectLocation(event.currentTarget.textContent, event.currentTarget.dataset.iata);
    }
    function renderSearchResults(airList) {
        let airListHtml = '';
        if (airList && airList.length > 0) {
            airList.forEach(air => {
                airListHtml += `<div class="search-result-item" data-kolocation="${air.kolocation}" data-iata="${air.iataCode}"><div class="location-main">${air.kolocation} (${air.iataCode})</div><div class="location-sub">${air.enlocation}</div></div>`;
            });
        } else {
            airListHtml = '<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
        popularSearchesContainer.innerHTML = airListHtml;
    }
    modalDepartureBtn.addEventListener('click', () => openLocationModal({ type: 'departure', buttonElement: modalDepartureBtn, inputElement: modalDepartureCodeInput, koLocationInputElement: document.getElementById('modalDepartureKoLocationInput') }));
    modalArrivalBtn.addEventListener('click', () => openLocationModal({ type: 'arrival', buttonElement: modalArrivalBtn, inputElement: modalArrivalCodeInput, koLocationInputElement: document.getElementById('modalArrivalKoLocationInput') }));
    locationModal.addEventListener('click', function(event) {
        const { target } = event;
        if (target.id === 'searchAir') return;
        if (target.id === 'closeModalBtn' || target.classList.contains('close-button') || target === locationModal) { closeLocationModal(); return; }
        const resultItem = target.closest('.search-result-item');
        if (resultItem) selectLocation(resultItem.dataset.kolocation, resultItem.dataset.iata);
    });
    locationModal.addEventListener('keydown', function(event) {
        if (event.target.id === 'searchAir' && event.key === 'Enter') {
            event.preventDefault();
            $.ajax({ url: "/air/searchAir", type: "get", dataType: "json", data: { "text": event.target.value }, success: (res) => renderSearchResults(res) });
        }
    });
    document.querySelectorAll('#locationModal .tag').forEach(tag => tag.addEventListener('click', handleTagClick));

    const passengerBtn = document.getElementById('passengerBtn');
    const passengerModal = document.getElementById('passengerModal');
    const passengerModalContent = passengerModal.querySelector('.modal-content');
    const confirmPassengerBtn = document.getElementById('confirmPassengerBtn');
    const adultsInput = document.querySelector('#researchModal #adultsInput');
    const childrenInput = document.querySelector('#researchModal #childrenInput');
    const infantsInput = document.querySelector('#researchModal #infantsInput');
    const travelClassInput = document.querySelector('#researchModal #travelClassInput');

    function openPassengerModal() {
        document.getElementById('researchModal').style.display = 'none';
        const backdropEl = document.querySelector('.modal-backdrop');
        if (backdropEl) backdropEl.style.display = 'none';
        passengerModal.style.display = 'flex';
    }
    function closePassengerModal() {
        passengerModal.style.display = 'none';
        document.getElementById('researchModal').style.display = 'block';
        const backdropEl = document.querySelector('.modal-backdrop');
        if (backdropEl) backdropEl.style.display = 'block';
    }
    function updateButtonStates() {
        const adults = parseInt(passengerModal.querySelector('.passenger-row[data-type="adult"] .count').textContent);
        const children = parseInt(passengerModal.querySelector('.passenger-row[data-type="child"] .count').textContent);
        const infants = parseInt(passengerModal.querySelector('.passenger-row[data-type="infant"] .count').textContent);
        const totalAllPassengers = adults + children + infants;
        const adultControls = passengerModal.querySelector('.passenger-row[data-type="adult"]');
        const childControls = passengerModal.querySelector('.passenger-row[data-type="child"]');
        const infantControls = passengerModal.querySelector('.passenger-row[data-type="infant"]');
        const isTotalMaxed = (totalAllPassengers >= 9);
        adultControls.querySelector('.plus').disabled = isTotalMaxed;
        adultControls.querySelector('.minus').disabled = (adults <= 1 || adults < infants);
        childControls.querySelector('.plus').disabled = isTotalMaxed;
        childControls.querySelector('.minus').disabled = (children <= 0);
        infantControls.querySelector('.plus').disabled = isTotalMaxed || (infants >= adults);
        infantControls.querySelector('.minus').disabled = (infants <= 0);
    }
    passengerBtn.addEventListener('click', openPassengerModal);
    passengerModal.addEventListener('click', (event) => { if (event.target === passengerModal || event.target.classList.contains('close-button')) closePassengerModal(); });
    passengerModalContent.addEventListener('click', (event) => {
        const button = event.target;
        if (!button.classList.contains('control-btn') || button.disabled) return;
        const countSpan = button.closest('.passenger-row').querySelector('.count');
        let currentCount = parseInt(countSpan.textContent);
        countSpan.textContent = button.classList.contains('plus') ? currentCount + 1 : currentCount - 1;
        updateButtonStates();
    });
    confirmPassengerBtn.addEventListener('click', () => {
        const adults = passengerModal.querySelector('.passenger-row[data-type="adult"] .count').textContent;
        const children = passengerModal.querySelector('.passenger-row[data-type="child"] .count').textContent;
        const infants = passengerModal.querySelector('.passenger-row[data-type="infant"] .count').textContent;
        const selectedClassRadio = passengerModal.querySelector('input[name="travelClassModal"]:checked');
        adultsInput.value = adults;
        childrenInput.value = children;
        infantsInput.value = infants;
        travelClassInput.value = selectedClassRadio.value;
        passengerBtn.textContent = `ì„±ì¸ ${adults} ì–´ë¦°ì´ ${children} ìœ ì•„ ${infants} Â· ${selectedClassRadio.parentElement.textContent.trim()}`;
        closePassengerModal();
    });
    updateButtonStates();

    const researchForm = document.querySelector('#researchModal .flight-search-form');
    researchForm.addEventListener('submit', function(event) {
        event.preventDefault();
        const loadingModal = document.getElementById('loadingModal');
        loadingModal.querySelector('p').textContent = 'í•­ê³µê¶Œì„ ì¬ê²€ìƒ‰ì¤‘ì…ë‹ˆë‹¤...';
        loadingModal.style.display = 'flex';
        setTimeout(() => event.target.submit(), 100);
    });

    document.addEventListener('DOMContentLoaded', function() {
        
        const durSliderEl = document.getElementById('duration-slider');
        const priceSliderEl = document.getElementById('price-slider');
        const airlineListContainer = document.getElementById('airline-filter-list');

        if (!durSliderEl || !priceSliderEl || !airlineListContainer) {
            console.log("í•„í„° ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return; 
        }

        function parseTime(timeStr) {
            if (!timeStr || !timeStr.includes(':')) return 0; 
            const [hours, minutes] = timeStr.split(':').map(Number);
            return (hours * 60) + minutes;
        }
        function calculateDuration(depTime, arrTime) {
            const depMinutes = parseTime(depTime);
            const arrMinutes = parseTime(arrTime);
            if (arrMinutes >= depMinutes) {
                return arrMinutes - depMinutes;
            } else {
                return (1440 - depMinutes) + arrMinutes; 
            }
        }
        function formatDuration(minutes) {
            const m = Math.round(minutes); 
            const h = Math.floor(m / 60);
            const min = m % 60;
            return `${h}ì‹œê°„ ${min}ë¶„`;
        }
        const priceFormatter = new Intl.NumberFormat('ko-KR', {
            style: 'currency',
            currency: 'KRW',
            minimumFractionDigits: 0
        });

        const airlineNames = {
            '7C': 'ì œì£¼í•­ê³µ', 'LJ': 'ì§„ì—ì–´', 'TW': 'í‹°ì›¨ì´í•­ê³µ',
            'KE': 'ëŒ€í•œí•­ê³µ', 'OZ': 'ì•„ì‹œì•„ë‚˜í•­ê³µ', 'RS': 'ì—ì–´ì„œìš¸',
            'BX': 'ì—ì–´ë¶€ì‚°', 'ZE': 'ì´ìŠ¤íƒ€í•­ê³µ', 'VJ': 'ë¹„ì—£ì ¯í•­ê³µ',
            'VN': 'ë² íŠ¸ë‚¨í•­ê³µ', 'PR': 'í•„ë¦¬í•€í•­ê³µ', 'JL': 'ì¼ë³¸í•­ê³µ',
            'NH': 'ì „ì¼ë³¸ê³µìˆ˜', 'MM': 'í”¼ì¹˜í•­ê³µ', 'VZ': 'íƒ€ì´ ë¹„ì—£ì ¯ í•­ê³µ', 
            'TC': 'íƒ€ì´ ì—ì–´ì•„ì‹œì•„ ì—‘ìŠ¤', 'MU': 'ì¤‘êµ­ë™ë°©í•­ê³µ', 'CZ': 'ì¤‘êµ­ë‚¨ë°©í•­ê³µ'
        };
        function getAirlineName(code) {
            return airlineNames[code] || code;
        }

        const flightCards = document.querySelectorAll('.flight-item-container');
        
        if (flightCards.length === 0) {
            document.getElementById('filterAccordion').style.display = 'none';
            return;
        }

        let minPrice = Infinity, maxPrice = 0;
        let minDuration = Infinity, maxDuration = 0;
        const uniqueAirlines = new Set();

        flightCards.forEach(card => {
            const button = card.querySelector('.flight-card-button');
            if (!button) return; 

            const depTime = button.dataset.departureTime;
            const arrTime = button.dataset.arrivalTime;
            const price = parseFloat(button.dataset.totalPrice);
            
            card.dataset.carrierCode = button.dataset.carrierCode;

            const depMinutes = parseTime(depTime);
            const duration = calculateDuration(depTime, arrTime);
            
            card.dataset.priceNum = price;
            card.dataset.depMinutes = depMinutes;
            card.dataset.durationMinutes = duration;

            if (!isNaN(price)) {
                if (price < minPrice) minPrice = price;
                if (price > maxPrice) maxPrice = price;
            }
            if (!isNaN(duration)) {
                if (duration < minDuration) minDuration = duration;
                if (duration > maxDuration) maxDuration = duration;
            }
            
            uniqueAirlines.add(card.dataset.carrierCode);
        });
        
        if (minPrice === Infinity) minPrice = 0;
        if (minDuration === Infinity) minDuration = 0;
        if (maxPrice === 0) maxPrice = minPrice; 
        if (maxDuration === 0) maxDuration = minDuration; 

        uniqueAirlines.forEach(code => {
            const airlineName = getAirlineName(code);
            const itemId = `airline-${code}`;
            const itemHtml = `
                <span class="airline-filter-item">
                    <input class="form-check-input" type="checkbox" value="${code}" id="${itemId}">
                    <label class="form-check-label" for="${itemId}">
                        ${airlineName} (${code})
                    </label>
                </span>
            `;
            airlineListContainer.insertAdjacentHTML('beforeend', itemHtml);
        });

        noUiSlider.create(durSliderEl, {
            range: { 'min': minDuration, 'max': maxDuration },
            start: [minDuration, maxDuration],
            connect: true, step: 10,
            tooltips: [ { to: formatDuration, from: Number }, { to: formatDuration, from: Number } ],
            format: { to: v => Math.round(v), from: v => Math.round(v) }
        });
        noUiSlider.create(priceSliderEl, {
            range: { 'min': minPrice, 'max': maxPrice },
            start: [minPrice, maxPrice],
            connect: true, step: 1000,
            tooltips: [ { to: v => priceFormatter.format(v), from: Number }, { to: v => priceFormatter.format(v), from: Number } ],
            format: { to: v => Math.round(v), from: v => Math.round(v) }
        });

        const durMinLabel = document.getElementById('duration-min');
        const durMaxLabel = document.getElementById('duration-max');
        const priceMinLabel = document.getElementById('price-min');
        const priceMaxLabel = document.getElementById('price-max');
        
        durSliderEl.noUiSlider.on('update', (values) => {
            durMinLabel.textContent = formatDuration(values[0]);
            durMaxLabel.textContent = formatDuration(values[1]);
            filterFlights();
        });
        priceSliderEl.noUiSlider.on('update', (values) => {
            priceMinLabel.textContent = priceFormatter.format(values[0]);
            priceMaxLabel.textContent = priceFormatter.format(values[1]);
            filterFlights();
        });
        
        const timeAllBtn = document.getElementById('time-all');
        const timeOptionBtns = document.querySelectorAll('.time-filter-option');

        timeAllBtn.addEventListener('change', function() {
            if (timeAllBtn.checked) {
                timeOptionBtns.forEach(btn => { btn.checked = false; });
            } else {
                const anyOtherChecked = Array.from(timeOptionBtns).some(btn => btn.checked);
                if (!anyOtherChecked) { timeAllBtn.checked = true; }
            }
            filterFlights();
        });

        timeOptionBtns.forEach(btn => {
            btn.addEventListener('change', function() {
                if (btn.checked) {
                    timeAllBtn.checked = false;
                } else {
                    const anyOtherChecked = Array.from(timeOptionBtns).some(btn => btn.checked);
                    if (!anyOtherChecked) { timeAllBtn.checked = true; }
                }
                filterFlights();
            });
        });
        
        document.querySelectorAll('#airline-filter-list input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', filterFlights);
        });

        function filterFlights() {
            const checkedTimeBtns = document.querySelectorAll('input[name="timeFilter"]:checked');
            const timeRanges = Array.from(checkedTimeBtns).map(btn => ({
                min: parseInt(btn.dataset.min, 10),
                max: parseInt(btn.dataset.max, 10)
            }));
            
            const [durMin, durMax] = durSliderEl.noUiSlider.get().map(Number);
            const [priceMin, priceMax] = priceSliderEl.noUiSlider.get().map(Number);
            const checkedAirlines = Array.from(
                document.querySelectorAll('#airline-filter-list input[type="checkbox"]:checked')
            ).map(cb => cb.value);

            flightCards.forEach(card => {
                const depMinutes = parseInt(card.dataset.depMinutes, 10);
                const duration = parseInt(card.dataset.durationMinutes, 10);
                const price = parseInt(card.dataset.priceNum, 10);
                const carrier = card.dataset.carrierCode;

                const showByDep = timeRanges.some(range => (depMinutes >= range.min && depMinutes <= range.max));
                const showByDur = (duration >= durMin && duration <= durMax);
                const showByPrice = (price >= priceMin && price <= priceMax);
                const showByAirline = (checkedAirlines.length === 0) || checkedAirlines.includes(carrier);

                if (showByDep && showByDur && showByPrice && showByAirline) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        if (minDuration === maxDuration) {
            durSliderEl.setAttribute('disabled', true);
        }
        if (minPrice === maxPrice) {
            priceSliderEl.setAttribute('disabled', true);
        }
        
        durMinLabel.textContent = formatDuration(minDuration);
        durMaxLabel.textContent = formatDuration(maxDuration);
        priceMinLabel.textContent = priceFormatter.format(minPrice);
        priceMaxLabel.textContent = priceFormatter.format(maxPrice);
        
        filterFlights(); 
    });
    </script>
</body>
</html>