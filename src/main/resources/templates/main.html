<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<title>ë¬´ì„±ì˜ ì—¬í–‰</title>

<th:block th:replace="layout/header_fragment :: common-head"></th:block>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<style>

    :root {
        --primary-color: #5ac4c9;
        --primary-light: #e0f7fa;
        --text-dark: #333;
        --text-gray: #888;
        --bg-light: #f9f9f9;
        --white: #ffffff;
        --border-color: #eee;
        --shadow-soft: 0 15px 35px rgba(0, 0, 0, 0.1);
    }


    .hidden-input {
        display: none;
    }

    /* --- Hero ì„¹ì…˜ (ìˆ˜ì •ë¨) --- */
    .hero-section {
        position: relative;
        width: 100%;
        height: 51vh; /* ì‹œì›í•œ ë†’ì´ */
        margin-bottom: 100px;
        /* overflow: hidden; ì œê±°í•¨ -> ê²€ìƒ‰ì°½ì´ íŠ€ì–´ë‚˜ì™€ì•¼ í•˜ë¯€ë¡œ */
    }

    /* ë¹„ë””ì˜¤ë¥¼ ê°ì‹¸ëŠ” ë˜í¼ (ìƒˆë¡œ ì¶”ê°€ë¨) */
    .video-wrapper {
        position: absolute; 
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden; /* ë¹„ë””ì˜¤ê°€ ë„˜ì¹˜ì§€ ì•Šê²Œ ì—¬ê¸°ì„œ ìë¦„ */
        z-index: 0;
    }

    .bg-video {
        width: 100%;
        height: 100%;
        object-fit: cover; /* í™”ë©´ ë¹„ìœ¨ì— ë§ê²Œ ê½‰ ì±„ì›€ */
    }

    .video-overlay {
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.3); /* ì˜ìƒ ëª…ë„ ì¡°ì ˆ (0.3 ì¶”ì²œ) */
        z-index: 1;
    }

    /* --- ê²€ìƒ‰ ìœ„ì ¯ (ìˆ˜ì •ë¨) --- */
    .search-widget-container {
        position: absolute;
        bottom: -80px; /* ì„¹ì…˜ ë°–ìœ¼ë¡œ 80px íŠ€ì–´ë‚˜ì˜´ */
        left: 50%;
        transform: translateX(-50%);
        z-index: 10; /* ì˜ìƒë³´ë‹¤ ìœ„ì— ìœ„ì¹˜ */
        background-color: var(--white);
        border-radius: 16px;
        box-shadow: var(--shadow-soft);
        padding: 12px 24px 20px 24px;
        width: 95%; /* ëª¨ë°”ì¼ ëŒ€ì‘ì„ ìœ„í•´ % ì‚¬ìš© */
        max-width: 950px;
        box-sizing: border-box;
    }

    .top-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 8px;
        margin-bottom: 16px;
    }

    .tabs .tab-label {
        font-size: 16px;
        padding: 8px 12px;
        margin-right: 12px;
        cursor: pointer;
        color: var(--text-gray);
        display: inline-block;
        transition: color 0.2s;
    }

    .tabs input[type="radio"]:checked + .tab-label {
        color: var(--primary-color);
        font-weight: bold;
        box-shadow: inset 0 -2px 0 var(--primary-color);
    }

    .direct-flight-option {
        display: flex;
        align-items: center;
        font-size: 14px;
        color: #555;
    }

    .direct-flight-option input {
        margin-right: 6px;
    }

    .search-fields {
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .search-fields button {
        background: none;
        border: none;
        text-align: left;
        padding: 10px 4px;
        font-size: 18px;
        font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
        cursor: pointer;
        flex-grow: 1;
    }

    .field-location {
        color: var(--text-dark);
        font-weight: bold;
        min-width: 120px;
    }

    .field-placeholder {
        color: #999;
        white-space: nowrap;
    }

    .swap-button {
        border: 1px solid #ddd;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        min-width: 32px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 16px;
        color: #555;
        flex-grow: 0;
        background-color: var(--white);
    }

    .submit-button {
        background-color: var(--bg-light); /* ê¸°ë³¸ ë°°ê²½ ì—†ìœ¼ë¯€ë¡œ ë°ì€ íšŒìƒ‰ í˜¹ì€ transparent */
        color: var(--primary-color);
        font-weight: bold;
        border-radius: 8px;
        padding: 14px 24px;
        flex-grow: 0;
    }
    
    /* ëª¨ë‹¬ ë‚´ 'ê²€ìƒ‰í•˜ëŸ¬ ê°€ê¸°' ë“± ê°•ì¡° ë²„íŠ¼ */
    .btn-primary-action {
        background-color: var(--primary-color) !important;
        color: white !important;
    }

    /* --- ëª¨ë‹¬ ê³µí†µ --- */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .modal-content {
        background-color: var(--white);
        padding: 24px;
        border-radius: 16px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        width: 400px;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .modal-header h2 {
        margin: 0;
        font-size: 20px;
    }

    .close-button {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
    }

    /* --- ì—¬í–‰ì§€ ì¶”ì²œ ëŒ€í˜• ëª¨ë‹¬ --- */
    .modal-large {
        width: 800px;
        max-width: 95%;
        max-height: 90vh;
        padding: 0;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .modal-large .modal-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--border-color);
        background-color: var(--white);
        z-index: 10;
        margin-bottom: 0;
    }

    .modal-large .modal-body {
        padding: 24px;
        overflow-y: auto;
        background-color: var(--bg-light);
    }

    .dest-desc {
        font-size: 16px;
        color: #555;
        margin-bottom: 30px;
        line-height: 1.6;
    }

    .rec-title {
        font-size: 18px;
        font-weight: bold;
        color: var(--text-dark);
        margin-bottom: 15px;
    }

    /* ì¶”ì²œ ì•¡í‹°ë¹„í‹° ê·¸ë¦¬ë“œ */
    .activity-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    .activity-item {
        background: var(--white);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: transform 0.2s;
    }

    .activity-item:hover {
        transform: translateY(-3px);
    }

    .activity-img {
        width: 100%;
        height: 160px;
        object-fit: cover;
    }

    .activity-info {
        padding: 15px;
    }

    .activity-info h5 {
        margin: 0 0 5px 0;
        font-size: 16px;
        font-weight: bold;
        color: var(--text-dark);
    }

    .activity-info p {
        margin: 0;
        font-size: 13px;
        color: #666;
        line-height: 1.4;
    }

    @media (max-width: 600px) {
        .activity-grid { grid-template-columns: 1fr; }
        .search-fields { flex-direction: column; align-items: stretch; }
    }

    /* --- ê²€ìƒ‰ ëª¨ë‹¬ ë‚´ë¶€ --- */
    .modal-search-input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        box-sizing: border-box;
        margin-bottom: 24px;
    }

    .popular-searches h3 {
        font-size: 16px;
        color: #555;
        margin-top: 20px;
        margin-bottom: 12px;
    }

    .tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .tag {
        background-color: #f0f0f0;
        color: var(--text-dark);
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.2s;
    }

    .tag:hover {
        background-color: #e0e0e0;
    }

    .search-result-item {
        padding: 10px 5px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
    }

    .search-result-item:hover {
        background-color: #f5f5f5;
    }

    .location-main {
        font-weight: bold;
        font-size: 16px;
    }

    .location-sub {
        font-size: 14px;
        color: var(--text-gray);
    }

    .no-results {
        padding: 20px;
        text-align: center;
        color: #999;
    }

    /* Flatpickr ì»¤ìŠ¤í…€ */
    .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange {
        background: var(--primary-color);
        border-color: var(--primary-color);
    }

    .flatpickr-day.inRange {
        background: var(--primary-light);
        box-shadow: -5px 0 0 var(--primary-light), 5px 0 0 var(--primary-light);
        border-color: transparent;
    }

    /* --- íƒ‘ìŠ¹ê° ëª¨ë‹¬ --- */
    .passenger-section, .seat-class-section {
        margin-bottom: 24px;
    }

    .passenger-section h4, .seat-class-section h4 {
        margin-top: 0;
        margin-bottom: 12px;
        font-size: 16px;
        color: var(--text-dark);
    }

    .passenger-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .passenger-label small {
        color: var(--text-gray);
        font-size: 12px;
    }

    .passenger-controls {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .passenger-controls .count {
        font-size: 18px;
        width: 25px;
        text-align: center;
    }

    .control-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 1px solid #ddd;
        background-color: var(--white);
        font-size: 20px;
        cursor: pointer;
        color: var(--primary-color);
    }

    .control-btn:disabled {
        color: #ccc;
        cursor: not-allowed;
    }

    .seat-class-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    .seat-class-options label {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 14px;
    }

    .confirm-btn {
        width: 100%;
        padding: 14px;
        background-color: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
    }

    /* --- ì•Œë¦¼ ëª¨ë‹¬ --- */
    #alertModal .modal-content {
        width: 320px;
        padding: 30px;
        text-align: center;
    }

    #alertModal p {
        font-size: 16px;
        line-height: 1.6;
        margin: 0 0 20px 0;
        font-weight: bold;
        color: var(--text-dark);
    }

    #alertModal button {
        width: 100%;
        padding: 12px;
        background-color: var(--primary-color);
        color: var(--white);
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
    }

    /* --- ë¡œë”© ëª¨ë‹¬ --- */
    #loadingModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        z-index: 2000;
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }
    
    #loadingModal p { font-size: 18px; font-weight: bold; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    /* --- ì½˜í…ì¸  ì„¹ì…˜ (ì¸ê¸° ì—¬í–‰ì§€ ë“±) --- */
    .popular-destinations-section {
        padding: 40px 0;
        margin-top: 100px;
    }

    .content-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        box-sizing: border-box;
    }

    .popular-destinations-section h2 {
        font-size: 24px;
        font-weight: bold;
        color: var(--text-dark);
        margin: 0 0 8px 0;
    }

    .popular-destinations-section p {
        font-size: 16px;
        color: #777;
        margin-bottom: 30px;
    }

    .popular-destinations-section h3 {
        font-size: 20px;
        font-weight: bold;
        color: var(--text-dark);
        margin-top: 40px;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
    }

    .destination-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
    }

    .destination-card {
        background-color: var(--white);
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .destination-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .destination-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }

    .card-details { padding: 16px; }
    .card-details h4 {
        font-size: 18px;
        font-weight: bold;
        color: #222;
        margin: 0 0 4px 0;
    }
    .card-details small { font-size: 14px; color: var(--text-gray); }

    .activities-preview {
        margin-top: 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }

    .activity-tag {
        background-color: #f0f2f5;
        color: #555;
        font-size: 12px;
        padding: 4px 8px;
        border-radius: 20px;
        white-space: nowrap;
    }

    @media (max-width: 992px) { .destination-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 576px) { .destination-grid { grid-template-columns: 1fr; } }

    /* --- íŠ¸ë Œë“œ ì„¹ì…˜ --- */
    .trend-container {
        margin-bottom: 50px;
        position: relative;
    }

    .trend-tabs {
        display: flex;
        gap: 20px;
        margin-top: 30px;
        margin-bottom: 20px;
        border-bottom: 2px solid var(--border-color);
    }

    .trend-tab-label {
        font-size: 20px;
        font-weight: bold;
        color: var(--text-gray);
        cursor: pointer;
        padding-bottom: 10px;
        position: relative;
        transition: all 0.3s;
    }

    #tab-domestic:checked ~ .trend-tabs label[for="tab-domestic"],
    #tab-overseas:checked ~ .trend-tabs label[for="tab-overseas"] {
        color: var(--text-dark);
        border-bottom: 3px solid #ff7675; /* í¬ì¸íŠ¸ ì»¬ëŸ¬ */
        margin-bottom: -2px;
    }

    .trend-content {
        display: none; 
        grid-template-columns: repeat(6, 1fr);
        gap: 15px;
        animation: fadeIn 0.5s;
    }

    #tab-domestic:checked ~ #content-domestic,
    #tab-overseas:checked ~ #content-overseas {
        display: grid;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .trend-card {
        background: var(--white);
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px 15px;
        text-align: center;
        position: relative;
        transition: all 0.3s ease;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .trend-card:hover {
        transform: translateY(-5px);
        border-color: var(--primary-color);
        box-shadow: 0 5px 15px rgba(90, 196, 201, 0.2);
    }

    .trend-rank {
        position: absolute;
        top: -10px;
        left: -5px;
        background-color: #ff7675;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .trend-card:nth-child(1) .trend-rank { background-color: #d63031; transform: scale(1.1); }
    .trend-card:nth-child(2) .trend-rank { background-color: #e17055; }
    .trend-card:nth-child(3) .trend-rank { background-color: #fdcb6e; color: #333; }

    .trend-city {
        font-size: 18px;
        font-weight: bold;
        color: var(--text-dark);
        margin: 10px 0 5px 0;
        display: block;
    }

    .trend-code {
        font-size: 13px;
        color: #999;
        background-color: #f5f5f5;
        padding: 2px 6px;
        border-radius: 4px;
    }

    .trend-count {
        display: block;
        margin-top: 12px;
        font-size: 13px;
        color: var(--primary-color);
        font-weight: bold;
    }

    @media (max-width: 992px) { .trend-content { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 576px) { .trend-content { grid-template-columns: repeat(2, 1fr); } }
</style>
</head>
<body>

    <header th:replace="layout/header_fragment :: common-header(activeMenu='home')"></header>

    <main>
        <section class="hero-section">
            <div class="video-wrapper">
                <video autoplay muted loop playsinline class="bg-video">
                    <source src="/image/3736780-uhd_3840_2160_24fps.mp4" type="video/mp4">
                </video>
                <div class="video-overlay"></div>
            </div>
            
            <form class="search-widget-container" action="/air/searchAirport" method="GET">
                <div class="top-section">
                    <div class="tabs">
                        <input type="radio" name="tripType" value="round-trip" id="round-trip" checked class="hidden-input"> 
                        <label for="round-trip" class="tab-label">ì™•ë³µ</label> 
                        <input type="radio" name="tripType" value="one-way" id="one-way" class="hidden-input"> 
                        <label for="one-way" class="tab-label">í¸ë„</label>
                    </div>
                    <div class="direct-flight-option">
                        <input type="hidden" name="directFlight" id="directFlightInput" value="false"> 
                        <input type="checkbox" id="direct-flight-checkbox"> 
                        <label for="direct-flight-checkbox">ì§í•­</label>
                    </div>
                </div>
                <div class="search-fields">
                    <button type="button" id="departureBtn" class="field-location">ì„œìš¸ SEL</button>
                    <button type="button" class="swap-button">â†”</button>
                    <button type="button" id="arrivalBtn" class="field-placeholder">ë„ì°©ì§€ IN</button>

                    <button type="button" id="dateRangeBtn" class="field-placeholder">ì–¸ì œ ë– ë‚˜ì‹œë‚˜ìš”?</button>
                    <input type="hidden" name="departureDate" id="departureDateInput">
                    <input type="hidden" name="returnDate" id="returnDateInput">

                    <button type="button" id="passengerBtn" class="field-placeholder">ğŸ‘¤ íƒ‘ìŠ¹ê° 1ëª…, ì¼ë°˜ì„</button>

                    <input type="hidden" name="departureCode" id="departureCode" value="SEL"> 
                    <input type="hidden" name="departureKoLocation" id="departureKoLocation" value="ì„œìš¸">
                    <input type="hidden" name="arrivalCode" id="arrivalCode" value="">
                    <input type="hidden" name="arrivalKoLocation" id="arrivalKoLocation" value=""> 
                    <input type="hidden" name="adults" id="adultsInput" value="1"> 
                    <input type="hidden" name="children" id="childrenInput" value="0">
                    <input type="hidden" name="infants" id="infantsInput" value="0">
                    <input type="hidden" name="travelClass" id="travelClassInput" value="ECONOMY">
                    
                    <button type="submit" class="submit-button">ìµœì €ê°€ë¡œ ê²€ìƒ‰</button>
                </div>
            </form>
        </section>

        <section class="popular-destinations-section">
            <div class="content-container">
                <h2>ëŒ€í•œë¯¼êµ­ ì¶œë°œ ì¸ê¸° í•­ê³µê¶Œ</h2>

                <div class="trend-container">
                    <input type="radio" id="tab-domestic" name="trendTabs" class="hidden-input" checked>
                    <input type="radio" id="tab-overseas" name="trendTabs" class="hidden-input">

                    <div class="trend-tabs">
                        <label for="tab-domestic" class="trend-tab-label">ğŸ”¥ êµ­ë‚´ ê¸‰ìƒìŠ¹</label>
                        <label for="tab-overseas" class="trend-tab-label">âœˆï¸ í•´ì™¸ ê¸‰ìƒìŠ¹</label>
                    </div>

                    <div id="content-domestic" class="trend-content">
                        <div class="trend-card" th:each="item, stat : ${domesticTrend}">
                            <div class="trend-rank" th:text="${stat.count}">1</div>
                            <span class="trend-city" th:text="${item.cityName}">ì œì£¼</span>
                            <span class="trend-code" th:text="${item.iataCode}">CJU</span>
                            <span class="trend-count" th:text="|âš¡ ${item.searchCount}íšŒ ê²€ìƒ‰|">45íšŒ</span>
                        </div>
                        <div th:if="${domesticTrend.empty}" style="grid-column: 1/-1; text-align: center; padding: 20px; color: #999;">
                            ì•„ì§ ì§‘ê³„ëœ êµ­ë‚´ ê²€ìƒ‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    </div>

                    <div id="content-overseas" class="trend-content">
                        <div class="trend-card" th:each="item, stat : ${overseasTrend}">
                            <div class="trend-rank" th:text="${stat.count}">1</div>
                            <span class="trend-city" th:text="${item.cityName}">ì˜¤ì‚¬ì¹´</span>
                            <span class="trend-code" th:text="${item.iataCode}">KIX</span>
                            <span class="trend-count" th:text="|âš¡ ${item.searchCount}íšŒ ê²€ìƒ‰|">15íšŒ</span>
                        </div>
                        <div th:if="${overseasTrend.empty}" style="grid-column: 1/-1; text-align: center; padding: 20px; color: #999;">
                            ì•„ì§ ì§‘ê³„ëœ í•´ì™¸ ê²€ìƒ‰ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>

                <h3>êµ­ë‚´ ì¸ê¸° ì—¬í–‰ì§€</h3>
                <div class="destination-grid">
                    <div class="destination-card" th:each="dest : ${domesticList}" th:data-city="${dest.cityName}">
                        <img th:src="${dest.mainImageUrl}" th:alt="${dest.cityName}">
                        <div class="card-details">
                            <h4 th:text="${dest.cityName}">ë„ì‹œì´ë¦„</h4>
                            <small th:text="${dest.country}">êµ­ê°€</small>
                            <div class="activities-preview">
                                <span class="activity-tag" th:each="act, iStat : ${dest.activities}" th:if="${iStat.index < 2}" th:text="${act.title}">ì•¡í‹°ë¹„í‹°</span>
                            </div>
                        </div>
                    </div>
                </div>

                <h3>í•´ì™¸ ì¸ê¸° ì—¬í–‰ì§€</h3>
                <div class="destination-grid">
                    <div class="destination-card" th:each="dest : ${overseasList}" th:data-city="${dest.cityName}">
                        <img th:src="${dest.mainImageUrl}" th:alt="${dest.cityName}">
                        <div class="card-details">
                            <h4 th:text="${dest.cityName}">ë„ì‹œì´ë¦„</h4>
                            <small th:text="${dest.country}">êµ­ê°€</small>
                            <div class="activities-preview">
                                <span class="activity-tag" th:each="act, iStat : ${dest.activities}" th:if="${iStat.index < 2}" th:text="${act.title}">ì•¡í‹°ë¹„í‹°</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="locationModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">ì¶œë°œì§€ ì„ íƒ</h2>
                <button class="close-button close-modal-btn" data-target="locationModal">&times;</button>
            </div>
            <input type="text" id="searchAir" class="modal-search-input" placeholder="êµ­ê°€, ë„ì‹œ ë˜ëŠ” ê³µí•­ìœ¼ë¡œ ì°¾ì•„ë³´ì„¸ìš”">
            <div class="popular-searches">
                <h3>êµ­ë‚´ ì¸ê¸° ê²€ìƒ‰</h3>
                <div class="tags-container">
                    <span class="tag" data-iata="ICN" data-kolocation="ì„œìš¸/ì¸ì²œ">ì„œìš¸/ì¸ì²œ</span>
                    <span class="tag" data-iata="CJU" data-kolocation="ì œì£¼">ì œì£¼</span>
                    <span class="tag" data-iata="PUS" data-kolocation="ë¶€ì‚°">ë¶€ì‚°</span>
                    <span class="tag" data-iata="GMP" data-kolocation="ì„œìš¸/ê¹€í¬">ì„œìš¸/ê¹€í¬</span>
                    <span class="tag" data-iata="RSU" data-kolocation="ì—¬ìˆ˜">ì—¬ìˆ˜</span>
                </div>
                <h3>ë™ë‚¨ì•„ ì¸ê¸° ê²€ìƒ‰</h3>
                <div class="tags-container">
                    <span class="tag" data-iata="DAD" data-kolocation="ë‹¤ë‚­">ë‹¤ë‚­</span>
                    <span class="tag" data-iata="BKK" data-kolocation="ë°©ì½•">ë°©ì½•</span>
                    <span class="tag" data-iata="TPE" data-kolocation="íƒ€ì´ë² ì´">íƒ€ì´ë² ì´</span>
                    <span class="tag" data-iata="HKG" data-kolocation="í™ì½©">í™ì½©</span>
                    <span class="tag" data-iata="DPS" data-kolocation="ë°œë¦¬">ë°œë¦¬</span>
                </div>
                <h3>ì¼ë³¸ ì¸ê¸° ê²€ìƒ‰</h3>
                <div class="tags-container">
                    <span class="tag" data-iata="NRT" data-kolocation="ë„ì¿„/ë‚˜ë¦¬íƒ€">ë„ì¿„/ë‚˜ë¦¬íƒ€</span>
                    <span class="tag" data-iata="KIX" data-kolocation="ì˜¤ì‚¬ì¹´">ì˜¤ì‚¬ì¹´</span>
                    <span class="tag" data-iata="FUK" data-kolocation="í›„ì¿ ì˜¤ì¹´">í›„ì¿ ì˜¤ì¹´</span>
                    <span class="tag" data-iata="CTS" data-kolocation="ì‚¿í¬ë¡œ/ì‚°ì¹˜í† ì„¸">ì‚¿í¬ë¡œ/ì‚°ì¹˜í† ì„¸</span>
                    <span class="tag" data-iata="OKA" data-kolocation="ì˜¤í‚¤ë‚˜ì™€">ì˜¤í‚¤ë‚˜ì™€</span>
                </div>
                <h3>ìœ ëŸ½ ì¸ê¸° ê²€ìƒ‰</h3>
                <div class="tags-container">
                    <span class="tag" data-iata="CDG" data-kolocation="íŒŒë¦¬">íŒŒë¦¬</span>
                    <span class="tag" data-iata="LHR" data-kolocation="ëŸ°ë˜">ëŸ°ë˜</span>
                    <span class="tag" data-iata="FCO" data-kolocation="ë¡œë§ˆ">ë¡œë§ˆ</span>
                    <span class="tag" data-iata="MAD" data-kolocation="ë§ˆë“œë¦¬ë“œ">ë§ˆë“œë¦¬ë“œ</span>
                    <span class="tag" data-iata="BCN" data-kolocation="ë°”ë¥´ì…€ë¡œë‚˜">ë°”ë¥´ì…€ë¡œë‚˜</span>
                </div>
                <h3>ë¶ë¯¸ ë° ê¸°íƒ€</h3>
                <div class="tags-container">
                    <span class="tag" data-iata="JFK" data-kolocation="ë‰´ìš•">ë‰´ìš•</span>
                    <span class="tag" data-iata="SYD" data-kolocation="ì‹œë“œë‹ˆ">ì‹œë“œë‹ˆ</span>
                    <span class="tag" data-iata="LAX" data-kolocation="ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤">ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤</span>
                    <span class="tag" data-iata="SFO" data-kolocation="ìƒŒí”„ë€ì‹œìŠ¤ì½”">ìƒŒí”„ë€ì‹œìŠ¤ì½”</span>
                    <span class="tag" data-iata="GUM" data-kolocation="ê´Œ">ê´Œ</span>
                </div>
            </div>
        </div>
    </div>

    <div id="passengerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ì¸ì› ë° ì¢Œì„ ë“±ê¸‰</h2>
                <button class="close-button close-modal-btn" data-target="passengerModal">&times;</button>
            </div>
            <div class="passenger-section">
                <h4>ì¸ì›</h4>
                <div class="passenger-row" data-type="adult">
                    <div class="passenger-label">
                        <div>ì„±ì¸</div>
                        <small>ë§Œ 12ì„¸ ì´ìƒ</small>
                    </div>
                    <div class="passenger-controls">
                        <button type="button" class="control-btn minus" disabled>-</button>
                        <span class="count">1</span>
                        <button type="button" class="control-btn plus">+</button>
                    </div>
                </div>
                <div class="passenger-row" data-type="child">
                    <div class="passenger-label">
                        <div>ì†Œì•„</div>
                        <small>ë§Œ 2~12ì„¸ ë¯¸ë§Œ</small>
                    </div>
                    <div class="passenger-controls">
                        <button type="button" class="control-btn minus" disabled>-</button>
                        <span class="count">0</span>
                        <button type="button" class="control-btn plus">+</button>
                    </div>
                </div>
                <div class="passenger-row" data-type="infant">
                    <div class="passenger-label">
                        <div>ìœ ì•„</div>
                        <small>ë§Œ 2ì„¸ ë¯¸ë§Œ (ë³´í˜¸ìì™€ ë™ë°˜ ì°©ì„)</small>
                    </div>
                    <div class="passenger-controls">
                        <button type="button" class="control-btn minus" disabled>-</button>
                        <span class="count">0</span>
                        <button type="button" class="control-btn plus">+</button>
                    </div>
                </div>
            </div>
            <div class="seat-class-section">
                <h4>ì¢Œì„ë“±ê¸‰</h4>
                <div class="seat-class-options">
                    <label><input type="radio" name="travelClassModal" value="ECONOMY" checked> ì¼ë°˜ì„</label>
                    <label><input type="radio" name="travelClassModal" value="BUSINESS"> ë¹„ì¦ˆë‹ˆìŠ¤ì„</label>
                </div>
            </div>
            <button type="button" id="confirmPassengerBtn" class="confirm-btn">ì„ íƒ ì™„ë£Œ</button>
        </div>
    </div>

    <div id="alertModal" class="modal-overlay">
        <div class="modal-content">
            <p id="alertModalMessage">ë©”ì‹œì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            <button id="closeAlertModalBtn" class="close-modal-btn" data-target="alertModal">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="loadingModal">
        <div class="spinner"></div>
        <p>ìµœì €ê°€ í•­ê³µê¶Œì„ ê²€ìƒ‰ì¤‘ì…ë‹ˆë‹¤...</p>
    </div>

    <div id="destinationModal" class="modal-overlay">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="destModalTitle">ì—¬í–‰ì§€ ì´ë¦„</h2>
                <button class="close-button close-modal-btn" data-target="destinationModal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="destModalDesc" class="dest-desc">ì—¬í–‰ì§€ ì„¤ëª…ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
                <h3 class="rec-title">âœ¨ ì¶”ì²œ ì¦ê¸¸ê±°ë¦¬</h3>
                <div id="activityGrid" class="activity-grid"></div>
                <div style="margin-top: 30px; text-align: center; padding-bottom: 10px;">
                    <button type="button" id="btnBookFlight" class="submit-button btn-primary-action" style="width: 100%;">
                        âœˆï¸ í•­ê³µê¶Œ ê²€ìƒ‰í•˜ëŸ¬ ê°€ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>

    <script>
    
    /* =========================================
       1. ìƒìˆ˜ ë° ë°ì´í„° ì •ì˜ (Constants)
       ========================================= */
    const CITY_CODE_MAP = {
        "ì œì£¼": "CJU", "ë¶€ì‚°": "PUS", "ë¶€ì‚°/ê¹€í•´": "PUS", "ì—¬ìˆ˜": "RSU",
        "ì–‘ì–‘": "YNY", "ê´‘ì£¼": "KWJ", "í¬í•­": "KPO", "í¬í•­/ê²½ì£¼": "KPO",
        "ì„œìš¸": "SEL", "ì„œìš¸/ê¹€í¬": "GMP", "ì„œìš¸/ì¸ì²œ": "ICN", "ìš¸ì‚°": "USN",
        "ì²­ì£¼": "CJJ", "ë¬´ì•ˆ": "MWX", "ëŒ€êµ¬": "TAE",
        "ì˜¤ì‚¬ì¹´": "KIX", "ë„ì¿„": "NRT", "ë„ì¿„/ë‚˜ë¦¬íƒ€": "NRT", "í›„ì¿ ì˜¤ì¹´": "FUK",
        "ì‚¿í¬ë¡œ": "CTS", "ì˜¤í‚¤ë‚˜ì™€": "OKA", "ë‹¤ë‚­": "DAD", "ë°©ì½•": "BKK",
        "íƒ€ì´ë² ì´": "TPE", "í™ì½©": "HKG", "ë°œë¦¬": "DPS", "íŒŒë¦¬": "CDG",
        "ëŸ°ë˜": "LHR", "ë¡œë§ˆ": "FCO", "ë‰´ìš•": "JFK", "ì‹œë“œë‹ˆ": "SYD", "ê´Œ": "GUM"
    };

    const LONG_HAUL_LIST = ["JFK", "LAX", "SFO", "SYD", "CDG", "LHR", "FCO", "MAD", "BCN"];
    const ASIA_RESORT_LIST = ["DAD", "BKK", "DPS", "GUM", "CEB", "NHA", "HKG"];
    const SMALL_DOMESTIC_LIST = ["KPO", "RSU", "KWJ", "USN", "HIN", "KUV", "WJU", "YNY"];
    const NO_FLIGHT_FROM_SEOUL = ["CJJ", "WJU", "KUV", "YNY"];

    const IMPOSSIBLE_ROUTES = {
        "SEL": ["ICN", "GMP", "KPO", ...NO_FLIGHT_FROM_SEOUL],
        "ICN": [...SMALL_DOMESTIC_LIST, "GMP", ...NO_FLIGHT_FROM_SEOUL, "CJJ"],
        "GMP": ["ICN", ...LONG_HAUL_LIST, ...ASIA_RESORT_LIST, "FUK", "OKA", "CTS", "NRT", ...NO_FLIGHT_FROM_SEOUL, "CJJ"],
        "KPO": ["ICN", "SEL", ...LONG_HAUL_LIST, ...ASIA_RESORT_LIST],
        "RSU": ["ICN", "SEL", ...LONG_HAUL_LIST, ...ASIA_RESORT_LIST],
        "KWJ": ["ICN", "SEL", ...LONG_HAUL_LIST, ...ASIA_RESORT_LIST, "YNY"],
        "USN": ["ICN", "SEL", "PUS", ...LONG_HAUL_LIST, ...ASIA_RESORT_LIST],
        "JFK": SMALL_DOMESTIC_LIST,
        "LHR": SMALL_DOMESTIC_LIST,
        "CDG": SMALL_DOMESTIC_LIST,
        "LAX": SMALL_DOMESTIC_LIST,
        "GUM": SMALL_DOMESTIC_LIST
    };

    /* =========================================
       2. DOM ìš”ì†Œ (DOM Elements)
       ========================================= */
    // Main Search Inputs
    const els = {
        departureBtn: document.getElementById('departureBtn'),
        arrivalBtn: document.getElementById('arrivalBtn'),
        depCodeInput: document.getElementById('departureCode'),
        arrCodeInput: document.getElementById('arrivalCode'),
        depKoInput: document.getElementById('departureKoLocation'),
        arrKoInput: document.getElementById('arrivalKoLocation'),
        dateRangeBtn: document.getElementById('dateRangeBtn'),
        depDateInput: document.getElementById('departureDateInput'),
        retDateInput: document.getElementById('returnDateInput'),
        passengerBtn: document.getElementById('passengerBtn'),
        directFlightCheckbox: document.getElementById('direct-flight-checkbox'),
        directFlightInput: document.getElementById('directFlightInput'),
        oneWayRadio: document.getElementById('one-way'),
        roundTripRadio: document.getElementById('round-trip'),
        searchForm: document.querySelector('.search-widget-container'),
        swapBtn: document.querySelector('.swap-button')
    };

    // Modals
    const modals = {
        location: document.getElementById('locationModal'),
        passenger: document.getElementById('passengerModal'),
        alert: document.getElementById('alertModal'),
        loading: document.getElementById('loadingModal'),
        destination: document.getElementById('destinationModal')
    };

    // Passenger Modal Inputs
    const passengerInputs = {
        adults: document.getElementById('adultsInput'),
        children: document.getElementById('childrenInput'),
        infants: document.getElementById('infantsInput'),
        travelClass: document.getElementById('travelClassInput')
    };

    let activeSelection = null; // 'departure' or 'arrival'
    const defaultLocationContent = modals.location.querySelector('.popular-searches').innerHTML;

    /* =========================================
       3. ì´ˆê¸°í™” ë° ìœ í‹¸ë¦¬í‹° (Init & Utils)
       ========================================= */
    
    // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ ê³µí†µ ì²˜ë¦¬
    document.querySelectorAll('.close-modal-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const targetId = btn.getAttribute('data-target');
            document.getElementById(targetId).style.display = 'none';
        });
    });

    // ë°°ê²½ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
    Object.values(modals).forEach(modal => {
        if (!modal) return;
        modal.addEventListener('click', (e) => {
            if (e.target === modal) modal.style.display = 'none';
        });
    });

    function showAlert(msg) {
        document.getElementById('alertModalMessage').innerHTML = msg.replace(/\n/g, '<br>');
        modals.alert.style.display = 'flex';
    }

    function formatDate(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    function formatDisplayDate(date) {
        const week = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        return `${date.getMonth() + 1}.${date.getDate()}(${week[date.getDay()]})`;
    }

    /* =========================================
       4. ìœ„ì¹˜ ì„ íƒ (Location Logic)
       ========================================= */
    
    function openLocationModal(type) {
        activeSelection = type;
        const title = type === 'departure' ? 'ì¶œë°œì§€ ì„ íƒ' : 'ë„ì°©ì§€ ì„ íƒ';
        
        // Reset Logic
        const content = modals.location.querySelector('.modal-content');
        content.querySelector('#modalTitle').textContent = title;
        content.querySelector('.popular-searches').innerHTML = defaultLocationContent;
        const input = content.querySelector('#searchAir');
        input.value = "";
        
        // Re-attach tag listeners
        content.querySelectorAll('.tag').forEach(tag => tag.addEventListener('click', handleTagClick));
        
        modals.location.style.display = 'flex';
        input.focus();
    }

    function handleTagClick(e) {
        const tag = e.currentTarget;
        selectLocation(tag.dataset.kolocation || tag.textContent, tag.dataset.iata);
    }

    function selectLocation(koLoc, iata) {
        const display = `${koLoc} ${iata}`;
        if (activeSelection === 'departure') {
            els.departureBtn.textContent = display;
            els.depCodeInput.value = iata;
            els.depKoInput.value = koLoc;
        } else {
            els.arrivalBtn.textContent = display;
            els.arrCodeInput.value = iata;
            els.arrKoInput.value = koLoc;
            els.arrivalBtn.classList.replace('field-placeholder', 'field-location');
        }
        modals.location.style.display = 'none';
    }

    function renderSearchResults(list) {
        const container = modals.location.querySelector('.popular-searches');
        if (!list || list.length === 0) {
            container.innerHTML = '<div class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            return;
        }
        container.innerHTML = list.map(air => `
            <div class="search-result-item" data-kolocation="${air.kolocation}" data-iata="${air.iataCode}">
                <div class="location-main">${air.kolocation} (${air.iataCode})</div>
                <div class="location-sub">${air.enlocation}</div>
            </div>
        `).join('');
    }

    els.departureBtn.addEventListener('click', () => openLocationModal('departure'));
    els.arrivalBtn.addEventListener('click', () => openLocationModal('arrival'));

    // ê²€ìƒ‰ ê²°ê³¼ í´ë¦­ ì´ë²¤íŠ¸ ìœ„ì„
    modals.location.addEventListener('click', (e) => {
        const item = e.target.closest('.search-result-item');
        if (item) selectLocation(item.dataset.kolocation, item.dataset.iata);
    });

    // ìœ„ì¹˜ ê²€ìƒ‰ (Enter)
    document.getElementById('searchAir').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            $.ajax({
                url: "/air/searchAir",
                type: "get",
                dataType: "json",
                data: { "text": e.target.value },
                success: renderSearchResults
            });
        }
    });

    // íƒœê·¸ ì´ˆê¸°í™”
    document.querySelectorAll('.tag').forEach(tag => tag.addEventListener('click', handleTagClick));

    // Swap ë²„íŠ¼ ë¡œì§
    els.swapBtn.addEventListener('click', () => {
        // ê°’ êµí™˜
        [els.departureBtn.textContent, els.arrivalBtn.textContent] = [els.arrivalBtn.textContent, els.departureBtn.textContent];
        [els.depCodeInput.value, els.arrCodeInput.value] = [els.arrCodeInput.value, els.depCodeInput.value];
        [els.depKoInput.value, els.arrKoInput.value] = [els.arrKoInput.value, els.depKoInput.value];

        // ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ êµí™˜
        const depHasLoc = els.departureBtn.classList.contains('field-location');
        const arrHasLoc = els.arrivalBtn.classList.contains('field-location');
        
        els.departureBtn.className = arrHasLoc ? 'field-location' : 'field-placeholder';
        els.arrivalBtn.className = depHasLoc ? 'field-location' : 'field-placeholder';
    });

    /* =========================================
       5. ë‚ ì§œ ì„ íƒ (Flatpickr)
       ========================================= */
    
    function resetDate() {
        els.dateRangeBtn.textContent = 'ì–¸ì œ ë– ë‚˜ì‹œë‚˜ìš”?';
        els.dateRangeBtn.className = 'field-placeholder';
        els.depDateInput.value = '';
        els.retDateInput.value = '';
        datePicker.clear();
    }

    const datePicker = flatpickr(els.dateRangeBtn, {
        mode: 'range',
        dateFormat: "Y-m-d",
        locale: "ko",
        minDate: "today",
        onClose: (selectedDates) => {
            const isOneWay = els.oneWayRadio.checked;
            if (isOneWay && selectedDates.length >= 1) {
                const s = selectedDates[0];
                els.depDateInput.value = formatDate(s);
                els.retDateInput.value = '';
                els.dateRangeBtn.textContent = formatDisplayDate(s);
                els.dateRangeBtn.className = 'field-location';
            } else if (!isOneWay && selectedDates.length === 2) {
                const [s, e] = selectedDates;
                els.depDateInput.value = formatDate(s);
                els.retDateInput.value = formatDate(e);
                els.dateRangeBtn.textContent = `${formatDisplayDate(s)} ~ ${formatDisplayDate(e)}`;
                els.dateRangeBtn.className = 'field-location';
            }
        }
    });

    els.oneWayRadio.addEventListener('change', function() {
        if(this.checked) { datePicker.set('mode', 'single'); resetDate(); }
    });
    els.roundTripRadio.addEventListener('change', function() {
        if(this.checked) { datePicker.set('mode', 'range'); resetDate(); }
    });
    // Prevent default click behavior on button
    els.dateRangeBtn.addEventListener('click', e => e.preventDefault());


    /* =========================================
       6. íƒ‘ìŠ¹ê° ì„ íƒ (Passenger Logic)
       ========================================= */
    
    els.passengerBtn.addEventListener('click', () => modals.passenger.style.display = 'flex');

    function updatePassengerUI() {
        const adults = parseInt(modals.passenger.querySelector('[data-type="adult"] .count').textContent);
        const children = parseInt(modals.passenger.querySelector('[data-type="child"] .count').textContent);
        const infants = parseInt(modals.passenger.querySelector('[data-type="infant"] .count').textContent);
        const total = adults + children + infants;

        const setBtn = (row, type, condition) => {
            modals.passenger.querySelector(`[data-type="${row}"] .${type}`).disabled = condition;
        };

        const isMax = total >= 9;
        setBtn('adult', 'plus', isMax);
        setBtn('adult', 'minus', adults <= 1 || adults <= infants);
        setBtn('child', 'plus', isMax);
        setBtn('child', 'minus', children <= 0);
        setBtn('infant', 'plus', isMax || infants >= adults);
        setBtn('infant', 'minus', infants <= 0);
    }

    modals.passenger.addEventListener('click', (e) => {
        if (!e.target.classList.contains('control-btn')) return;
        const btn = e.target;
        if (btn.disabled) return;
        
        const countSpan = btn.closest('.passenger-row').querySelector('.count');
        let val = parseInt(countSpan.textContent);
        countSpan.textContent = btn.classList.contains('plus') ? val + 1 : val - 1;
        updatePassengerUI();
    });

    document.getElementById('confirmPassengerBtn').addEventListener('click', () => {
        const adults = modals.passenger.querySelector('[data-type="adult"] .count').textContent;
        const children = modals.passenger.querySelector('[data-type="child"] .count').textContent;
        const infants = modals.passenger.querySelector('[data-type="infant"] .count').textContent;
        const radio = modals.passenger.querySelector('input[name="travelClassModal"]:checked');
        
        passengerInputs.adults.value = adults;
        passengerInputs.children.value = children;
        passengerInputs.infants.value = infants;
        passengerInputs.travelClass.value = radio.value;

        const total = parseInt(adults) + parseInt(children) + parseInt(infants);
        els.passengerBtn.textContent = `ğŸ‘¤ íƒ‘ìŠ¹ê° ${total}ëª…, ${radio.parentElement.textContent.trim()}`;
        els.passengerBtn.className = 'field-location';
        modals.passenger.style.display = 'none';
    });

    // ì§í•­ ì²´í¬ë°•ìŠ¤
    els.directFlightCheckbox.addEventListener('change', function() {
        els.directFlightInput.value = this.checked ? 'true' : 'false';
    });


    /* =========================================
       7. í¼ ì œì¶œ ë° ìœ íš¨ì„± ê²€ì‚¬ (Submit & Validation)
       ========================================= */
    
    els.searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const dep = els.depCodeInput.value;
        const arr = els.arrCodeInput.value;
        const date = els.depDateInput.value;

        if (!arr) return showAlert('ë„ì°©ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        if (!date) return showAlert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');

        // ë¶ˆê°€ëŠ¥í•œ ê²½ë¡œ ì²´í¬
        if (IMPOSSIBLE_ROUTES[dep] && IMPOSSIBLE_ROUTES[dep].includes(arr)) {
            const depName = els.departureBtn.textContent.split(' ')[0];
            const arrName = els.arrivalBtn.textContent.split(' ')[0];
            return showAlert(`ğŸš« ìš´í•­í•˜ì§€ ì•ŠëŠ” ë…¸ì„ ì…ë‹ˆë‹¤.\n\n[${depName}]ì—ì„œ [${arrName}]ë¡œ ê°€ëŠ”\nì§í•­ í•­ê³µí¸ì€ ì—†ìŠµë‹ˆë‹¤.`);
        }

        modals.loading.style.display = 'flex';
        setTimeout(() => this.submit(), 100);
    });

    /* =========================================
       8. ì—¬í–‰ì§€ ì¶”ì²œ ëª¨ë‹¬ (Destination Detail)
       ========================================= */
    
    document.querySelectorAll('.destination-card').forEach(card => {
        card.addEventListener('click', function() {
            const city = this.dataset.city;
            if(city) openDestinationModal(city);
        });
    });

    function openDestinationModal(city) {
        $.ajax({
            url: '/api/destination/detail',
            type: 'GET',
            data: { cityName: city },
            dataType: 'json',
            success: (data) => {
                const mContent = modals.destination.querySelector('.modal-content');
                mContent.querySelector('#destModalTitle').textContent = city;
                mContent.querySelector('#destModalDesc').textContent = data.desc;

                // Activity Grid
                const grid = mContent.querySelector('#activityGrid');
                if (data.activities && data.activities.length > 0) {
                    grid.innerHTML = data.activities.map(item => `
                        <div class="activity-item">
                            <img src="${item.img}" class="activity-img" alt="${item.title}">
                            <div class="activity-info">
                                <h5>${item.title}</h5>
                                <p>${item.text}</p>
                            </div>
                        </div>
                    `).join('');
                } else {
                    grid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">ë“±ë¡ëœ ì¶”ì²œ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }

                // "í•­ê³µê¶Œ ê²€ìƒ‰í•˜ëŸ¬ ê°€ê¸°" ë²„íŠ¼ ì„¤ì •
                const bookBtn = mContent.querySelector('#btnBookFlight');
                bookBtn.textContent = `âœˆï¸ ${city} í•­ê³µê¶Œ ê²€ìƒ‰í•˜ëŸ¬ ê°€ê¸°`;
                
                bookBtn.onclick = () => {
                    els.arrivalBtn.textContent = city;
                    els.arrivalBtn.className = 'field-location';
                    els.arrKoInput.value = city;

                    // ì½”ë“œ ì°¾ê¸° (API ë°ì´í„° > ë§µ > ì—ëŸ¬)
                    let targetCode = data.iataCode || CITY_CODE_MAP[city] || CITY_CODE_MAP[data.cityName];

                    if (targetCode) {
                        els.arrCodeInput.value = targetCode;
                    } else {
                        alert("ì£„ì†¡í•©ë‹ˆë‹¤. í•´ë‹¹ ì—¬í–‰ì§€ì˜ ê³µí•­ ì½”ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                        return;
                    }

                    modals.destination.style.display = 'none';
                    document.querySelector('.hero-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    setTimeout(() => datePicker.open(), 500);
                };

                modals.destination.style.display = 'flex';
            },
            error: () => alert('ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
        });
    }
	
    // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    updatePassengerUI();

    </script>
</body>
</html>